{
  FactHandle handle=lookupFactHandle(inner);
  InternalFactHandle h=(InternalFactHandle)handle;
  if (handle != null) {
    TraitFieldTMS fieldTMS=inner._getFieldTMS();
    BitMask mask=fieldTMS == null ? onlyTraitBitSetMask() : fieldTMS.getModificationMask();
    ((NamedEntryPoint)h.getEntryPoint()).update(h,((InternalFactHandle)handle).getObject(),mask,core.getClass(),activation);
  }
 else {
    handle=this.workingMemory.insert(inner,null,false,logical,activation.getRule(),activation);
    if (this.identityMap != null) {
      this.identityMap.put(inner,handle);
    }
  }
}
