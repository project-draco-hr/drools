{
  if (handle.isTraitable()) {
    if (((TraitableBean)handle.getObject()).hasTraits()) {
      updateTraits(handle.getObject(),mask,null,modifiedClass,null,((TraitableBean)handle.getObject()).getMostSpecificTraits(),activation);
    }
  }
 else   if (handle.isTraiting()) {
    Thing x=(Thing)handle.getObject();
    if (x != x.getCore()) {
      Object core=x.getCore();
      InternalFactHandle coreHandle=(InternalFactHandle)getFactHandle(core);
      ((NamedEntryPoint)coreHandle.getEntryPoint()).update(coreHandle,core,mask,modifiedClass,activation);
      BitSet veto=((TraitProxy)x).getTypeCode();
      updateTraits(core,mask,x,modifiedClass,veto,((TraitableBean)core).getMostSpecificTraits(),activation);
    }
  }
}
