{
  KnowledgeBuilder kbuilder=KnowledgeBuilderFactory.newKnowledgeBuilder();
  kbuilder.add(ResourceFactory.newClassPathResource("waltzdb.drl",WaltzDbBenchmark.class),KnowledgeType.DRL);
  Collection<KnowledgePackage> pkgs=kbuilder.getKnowledgePackages();
  KnowledgeBaseConfiguration kbaseConfiguration=KnowledgeBaseFactory.newKnowledgeBaseConfiguration();
  kbaseConfiguration.setProperty("drools.removeIdentities","true");
  final KnowledgeBase kbase=KnowledgeBaseFactory.newKnowledgeBase(kbaseConfiguration);
  kbase.addKnowledgePackages(pkgs);
  StatefulKnowledgeSession ksession=kbase.newStatefulKnowledgeSession();
  java.util.List lines=WaltzDbBenchmark.loadLines("waltzdb16.dat");
  java.util.List labels=WaltzDbBenchmark.loadLabels("waltzdb16.dat");
  long now=System.currentTimeMillis();
  Iterator iter=lines.iterator();
  while (iter.hasNext()) {
    Line line=(Line)iter.next();
    ksession.insert(line);
    System.out.println(line.getP1() + " " + line.getP2());
  }
  iter=labels.iterator();
  while (iter.hasNext()) {
    Label label=(Label)iter.next();
    ksession.insert(label);
    System.out.println(label.getId() + " " + label.getType());
  }
  Stage stage=new Stage(Stage.DUPLICATE);
  ksession.insert(stage);
  ksession.fireAllRules();
  System.out.println("Time: " + (System.currentTimeMillis() - now));
  ksession.dispose();
}
