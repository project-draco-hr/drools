{
  String source="org/drools/factmodel/traits/testTraitDon.drl";
  KnowledgeBuilder kbuilder=KnowledgeBuilderFactory.newKnowledgeBuilder();
  Resource res=ResourceFactory.newClassPathResource(source);
  assertNotNull(res);
  kbuilder.add(res,ResourceType.DRL);
  if (kbuilder.hasErrors()) {
    fail(kbuilder.getErrors().toString());
  }
  KnowledgeBase kb=KnowledgeBaseFactory.newKnowledgeBase();
  kb.addKnowledgePackages(kbuilder.getKnowledgePackages());
  TraitBuilder traitBuilder=new TraitBuilder(kb);
  try {
    ITraitable imp=(ITraitable)kb.getFactType("org.test","Imp").newInstance();
    Class trait=kb.getFactType("org.test","Student").getFactClass();
    Class trait2=kb.getFactType("org.test","Role").getFactClass();
    assertNotNull(trait);
    TraitProxy proxy=(TraitProxy)traitBuilder.getProxy(imp,trait);
    proxy.getFields().put("field","xyz");
    proxy.getFields().put("name","aaa");
    assertNotNull(proxy);
    TraitProxy proxy2=(TraitProxy)traitBuilder.getProxy(imp,trait);
    assertSame(proxy2,proxy);
    TraitProxy proxy3=(TraitProxy)traitBuilder.getProxy(imp,trait2);
    assertNotNull(proxy3);
    assertEquals("xyz",proxy3.getFields().get("field"));
    assertEquals("aaa",proxy3.getFields().get("name"));
    System.out.println(proxy2.equals(proxy3));
    ITraitable imp2=(ITraitable)kb.getFactType("org.test","Imp").newInstance();
    TraitProxy proxy4=(TraitProxy)traitBuilder.getProxy(imp2,trait);
    proxy4.getFields().put("name","aaa");
    proxy4.getFields().put("field","xyz");
    Assert.assertEquals(proxy2,proxy4);
  }
 catch (  InstantiationException e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
catch (  IllegalAccessException e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
}
