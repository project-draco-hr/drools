{
  if (!constraints.xpathConstraints.isEmpty()) {
    buildTupleSource(context,utils);
    List<BetaNodeFieldConstraint> xpathConstraints=context.getBetaconstraints();
    buildJoinNode(context,utils);
    context.setBetaconstraints(xpathConstraints);
    ReteooComponentBuilder builder=utils.getBuilderFor(XpathConstraint.class);
    for (    XpathConstraint xpathConstraint : constraints.xpathConstraints) {
      for (      XpathConstraint.XpathChunk chunk : xpathConstraint.getChunks()) {
        context.setAlphaConstraints(chunk.getAlphaConstraints());
        context.setBetaconstraints(chunk.getBetaConstraints());
        builder.build(context,utils,chunk.asFrom());
        context.incrementCurrentPatternOffset();
      }
      Declaration declaration=xpathConstraint.getDeclaration();
      Pattern clonedPattern=new Pattern(pattern.getIndex(),context.getCurrentPatternOffset(),new ClassObjectType(xpathConstraint.getResultClass()),declaration.getIdentifier(),declaration.isInternalFact());
      declaration.setPattern(clonedPattern);
    }
    context.popRuleComponent();
  }
}
