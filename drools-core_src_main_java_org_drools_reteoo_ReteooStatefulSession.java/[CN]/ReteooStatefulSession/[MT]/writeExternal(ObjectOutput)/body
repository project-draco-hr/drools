{
  StatefulKnowledgeSessionImpl ksession=new StatefulKnowledgeSessionImpl(this);
  Marshaller marshaller=MarshallerFactory.newMarshaller(ksession.getKnowledgeBase());
  ByteArrayOutputStream stream=new ByteArrayOutputStream();
  marshaller.marshall(stream,ksession);
  stream.close();
  byte[] bytes=stream.toByteArray();
  out.writeInt(bytes.length);
  out.write(bytes);
}
