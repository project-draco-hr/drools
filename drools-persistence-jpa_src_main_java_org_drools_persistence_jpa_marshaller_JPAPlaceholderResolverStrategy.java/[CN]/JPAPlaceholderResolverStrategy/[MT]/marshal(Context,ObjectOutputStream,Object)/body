{
  Object id=getClassIdValue(object);
  EntityManager em=emf.createEntityManager();
  if (id == null) {
    em.persist(object);
    id=getClassIdValue(object);
  }
 else {
    em.merge(object);
  }
  ByteArrayOutputStream buff=new ByteArrayOutputStream();
  ObjectOutputStream oos=new ObjectOutputStream(buff);
  oos.writeUTF(object.getClass().getCanonicalName());
  oos.writeObject(id);
  oos.close();
  return buff.toByteArray();
}
