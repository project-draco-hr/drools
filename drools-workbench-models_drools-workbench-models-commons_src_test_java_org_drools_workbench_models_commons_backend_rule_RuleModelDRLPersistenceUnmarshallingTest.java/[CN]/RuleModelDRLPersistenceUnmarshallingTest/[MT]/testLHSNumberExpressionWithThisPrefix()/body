{
  String drl="package org.mortgages;\n" + "import java.lang.Number\n" + "rule \"test\"\n"+ " dialect \"mvel\"\n"+ " when\n"+ "  Number( this.intValue() > 5 )\n"+ " then\n"+ "end";
  final HashMap<String,List<MethodInfo>> map=new HashMap<String,List<MethodInfo>>();
  final ArrayList<MethodInfo> methodInfos=new ArrayList<MethodInfo>();
  methodInfos.add(new MethodInfo("intValue",Collections.EMPTY_LIST,"int",null,DataType.TYPE_NUMERIC_INTEGER));
  map.put("java.lang.Number",methodInfos);
  when(dmo.getProjectMethodInformation()).thenReturn(map);
  final RuleModel m=RuleModelDRLPersistenceImpl.getInstance().unmarshal(drl,new ArrayList<String>(),dmo);
  assertNotNull(m);
  assertEquals(1,m.lhs.length);
  assertTrue(m.lhs[0] instanceof FactPattern);
  final FactPattern fp=(FactPattern)m.lhs[0];
  assertEquals("Number",fp.getFactType());
  assertEquals(1,fp.getNumberOfConstraints());
  assertTrue(fp.getConstraint(0) instanceof SingleFieldConstraintEBLeftSide);
  final SingleFieldConstraintEBLeftSide exp=(SingleFieldConstraintEBLeftSide)fp.getConstraint(0);
  assertEquals("int",exp.getFieldType());
  assertEquals(">",exp.getOperator());
  assertEquals("5",exp.getValue());
  assertEquals(3,exp.getExpressionLeftSide().getParts().size());
  assertTrue(exp.getExpressionLeftSide().getParts().get(0) instanceof ExpressionUnboundFact);
  final ExpressionUnboundFact expPart0=(ExpressionUnboundFact)exp.getExpressionLeftSide().getParts().get(0);
  assertEquals("Number",expPart0.getFactType());
  assertTrue(exp.getExpressionLeftSide().getParts().get(1) instanceof ExpressionField);
  final ExpressionField expPart1=(ExpressionField)exp.getExpressionLeftSide().getParts().get(1);
  assertEquals("this",expPart1.getName());
  assertTrue(exp.getExpressionLeftSide().getParts().get(2) instanceof ExpressionMethod);
  final ExpressionMethod expPart2=(ExpressionMethod)exp.getExpressionLeftSide().getParts().get(2);
  assertEquals("intValue",expPart2.getName());
}
