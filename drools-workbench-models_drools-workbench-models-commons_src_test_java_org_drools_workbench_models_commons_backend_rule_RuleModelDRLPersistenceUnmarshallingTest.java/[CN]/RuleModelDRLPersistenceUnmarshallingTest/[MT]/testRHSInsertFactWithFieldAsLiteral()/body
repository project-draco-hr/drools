{
  String drl="package org.mortgages\n" + "import org.test.Person\n" + "rule \"variable\"\n"+ "dialect \"mvel\"\n"+ "when\n"+ "Person( field1 == 44 )\n"+ "then\n"+ "Person fact0 = new Person();\n"+ "fact0.setField1( 55 );\n"+ "insert( fact0 );\n"+ "end";
  addModelField("org.test.Person","field1","java.lang.Integer",DataType.TYPE_NUMERIC_INTEGER);
  final RuleModel m=RuleModelDRLPersistenceImpl.getInstance().unmarshal(drl,new ArrayList<String>(),dmo);
  assertNotNull(m);
  assertEquals(1,m.lhs.length);
  IPattern p=m.lhs[0];
  assertTrue(p instanceof FactPattern);
  FactPattern fp=(FactPattern)p;
  assertEquals("Person",fp.getFactType());
  assertEquals(1,fp.getConstraintList().getConstraints().length);
  assertTrue(fp.getConstraint(0) instanceof SingleFieldConstraint);
  SingleFieldConstraint sfp=(SingleFieldConstraint)fp.getConstraint(0);
  assertEquals("Person",sfp.getFactType());
  assertEquals("field1",sfp.getFieldName());
  assertEquals("==",sfp.getOperator());
  assertEquals("44",sfp.getValue());
  assertEquals(BaseSingleFieldConstraint.TYPE_LITERAL,sfp.getConstraintValueType());
  assertEquals(1,m.rhs.length);
  IAction a=m.rhs[0];
  assertTrue(a instanceof ActionInsertFact);
  ActionInsertFact ap=(ActionInsertFact)a;
  assertEquals("Person",ap.getFactType());
  assertEquals("fact0",ap.getBoundName());
  assertEquals(1,ap.getFieldValues().length);
  ActionFieldValue afv=ap.getFieldValues()[0];
  assertEquals("field1",afv.getField());
  assertEquals(FieldNatureType.TYPE_LITERAL,afv.getNature());
  assertEquals("55",afv.getValue());
  assertEquals(DataType.TYPE_NUMERIC_INTEGER,afv.getType());
}
