{
  ClassLoader classLoader=Thread.currentThread().getContextClassLoader();
  final Enumeration<URL> e;
  try {
    e=classLoader.getResources(KieModuleModelImpl.KMODULE_JAR_PATH);
  }
 catch (  IOException exc) {
    log.error("Unable to find and build index of kmodule.xml \n" + exc.getMessage());
    return;
  }
  while (e.hasMoreElements()) {
    URL url=e.nextElement();
    try {
      String fixedURL=fixURLFromKProjectPath(url);
      InternalKieModule kModule=fetchKModule(url,fixedURL);
      ReleaseId releaseId=kModule.getReleaseId();
      kieModules.put(releaseId,kModule);
      log.debug("Discovered classpath module " + releaseId.toExternalForm());
      kr.addKieModule(kModule);
    }
 catch (    Exception exc) {
      log.error("Unable to build index of kmodule.xml url=" + url.toExternalForm() + "\n"+ exc.getMessage());
    }
  }
}
