{
  RuleBaseConfiguration conf=new RuleBaseConfiguration();
  RuleBase ruleBase=RuleBaseFactory.newRuleBase(conf);
  StatefulSession session=ruleBase.newStatefulSession();
  NodeImpl mockNode=new NodeImpl(){
  }
;
  MockNodeInstanceFactory factory=new MockNodeInstanceFactory(new MockNodeInstance(mockNode));
  conf.getProcessNodeInstanceFactoryRegistry().register(mockNode.getClass(),factory);
  RuleFlowProcessImpl process=new RuleFlowProcessImpl();
  Node endNode=new EndNodeImpl();
  endNode.setId(1);
  endNode.setName("end node");
  mockNode.setId(2);
  new ConnectionImpl(mockNode,endNode,Connection.TYPE_NORMAL);
  process.addNode(mockNode);
  process.addNode(endNode);
  RuleFlowProcessInstanceImpl processInstance=new RuleFlowProcessInstanceImpl();
  processInstance.setState(ProcessInstance.STATE_ACTIVE);
  processInstance.setProcess(process);
  processInstance.setWorkingMemory((InternalWorkingMemory)session);
  MockNodeInstance mockNodeInstance=(MockNodeInstance)processInstance.getNodeInstance(mockNode);
  mockNodeInstance.trigger(null);
  assertEquals(ProcessInstance.STATE_COMPLETED,processInstance.getState());
}
