{
  BlockExecutionEngine engine=(BlockExecutionEngine)parse("(printout d xx (eq 1 1) ?c (create$ (+ 1 1) x y) zzz)").rhs();
  ExecutionContext context=new ExecutionContext(null,null,1);
  Map vars=new HashMap();
  vars.put("?c",new ObjectValueHandler("brie"));
  engine.replaceTempTokens(vars);
  ByteArrayOutputStream bais=new ByteArrayOutputStream();
  context.addPrintoutRouter("d",new PrintStream(bais));
  engine.execute(context);
  assertEquals("xxtruebrie2xyzzz",new String(bais.toByteArray()));
}
