{
  StatelessSession session=getStatelessSession(this.getClass().getResourceAsStream("Patterns.drl"));
  session.setAgendaFilter(new RuleNameMatchesAgendaFilter("Pattern that is always false"));
  VerifierResult result=VerifierResultFactory.createVerifierResult();
  Collection<Object> data=new ArrayList<Object>();
  session.setGlobal("result",result);
  Pattern pattern1=new Pattern();
  Restriction r1=new LiteralRestriction();
  Restriction r2=new LiteralRestriction();
  Incompatibility i1=new Incompatibility(r1,r2);
  PatternPossibility pp1=new PatternPossibility();
  pp1.setPatternId(pattern1.getId());
  pp1.add(r1);
  pp1.add(r2);
  Restriction r3=new VariableRestriction();
  Restriction r4=new VariableRestriction();
  Incompatibility i2=new Incompatibility(r1,r2);
  PatternPossibility pp2=new PatternPossibility();
  pp2.setPatternId(pattern1.getId());
  pp2.add(r1);
  pp2.add(r2);
  Pattern pattern2=new Pattern();
  Restriction r5=new LiteralRestriction();
  Restriction r6=new LiteralRestriction();
  PatternPossibility pp3=new PatternPossibility();
  pp3.setPatternId(pattern2.getId());
  pp3.add(r5);
  pp3.add(r6);
  Restriction r7=new VariableRestriction();
  Restriction r8=new VariableRestriction();
  Incompatibility i4=new Incompatibility(r7,r8);
  PatternPossibility pp4=new PatternPossibility();
  pp4.setPatternId(pattern2.getId());
  pp4.add(r7);
  pp4.add(r8);
  data.add(pattern1);
  data.add(r1);
  data.add(r2);
  data.add(r3);
  data.add(r4);
  data.add(i1);
  data.add(i2);
  data.add(pp1);
  data.add(pp2);
  data.add(pattern2);
  data.add(r5);
  data.add(r6);
  data.add(r7);
  data.add(r8);
  data.add(i4);
  data.add(pp3);
  data.add(pp4);
  session.executeWithResults(data);
  Iterator<VerifierMessageBase> iter=result.getBySeverity(Severity.ERROR).iterator();
  boolean works=false;
  while (iter.hasNext()) {
    Object o=(Object)iter.next();
    if (o instanceof VerifierMessage) {
      VerifierMessage message=(VerifierMessage)o;
      if (message.getFaulty().equals(pattern1)) {
        works=true;
      }
 else {
        fail("There can be only one. (And this is not the one)");
      }
    }
  }
  assertEquals(1,result.getBySeverity(Severity.ERROR).size());
  assertEquals(0,result.getBySeverity(Severity.WARNING).size());
  assertEquals(0,result.getBySeverity(Severity.NOTE).size());
  assertTrue(works);
}
