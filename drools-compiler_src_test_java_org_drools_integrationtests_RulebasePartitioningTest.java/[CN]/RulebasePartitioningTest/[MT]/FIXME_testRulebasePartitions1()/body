{
  final PackageBuilder builder=new PackageBuilder();
  builder.addPackageFromDrl(new InputStreamReader(getClass().getResourceAsStream("test_rulebasePartitions1.drl")));
  final org.drools.rule.Package pkg=builder.getPackage();
  RuleBaseConfiguration config=new RuleBaseConfiguration();
  config.setMultithreadEvaluation(true);
  RuleBase ruleBase=getRuleBase(config);
  ruleBase.addPackage(pkg);
  ruleBase=SerializationHelper.serializeObject(ruleBase);
  StatefulSession session=ruleBase.newStatefulSession();
  List result=new ArrayList();
  session.setGlobal("results",result);
  Cheese c1=new Cheese("stilton");
  Cheese c2=new Cheese("brie");
  Cheese c3=new Cheese("cheddar");
  Cheese c4=new Cheese("stilton");
  Person p1=new Person("bob");
  Person p2=new Person("mark");
  Person p3=new Person("michael");
  Person p4=new Person("bob");
  session.insert(c1);
  session.insert(c2);
  session.insert(c3);
  session.insert(c4);
  session.insert(p1);
  session.insert(p2);
  session.insert(p3);
  session.insert(p4);
  session=SerializationHelper.getSerialisedStatefulSession(session,ruleBase);
  result=(List)session.getGlobal("results");
  session.fireAllRules();
  assertEquals(3,result.size());
  assertEquals(p4,result.get(0));
  assertEquals(p1,result.get(1));
  assertEquals(c3,result.get(2));
  session.dispose();
}
