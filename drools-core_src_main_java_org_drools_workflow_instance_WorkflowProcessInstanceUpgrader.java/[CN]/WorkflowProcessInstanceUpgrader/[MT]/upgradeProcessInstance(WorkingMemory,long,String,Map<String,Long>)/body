{
  if (nodeMapping == null) {
    nodeMapping=new HashMap<String,Long>();
  }
  WorkflowProcessInstanceImpl processInstance=(WorkflowProcessInstanceImpl)workingMemory.getProcessInstance(processInstanceId);
  if (processInstance == null) {
    throw new IllegalArgumentException("Could not find process instance " + processInstanceId);
  }
  if (processId == null) {
    throw new IllegalArgumentException("Null process id");
  }
  WorkflowProcess process=(WorkflowProcess)((InternalRuleBase)workingMemory.getRuleBase()).getProcess(processId);
  if (process == null) {
    throw new IllegalArgumentException("Could not find process " + processId);
  }
  if (processInstance.getProcessId().equals(processId)) {
    return;
  }
synchronized (processInstance) {
    org.drools.definition.process.Process oldProcess=processInstance.getProcess();
    processInstance.disconnect();
    processInstance.setProcess(oldProcess);
    updateNodeInstances(processInstance,nodeMapping);
    processInstance.setWorkingMemory((InternalWorkingMemory)workingMemory);
    processInstance.setProcess(process);
    processInstance.reconnect();
  }
}
