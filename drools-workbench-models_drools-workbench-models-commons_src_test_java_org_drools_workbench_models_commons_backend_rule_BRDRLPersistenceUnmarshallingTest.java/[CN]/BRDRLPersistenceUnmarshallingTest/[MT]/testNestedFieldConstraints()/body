{
  String drl="rule \"rule1\"\n" + "when\n" + "ParentType( this != null, this.parentChildField != null, this.parentChildField.childField == \"hello\" )\n"+ "then\n"+ "end";
  RuleModel m=BRDRLPersistence.getInstance().unmarshal(drl);
  assertNotNull(m);
  assertEquals("rule1",m.name);
  assertEquals(1,m.lhs.length);
  IPattern p=m.lhs[0];
  assertTrue(p instanceof FactPattern);
  FactPattern fp=(FactPattern)p;
  assertEquals("ParentType",fp.getFactType());
  assertEquals(3,fp.getConstraintList().getConstraints().length);
  assertTrue(fp.getConstraint(0) instanceof SingleFieldConstraint);
  SingleFieldConstraint sfp0=(SingleFieldConstraint)fp.getConstraint(0);
  assertEquals("ParentType",sfp0.getFactType());
  assertEquals("this",sfp0.getFieldName());
  assertEquals(DataType.TYPE_THIS,sfp0.getFieldType());
  assertEquals("!= null",sfp0.getOperator());
  assertNull(sfp0.getValue());
  assertEquals(BaseSingleFieldConstraint.TYPE_UNDEFINED,sfp0.getConstraintValueType());
  assertNull(sfp0.getParent());
  assertTrue(fp.getConstraint(1) instanceof SingleFieldConstraint);
  SingleFieldConstraint sfp1=(SingleFieldConstraint)fp.getConstraint(1);
  assertEquals("ParentType",sfp1.getFactType());
  assertEquals("parentChildField",sfp1.getFieldName());
  assertEquals("ChildType",sfp1.getFieldType());
  assertEquals("!= null",sfp1.getOperator());
  assertNull(sfp1.getValue());
  assertEquals(BaseSingleFieldConstraint.TYPE_UNDEFINED,sfp1.getConstraintValueType());
  assertSame(sfp0,sfp1.getParent());
  assertTrue(fp.getConstraint(2) instanceof SingleFieldConstraint);
  SingleFieldConstraint sfp2=(SingleFieldConstraint)fp.getConstraint(2);
  assertEquals("ChildType",sfp1.getFactType());
  assertEquals("childField",sfp1.getFieldName());
  assertEquals(DataType.TYPE_STRING,sfp1.getFieldType());
  assertEquals("==",sfp1.getOperator());
  assertEquals("hello",sfp1.getValue());
  assertEquals(BaseSingleFieldConstraint.TYPE_LITERAL,sfp1.getConstraintValueType());
  assertSame(sfp1,sfp2.getParent());
}
