{
  RuleBase ruleBase=RuleBaseFactory.newRuleBase();
  Package pkg=new Package("org.drools.test");
  pkg.addGlobal("list",List.class);
  pkg.setClassFieldAccessorCache(new ClassFieldAccessorCache(Thread.currentThread().getContextClassLoader()));
  store=pkg.getClassFieldAccessorStore();
  store.setEagerWire(true);
  pkg.addRule(getFindPersonRule());
  ruleBase.addPackage(pkg);
  StatefulSession session=ruleBase.newStatefulSession();
  List list=new ArrayList();
  session.setGlobal("list",list);
  Person p1=new Person("boba fet",500);
  session.insert(p1);
  MemoryPersistenceManager pm=new MemoryPersistenceManager(new StatefulSessionSnapshotter(session));
  pm.save();
  Person p2=new Person("boba fet",500);
  Person p3=new Person("boba fet",500);
  session.insert(p2);
  session.insert(p3);
  session.insert(new String("boba fet"));
  assertEquals(4,((InternalWorkingMemory)session).getObjectStore().size());
  session.fireAllRules();
  assertEquals(3,list.size());
  pm.load();
  list.clear();
  session.insert(new String("boba fet"));
  session.fireAllRules();
  assertEquals(1,list.size());
  assertEquals(2,((InternalWorkingMemory)session).getObjectStore().size());
}
