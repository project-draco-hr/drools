{
  final PackageBuilder builder=new PackageBuilder();
  final PackageDescr packageDescr=new PackageDescr("p1");
  final QueryDescr queryDescr=new QueryDescr("query1");
  queryDescr.setParameters(new String[]{"$type"});
  queryDescr.setParameterTypes(new String[]{"String"});
  packageDescr.addRule(queryDescr);
  final AndDescr lhs=new AndDescr();
  queryDescr.setLhs(lhs);
  final PatternDescr pattern=new PatternDescr(Cheese.class.getName(),"stilton");
  lhs.addDescr(pattern);
  final FieldConstraintDescr literalDescr=new FieldConstraintDescr("type");
  literalDescr.addRestriction(new VariableRestrictionDescr("==","$type"));
  pattern.addConstraint(literalDescr);
  QueryDescr queryDescr2=new QueryDescr("query2");
  queryDescr2.setParameters(new String[]{});
  queryDescr2.setParameterTypes(new String[]{});
  packageDescr.addRule(queryDescr2);
  AndDescr lhs2=new AndDescr();
  queryDescr2.setLhs(lhs2);
  PatternDescr pattern2=new PatternDescr(Cheese.class.getName());
  lhs2.addDescr(pattern2);
  builder.addPackage(packageDescr);
  assertLength(0,builder.getErrors().getErrors());
  RuleBase ruleBase=RuleBaseFactory.newRuleBase();
  ruleBase.addPackage(builder.getPackage());
  StatefulSession session=ruleBase.newStatefulSession();
  session.insert(new Cheese("stilton",15));
  QueryResults results=session.getQueryResults("query1","stilton");
  assertEquals(1,results.size());
  Object object=results.get(0).get(0);
  assertEquals(new Cheese("stilton",15),object);
  results=session.getQueryResults("query1",new Object[]{"cheddar"});
  assertEquals(0,results.size());
  session.insert(new Cheese("dolcelatte",20));
  results=session.getQueryResults("query2",new Object[]{});
  assertEquals(2,results.size());
}
