{
  final PackageBuilder builder=new PackageBuilder();
  final PackageDescr packageDescr=new PackageDescr("p1");
  QueryDescr queryDescr=new QueryDescr("query1");
  queryDescr.setParameters(new String[]{"$name","$age","$likes"});
  queryDescr.setParameterTypes(new String[]{"String","int","String"});
  packageDescr.addRule(queryDescr);
  AndDescr lhs=new AndDescr();
  queryDescr.setLhs(lhs);
  PatternDescr pattern=new PatternDescr(Person.class.getName());
  lhs.addDescr(pattern);
  FieldConstraintDescr literalDescr=new FieldConstraintDescr("name");
  literalDescr.addRestriction(new VariableRestrictionDescr("==","$name"));
  pattern.addConstraint(literalDescr);
  literalDescr=new FieldConstraintDescr("age");
  literalDescr.addRestriction(new VariableRestrictionDescr("==","$age"));
  pattern.addConstraint(literalDescr);
  literalDescr=new FieldConstraintDescr("likes");
  literalDescr.addRestriction(new VariableRestrictionDescr("==","$likes"));
  pattern.addConstraint(literalDescr);
  RuleDescr ruleDescr=new RuleDescr("rule-1");
  packageDescr.addRule(ruleDescr);
  lhs=new AndDescr();
  ruleDescr.setLhs(lhs);
  pattern=new PatternDescr(Cheese.class.getName());
  lhs.addDescr(pattern);
  pattern.addConstraint(new FieldBindingDescr("type","$type"));
  pattern=new PatternDescr("query1");
  lhs.addDescr(pattern);
  pattern.addConstraint(new LiteralDescr("bobba",LiteralDescr.TYPE_STRING));
  pattern.addConstraint(new VariableDescr("$age"));
  pattern.addConstraint(new VariableDescr("$type"));
  ruleDescr.setConsequence("System.out.println(\"age: \" + $age);");
  builder.addPackage(packageDescr);
  assertLength(0,builder.getErrors().getErrors());
  RuleBase rbase=RuleBaseFactory.newRuleBase();
  rbase.addPackage(builder.getPackage());
  StatefulSession session=rbase.newStatefulSession();
  session.insert(new Person("bobba","stilton",90));
  session.insert(new Person("bobba","brie",80));
  session.insert(new Person("bobba","brie",75));
  session.insert(new Person("darth","brie",100));
  session.insert(new Person("luke","brie",25));
  session.insert(new Cheese("brie",25));
  session.fireAllRules();
}
