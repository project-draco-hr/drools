{
  final PackageBuilder builder=new PackageBuilder();
  builder.addPackageFromDrl(new InputStreamReader(getClass().getResourceAsStream("test_RemovePackage.drl")));
  RuleBase ruleBase=getRuleBase();
  final String packageName=builder.getPackage().getName();
  ruleBase.addPackage(SerializationHelper.serializeObject(builder.getPackage()));
  ruleBase=SerializationHelper.serializeObject(ruleBase);
  StatefulSession session=ruleBase.newStatefulSession();
  session.insert(new Precondition("genericcode","genericvalue"));
  session.fireAllRules();
  RuleBase ruleBaseWM=session.getRuleBase();
  ruleBaseWM.removePackage(packageName);
  final PackageBuilder builder1=new PackageBuilder();
  builder1.addPackageFromDrl(new InputStreamReader(getClass().getResourceAsStream("test_RemovePackage.drl")));
  ruleBaseWM.addPackage(SerializationHelper.serializeObject(builder1.getPackage()));
  ruleBaseWM=SerializationHelper.serializeObject(ruleBaseWM);
  session=SerializationHelper.getSerialisedStatefulSession(session,ruleBase);
  session.fireAllRules();
  ruleBaseWM.removePackage(packageName);
  ruleBaseWM.addPackage(SerializationHelper.serializeObject(builder1.getPackage()));
  ruleBaseWM.removePackage(packageName);
  ruleBaseWM.addPackage(SerializationHelper.serializeObject(builder1.getPackage()));
}
