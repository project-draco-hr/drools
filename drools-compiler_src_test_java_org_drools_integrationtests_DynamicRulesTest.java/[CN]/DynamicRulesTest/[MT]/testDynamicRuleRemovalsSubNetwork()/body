{
  final PackageBuilder builder=new PackageBuilder();
  builder.addPackageFromDrl(new InputStreamReader(getClass().getResourceAsStream("test_DynamicRulesWithSubnetwork1.drl")));
  builder.addPackageFromDrl(new InputStreamReader(getClass().getResourceAsStream("test_DynamicRulesWithSubnetwork.drl")));
  final Package pkg=serialisePackage(builder.getPackage());
  org.drools.reteoo.ReteooRuleBase reteooRuleBase=null;
  final RuleBase ruleBase=getRuleBase();
  reteooRuleBase=(org.drools.reteoo.ReteooRuleBase)ruleBase;
  ruleBase.addPackage(pkg);
  final PackageBuilder builder2=new PackageBuilder();
  builder2.addPackageFromDrl(new InputStreamReader(getClass().getResourceAsStream("test_DynamicRulesWithSubnetwork2.drl")));
  ruleBase.addPackage(serialisePackage(builder2.getPackage()));
  final WorkingMemory workingMemory=ruleBase.newStatefulSession();
  final List list=new ArrayList();
  workingMemory.setGlobal("results",list);
  Order order=new Order();
  OrderItem item1=new OrderItem(order,1,"Adventure Guide Brazil",OrderItem.TYPE_BOOK,24);
  order.addItem(item1);
  workingMemory.insert(item1);
  OrderItem item2=new OrderItem(order,2,"Prehistoric Britain",OrderItem.TYPE_BOOK,15);
  order.addItem(item2);
  workingMemory.insert(item2);
  OrderItem item3=new OrderItem(order,3,"Holiday Music",OrderItem.TYPE_CD,9);
  order.addItem(item3);
  workingMemory.insert(item3);
  OrderItem item4=new OrderItem(order,4,"Very Best of Mick Jagger",OrderItem.TYPE_CD,11);
  order.addItem(item4);
  workingMemory.insert(item4);
  workingMemory.insert(order);
  assertEquals(11,workingMemory.getAgenda().getActivations().length);
  reteooRuleBase.removeRule("org.drools","Apply Discount on all books");
  assertEquals(10,workingMemory.getAgenda().getActivations().length);
  reteooRuleBase.removeRule("org.drools","like book");
  final OrderItem item5=new OrderItem(order,5,"Sinatra : Vegas",OrderItem.TYPE_CD,5);
  assertEquals(8,workingMemory.getAgenda().getActivations().length);
  workingMemory.insert(item5);
  assertEquals(10,workingMemory.getAgenda().getActivations().length);
  reteooRuleBase.removePackage("org.drools");
  assertEquals(0,workingMemory.getAgenda().getActivations().length);
}
