{
  Collection<KnowledgePackage> kpkgs=SerializationHelper.serializeObject(loadKnowledgePackages("test_DynamicRulesWithSubnetwork1.drl","test_DynamicRulesWithSubnetwork.drl"));
  KnowledgeBase kbase=loadKnowledgeBase();
  kbase.addKnowledgePackages(kpkgs);
  kpkgs=SerializationHelper.serializeObject(loadKnowledgePackages("test_DynamicRulesWithSubnetwork2.drl"));
  kbase.addKnowledgePackages(kpkgs);
  StatefulKnowledgeSession session=createKnowledgeSession(kbase);
  final List<?> list=new ArrayList<Object>();
  session.setGlobal("results",list);
  Order order=new Order();
  OrderItem item1=new OrderItem(order,1,"Adventure Guide Brazil",OrderItem.TYPE_BOOK,24);
  order.addItem(item1);
  session.insert(item1);
  OrderItem item2=new OrderItem(order,2,"Prehistoric Britain",OrderItem.TYPE_BOOK,15);
  order.addItem(item2);
  session.insert(item2);
  OrderItem item3=new OrderItem(order,3,"Holiday Music",OrderItem.TYPE_CD,9);
  order.addItem(item3);
  session.insert(item3);
  OrderItem item4=new OrderItem(order,4,"Very Best of Mick Jagger",OrderItem.TYPE_CD,11);
  order.addItem(item4);
  session.insert(item4);
  session.insert(order);
  assertEquals(11,getInternalAgenda(session).getActivations().length);
  kbase.removeRule("org.kie","Apply Discount on all books");
  assertEquals(10,getInternalAgenda(session).getActivations().length);
  kbase.removeRule("org.kie","like book");
  final OrderItem item5=new OrderItem(order,5,"Sinatra : Vegas",OrderItem.TYPE_CD,5);
  assertEquals(8,getInternalAgenda(session).getActivations().length);
  session.insert(item5);
  assertEquals(10,getInternalAgenda(session).getActivations().length);
  kbase.removeKnowledgePackage("org.kie");
  assertEquals(0,getInternalAgenda(session).getActivations().length);
}
