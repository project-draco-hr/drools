{
  PackageBuilderConfiguration configuration=packageBuilder.getPackageBuilderConfiguration();
  XmlProcessReader xmlReader=new XmlProcessReader(configuration.getSemanticModules());
  final ClassLoader oldLoader=Thread.currentThread().getContextClassLoader();
  final ClassLoader newLoader=this.getClass().getClassLoader();
  try {
    Thread.currentThread().setContextClassLoader(newLoader);
    String portRuleFlow=System.getProperty("drools.ruleflow.port","false");
    Reader portedReader=null;
    if (portRuleFlow.equalsIgnoreCase("true")) {
      portedReader=portToCurrentVersion(reader);
    }
 else {
      portedReader=reader;
    }
    Process process=xmlReader.read(portedReader);
    if (process != null) {
      buildProcess(process,resource);
    }
 else {
      this.errors.add(new RuleFlowLoadError("unable to parse xml",null));
    }
  }
 catch (  FactoryConfigurationError e1) {
    this.errors.add(new RuleFlowLoadError("FactoryConfigurationError ",e1.getException()));
  }
catch (  Exception e2) {
    this.errors.add(new RuleFlowLoadError("unable to parse xml",e2));
  }
 finally {
    Thread.currentThread().setContextClassLoader(oldLoader);
  }
  reader.close();
}
