{
  PackageBuilder builder=new PackageBuilder();
  PackageDescr pkgDescr=new PackageDescr("org.test");
  builder.addPackage(pkgDescr);
  final Field dialectField=builder.getClass().getDeclaredField("dialect");
  dialectField.setAccessible(true);
  JavaDialect dialect=(JavaDialect)dialectField.get(builder);
  final Field compilerField=dialect.getClass().getDeclaredField("compiler");
  compilerField.setAccessible(true);
  JavaCompiler compiler=(JavaCompiler)compilerField.get(dialect);
  assertSame(EclipseJavaCompiler.class,compiler.getClass());
  PackageBuilderConfiguration conf=new PackageBuilderConfiguration();
  JavaDialectConfiguration javaConf=(JavaDialectConfiguration)conf.getDialectConfiguration("java");
  javaConf.setCompiler(JavaDialectConfiguration.JANINO);
  builder=new PackageBuilder(conf);
  builder.addPackage(pkgDescr);
  dialect=(JavaDialect)dialectField.get(builder);
  compiler=(JavaCompiler)compilerField.get(dialect);
  assertSame(JaninoJavaCompiler.class,compiler.getClass());
  conf=new PackageBuilderConfiguration();
  javaConf=(JavaDialectConfiguration)conf.getDialectConfiguration("java");
  javaConf.setCompiler(JavaDialectConfiguration.ECLIPSE);
  builder=new PackageBuilder(conf);
  builder.addPackage(pkgDescr);
  dialect=(JavaDialect)dialectField.get(builder);
  compiler=(JavaCompiler)compilerField.get(dialect);
  assertSame(EclipseJavaCompiler.class,compiler.getClass());
}
