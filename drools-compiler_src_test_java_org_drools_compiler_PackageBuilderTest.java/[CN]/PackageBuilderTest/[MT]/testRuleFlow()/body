{
  PackageBuilder builder=new PackageBuilder();
  InputStream in=this.getClass().getResourceAsStream("/org/drools/integrationtests/ruleflow.rfm");
  assertNotNull(in);
  builder.addPackage(new PackageDescr("com.sample"));
  builder.addRuleFlow(new InputStreamReader(in));
  Package pkg=builder.getPackage();
  assertNotNull(pkg);
  Map flows=pkg.getRuleFlows();
  assertNotNull(flows);
  assertEquals(1,flows.size());
  assertTrue(flows.containsKey("0"));
  Process p=(Process)flows.get("0");
  assertTrue(p instanceof RuleFlowProcessImpl);
  ByteArrayOutputStream data=new ByteArrayOutputStream();
  ObjectOutputStream out=new ObjectOutputStream(data);
  out.writeObject(pkg);
  ObjectInputStream objIn=new DroolsObjectInputStream(new ByteArrayInputStream(data.toByteArray()));
  Package pkg2=(Package)objIn.readObject();
  assertNotNull(pkg2);
  flows=pkg2.getRuleFlows();
  assertNotNull(flows);
  assertEquals(1,flows.size());
  assertTrue(flows.containsKey("0"));
  p=(Process)flows.get("0");
  assertTrue(p instanceof RuleFlowProcessImpl);
}
