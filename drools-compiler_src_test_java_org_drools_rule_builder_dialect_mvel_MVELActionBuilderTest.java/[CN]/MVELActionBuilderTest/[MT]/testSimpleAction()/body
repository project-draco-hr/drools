{
  final Package pkg=new Package("pkg1");
  ActionDescr actionDescr=new ActionDescr();
  actionDescr.setText("list.add( 'hello world' )");
  PackageBuilder pkgBuilder=new PackageBuilder(pkg);
  final PackageBuilderConfiguration conf=pkgBuilder.getPackageBuilderConfiguration();
  DialectCompiletimeRegistry dialectRegistry=pkgBuilder.getPackageRegistry(pkg.getName()).getDialectCompiletimeRegistry();
  MVELDialect mvelDialect=(MVELDialect)dialectRegistry.getDialect("mvel");
  PackageBuildContext context=new PackageBuildContext();
  context.init(pkgBuilder,pkg,null,dialectRegistry,mvelDialect,null);
  pkgBuilder.addPackageFromDrl(new StringReader("package pkg1;\nglobal java.util.List list;\n"));
  ActionNode actionNode=new ActionNode();
  DroolsAction action=new DroolsConsequenceAction("mvel",null);
  actionNode.setAction(action);
  final MVELActionBuilder builder=new MVELActionBuilder();
  builder.build(context,action,actionDescr,actionNode);
  final RuleBase ruleBase=RuleBaseFactory.newRuleBase();
  ruleBase.addPackage(pkgBuilder.getPackage());
  final WorkingMemory wm=ruleBase.newStatefulSession();
  List list=new ArrayList();
  wm.setGlobal("list",list);
  ((MVELAction)actionNode.getAction().getMetaData("Action")).compile(Thread.currentThread().getContextClassLoader());
  KnowledgeHelper knowledgeHelper=new DefaultKnowledgeHelper();
  ((Action)actionNode.getAction().getMetaData("Action")).execute(knowledgeHelper,wm,null);
  assertEquals("hello world",list.get(0));
}
