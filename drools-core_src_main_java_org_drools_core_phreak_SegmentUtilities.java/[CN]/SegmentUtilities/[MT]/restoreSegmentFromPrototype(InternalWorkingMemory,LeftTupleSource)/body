{
  SegmentMemory smem=((ReteooRuleBase)wm.getRuleBase()).getSegmentFromPrototype(wm,segmentRoot);
  if (smem != null) {
    for (    NetworkNode node : smem.getNodesInSegment()) {
      wm.getNodeMemory((MemoryFactory)node).setSegmentMemory(smem);
    }
    updateRiaAndTerminalMemory(segmentRoot,segmentRoot,smem,wm,true);
  }
  return smem;
}
