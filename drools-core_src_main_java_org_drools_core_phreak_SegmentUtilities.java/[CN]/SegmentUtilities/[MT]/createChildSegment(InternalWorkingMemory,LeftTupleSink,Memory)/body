{
  if (!(NodeTypeEnums.isTerminalNode(sink) || sink.getType() == NodeTypeEnums.RightInputAdaterNode)) {
    if (memory.getSegmentMemory() == null) {
      SegmentUtilities.createSegmentMemory((LeftTupleSource)sink,wm);
    }
  }
 else {
    if (memory.getSegmentMemory() == null) {
      SegmentMemory childSmem=new SegmentMemory(sink);
      PathMemory pmem;
      if (NodeTypeEnums.isTerminalNode(sink)) {
        pmem=(PathMemory)memory;
      }
 else {
        pmem=((RiaNodeMemory)memory).getRiaPathMemory();
      }
      pmem.setSegmentMemory(pmem.getSegmentMemories().length - 1,childSmem);
      pmem.setSegmentMemory(childSmem);
      childSmem.addPathMemory(pmem);
      childSmem.setTipNode(sink);
    }
  }
  return memory.getSegmentMemory();
}
