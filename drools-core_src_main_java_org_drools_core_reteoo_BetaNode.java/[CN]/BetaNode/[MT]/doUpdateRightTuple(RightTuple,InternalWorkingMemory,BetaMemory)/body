{
  RightTupleSets stagedRightTuples=memory.getStagedRightTuples();
  if (stagedRightTuples.updateSize() == 0 || stagedRightTuples.insertSize() == 0) {
    memory.getSegmentMemory().notifyRuleLinkSegment(wm);
  }
  RightTuple updateFirst=memory.getStagedRightTuples().getUpdateFirst();
  if (!memory.getDequeu().isEmpty() || (streamMode && updateFirst != null && updateFirst.getPropagationContext() != rightTuple.getPropagationContext())) {
    memory.getDequeu().add(rightTuple);
  }
 else   if (rightTuple.getStagedType() == LeftTuple.NONE) {
    memory.getStagedRightTuples().addUpdate(rightTuple);
  }
}
