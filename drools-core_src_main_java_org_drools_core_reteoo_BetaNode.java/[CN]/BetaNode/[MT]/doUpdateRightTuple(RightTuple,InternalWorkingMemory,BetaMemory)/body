{
  RightTupleSets stagedRightTuples=memory.getStagedRightTuples();
  boolean stagedUpdateWasEmpty=false;
  if (streamMode) {
    stagedUpdateWasEmpty=memory.getSegmentMemory().getTupleQueue().isEmpty();
    PropagationContext pctx=rightTuple.getPropagationContext();
    memory.getSegmentMemory().getTupleQueue().add(new RightTupleEntry(rightTuple,pctx,memory,pctx.getType()));
  }
 else {
    stagedUpdateWasEmpty=stagedRightTuples.addUpdate(rightTuple);
  }
  if (stagedUpdateWasEmpty) {
    memory.setNodeDirty(wm);
  }
}
