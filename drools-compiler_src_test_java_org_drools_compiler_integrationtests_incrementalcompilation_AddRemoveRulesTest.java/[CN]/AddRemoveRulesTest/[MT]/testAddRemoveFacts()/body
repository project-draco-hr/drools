{
  final String rule1=" package " + PKG_NAME_TEST + ";\n"+ " global java.util.List list\n"+ " rule "+ RULE1_NAME+ " \n"+ " when \n"+ "   Integer() \n"+ "   not(not(Integer() and Integer())) \n"+ " then\n"+ "   list.add('"+ RULE1_NAME+ "'); \n"+ " end";
  final String rule2=" package " + PKG_NAME_TEST + ";\n"+ " global java.util.List list\n"+ " rule "+ RULE2_NAME+ " \n"+ " when \n"+ "   Integer() \n"+ "   exists(Integer() and Integer()) \n"+ " then\n"+ "   list.add('"+ RULE2_NAME+ "'); \n"+ " end";
  final String rule3=" package " + PKG_NAME_TEST + ";\n"+ " global java.util.List list\n"+ " rule "+ RULE3_NAME+ " \n"+ " when \n"+ "   Integer() \n"+ "   exists(Integer() and Integer()) \n"+ "   String() \n"+ " then\n"+ "   list.add('"+ RULE3_NAME+ "'); \n"+ " end";
  final List resultsList=new ArrayList();
  final Map<String,Object> globals=new HashMap<String,Object>();
  globals.put("list",resultsList);
  final TestContext context=new TestContext(PKG_NAME_TEST,globals,resultsList);
  final AddRemoveTestBuilder builder=new AddRemoveTestBuilder();
  builder.addOperation(TestOperationType.CREATE_SESSION,new String[]{rule1,rule2,rule3}).addOperation(TestOperationType.INSERT_FACTS,new Object[]{1,"1"});
  context.executeTestOperations(builder.build());
  builder.clear();
  final Set<FactHandle> sessionFacts=context.getActualSessionFactHandles();
  builder.addOperation(TestOperationType.FIRE_RULES).addOperation(TestOperationType.CHECK_RESULTS,new String[]{RULE1_NAME,RULE2_NAME,RULE3_NAME}).addOperation(TestOperationType.REMOVE_RULES,new String[]{RULE1_NAME,RULE2_NAME}).addOperation(TestOperationType.ADD_RULES,new String[]{rule1,rule2}).addOperation(TestOperationType.REMOVE_FACTS,sessionFacts.toArray(new FactHandle[]{})).addOperation(TestOperationType.FIRE_RULES).addOperation(TestOperationType.CHECK_RESULTS,new String[]{});
  context.executeTestOperations(builder.build());
}
