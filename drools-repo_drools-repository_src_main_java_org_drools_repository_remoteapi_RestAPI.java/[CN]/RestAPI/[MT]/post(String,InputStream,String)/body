{
  String[] bits=split(path);
  if (bits[0].equals("packages")) {
    String fileName=bits[2];
    String[] a=fileName.split("\\.");
    if (a[1].equals("package")) {
      PackageItem pkg=repo.createPackage(bits[1],"<added remotely>");
      pkg.updateCheckinComment(comment);
      pkg.updateStringProperty(readContent(in),PackageItem.HEADER_PROPERTY_NAME);
      repo.save();
    }
 else {
      PackageItem pkg=repo.loadPackage(bits[1]);
      AssetItem asset;
      if (pkg.containsAsset(a[0])) {
        asset=pkg.loadAsset(a[0]);
        if (asset.isArchived()) {
          asset.archiveItem(false);
        }
 else {
          throw new RulesRepositoryException("The file " + path + " already exists, and was not archived.");
        }
        if (asset.isBinary()) {
          asset.updateBinaryContentAttachment(in);
        }
 else {
          asset.updateContent(readContent(in));
        }
      }
 else {
        asset=pkg.addAsset(a[0],"<added remotely>");
        asset.updateFormat(a[1]);
        if (TEXT_ASSET_TYPES.containsKey(a[1])) {
          asset.updateContent(readContent(in));
        }
 else {
          asset.updateBinaryContentAttachment(in);
        }
      }
      asset.checkin(comment);
    }
  }
 else {
    throw new IllegalArgumentException("Unknown rest path for post.");
  }
}
