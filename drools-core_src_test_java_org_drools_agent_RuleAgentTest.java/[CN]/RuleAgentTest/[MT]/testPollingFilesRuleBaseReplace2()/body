{
  File dir=RuleBaseAssemblerTest.getTempDirectory();
  Package p1=new Package("p1");
  File p1f=new File(dir,"p43_.pkg");
  RuleBaseAssemblerTest.writePackage(p1,p1f);
  Package p2=new Package("p2");
  File p2f=new File(dir,"p44_.pkg");
  RuleBaseAssemblerTest.writePackage(p2,p2f);
  String path=dir.getPath() + "/" + "p43_.pkg "+ dir.getPath()+ "/p44_.pkg";
  Properties props=new Properties();
  props.setProperty("file",path);
  props.setProperty("newInstance","true");
  props.setProperty("poll","1");
  KnowledgeAgent kagent=KnowledgeAgentFactory.newKnowledgeAgent("agent1",props);
  KnowledgeBase kbase=kagent.getKnowledgeBase();
  assertEquals(2,kbase.getKnowledgePackages().size());
  KnowledgeBase kbase_=kagent.getKnowledgeBase();
  assertSame(kbase,kbase_);
  RuleBaseAssemblerTest.writePackage(p1,p1f);
  int i=0;
  while (i < 10 && kagent.getKnowledgeBase() == kbase) {
    Thread.sleep(500);
    i++;
  }
  kbase_=kagent.getKnowledgeBase();
  assertNotSame(kbase,kbase_);
  assertEquals(2,kbase.getKnowledgePackages().size());
}
