{
  final ParserContext parserContext=new ParserContext(getClassImportResolverFactory().getImportedClasses(),null,null);
  parserContext.setStrictTypeEnforcement(true);
  if (interceptors != null) {
    parserContext.setInterceptors(interceptors);
  }
  List list[]=analysis.getBoundIdentifiers();
  DeclarationScopeResolver resolver=context.getDeclarationResolver();
  for (Iterator it=list[0].iterator(); it.hasNext(); ) {
    String identifier=(String)it.next();
    Class cls=resolver.getDeclaration(identifier).getExtractor().getExtractToClass();
    parserContext.addInput(identifier,cls);
  }
  Map globalTypes=context.getPkg().getGlobals();
  for (Iterator it=list[1].iterator(); it.hasNext(); ) {
    String identifier=(String)it.next();
    parserContext.addInput(identifier,(Class)globalTypes.get(identifier));
  }
  parserContext.addInput("drools",KnowledgeHelper.class);
  ExpressionCompiler compiler=new ExpressionCompiler(text);
  Serializable expr=compiler.compile(parserContext);
  return expr;
}
