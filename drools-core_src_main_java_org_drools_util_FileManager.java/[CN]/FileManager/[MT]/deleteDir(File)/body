{
  if (dir.isDirectory()) {
    String[] children=dir.list();
    for (    String child : children) {
      File file=new File(dir,child);
      boolean success=deleteDir(file);
      if (!success) {
        System.gc();
        try {
          Thread.sleep(250);
        }
 catch (        InterruptedException e) {
          throw new RuntimeException("This should never happen");
        }
        success=deleteDir(file);
        if (!success) {
          return false;
        }
      }
    }
  }
  return dir.delete();
}
