{
  final MethodVisitor mv=cw.visitMethod(Opcodes.ACC_PUBLIC,ShadowProxyFactory.UPDATE_PROXY,Type.getMethodDescriptor(Type.VOID_TYPE,new Type[]{}),null,null);
  mv.visitCode();
  final Label l0=new Label();
  mv.visitLabel(l0);
  for (final Iterator it=fieldTypes.entrySet().iterator(); it.hasNext(); ) {
    final Map.Entry entry=(Map.Entry)it.next();
    final String fieldName=(String)entry.getKey();
    final Class fieldType=(Class)entry.getValue();
    final Method method=(Method)fieldMethods.get(fieldName);
    final Label l1=new Label();
    mv.visitLabel(l1);
    mv.visitVarInsn(Opcodes.ALOAD,0);
    mv.visitVarInsn(Opcodes.ALOAD,0);
    mv.visitFieldInsn(Opcodes.GETFIELD,className,ShadowProxyFactory.DELEGATE_FIELD_NAME,Type.getDescriptor(delegate));
    if (delegate.isInterface()) {
      mv.visitMethodInsn(Opcodes.INVOKEINTERFACE,Type.getInternalName(delegate),method.getName(),Type.getMethodDescriptor(method));
    }
 else {
      mv.visitMethodInsn(Opcodes.INVOKEVIRTUAL,Type.getInternalName(delegate),method.getName(),Type.getMethodDescriptor(method));
    }
    mv.visitFieldInsn(Opcodes.PUTFIELD,className,fieldName,Type.getDescriptor(fieldType));
  }
  final Label l4=new Label();
  mv.visitLabel(l4);
  mv.visitInsn(Opcodes.RETURN);
  final Label l5=new Label();
  mv.visitLabel(l5);
  mv.visitLocalVariable("this","L" + className + ";",null,l0,l5,0);
  mv.visitMaxs(0,0);
  mv.visitEnd();
}
