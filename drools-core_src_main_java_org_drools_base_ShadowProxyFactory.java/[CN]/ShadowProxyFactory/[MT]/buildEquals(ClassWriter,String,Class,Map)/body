{
  MethodVisitor mv;
{
    mv=cw.visitMethod(Opcodes.ACC_PUBLIC,"equals",Type.getMethodDescriptor(Type.BOOLEAN_TYPE,new Type[]{Type.getType(Object.class)}),null,null);
    mv.visitCode();
    final Label l0=new Label();
    mv.visitLabel(l0);
    mv.visitVarInsn(Opcodes.ALOAD,0);
    mv.visitVarInsn(Opcodes.ALOAD,1);
    final Label l1=new Label();
    mv.visitJumpInsn(Opcodes.IF_ACMPEQ,l1);
    mv.visitVarInsn(Opcodes.ALOAD,0);
    mv.visitFieldInsn(Opcodes.GETFIELD,className,DELEGATE_FIELD_NAME,Type.getDescriptor(clazz));
    mv.visitVarInsn(Opcodes.ALOAD,1);
    mv.visitJumpInsn(Opcodes.IF_ACMPEQ,l1);
    mv.visitVarInsn(Opcodes.ALOAD,0);
    mv.visitFieldInsn(Opcodes.GETFIELD,className,DELEGATE_FIELD_NAME,Type.getDescriptor(clazz));
    mv.visitVarInsn(Opcodes.ALOAD,1);
    if (clazz.isInterface()) {
      mv.visitMethodInsn(Opcodes.INVOKEINTERFACE,Type.getInternalName(clazz),"equals",Type.getMethodDescriptor(Type.BOOLEAN_TYPE,new Type[]{Type.getType(Object.class)}));
    }
 else {
      mv.visitMethodInsn(Opcodes.INVOKEVIRTUAL,Type.getInternalName(clazz),"equals",Type.getMethodDescriptor(Type.BOOLEAN_TYPE,new Type[]{Type.getType(Object.class)}));
    }
    Label l2=new Label();
    mv.visitJumpInsn(Opcodes.IFEQ,l2);
    mv.visitLabel(l1);
    mv.visitInsn(Opcodes.ICONST_1);
    mv.visitInsn(Opcodes.IRETURN);
    mv.visitLabel(l2);
    mv.visitVarInsn(Opcodes.ALOAD,1);
    final Label l3=new Label();
    mv.visitJumpInsn(Opcodes.IFNULL,l3);
    mv.visitVarInsn(Opcodes.ALOAD,1);
    mv.visitTypeInsn(Opcodes.INSTANCEOF,Type.getInternalName(clazz));
    final Label l4=new Label();
    mv.visitJumpInsn(Opcodes.IFNE,l4);
    mv.visitLabel(l3);
    mv.visitInsn(Opcodes.ICONST_0);
    mv.visitInsn(Opcodes.IRETURN);
    mv.visitLabel(l4);
    Label c0=new Label();
    mv.visitLabel(c0);
    mv.visitVarInsn(Opcodes.ALOAD,1);
    mv.visitTypeInsn(Opcodes.INSTANCEOF,className);
    Label c1=new Label();
    mv.visitJumpInsn(Opcodes.IFEQ,c1);
    mv.visitVarInsn(Opcodes.ALOAD,0);
    mv.visitFieldInsn(Opcodes.GETFIELD,className,DELEGATE_FIELD_NAME,Type.getDescriptor(clazz));
    mv.visitVarInsn(Opcodes.ALOAD,1);
    mv.visitTypeInsn(Opcodes.CHECKCAST,className);
    mv.visitFieldInsn(Opcodes.GETFIELD,className,DELEGATE_FIELD_NAME,Type.getDescriptor(clazz));
    Label c2=new Label();
    mv.visitJumpInsn(Opcodes.IF_ACMPEQ,c2);
    mv.visitVarInsn(Opcodes.ALOAD,0);
    mv.visitFieldInsn(Opcodes.GETFIELD,className,DELEGATE_FIELD_NAME,Type.getDescriptor(clazz));
    mv.visitVarInsn(Opcodes.ALOAD,1);
    mv.visitTypeInsn(Opcodes.CHECKCAST,className);
    mv.visitFieldInsn(Opcodes.GETFIELD,className,DELEGATE_FIELD_NAME,Type.getDescriptor(clazz));
    if (clazz.isInterface()) {
      mv.visitMethodInsn(Opcodes.INVOKEINTERFACE,Type.getInternalName(clazz),"equals",Type.getMethodDescriptor(Type.BOOLEAN_TYPE,new Type[]{Type.getType(Object.class)}));
    }
 else {
      mv.visitMethodInsn(Opcodes.INVOKEVIRTUAL,Type.getInternalName(clazz),"equals",Type.getMethodDescriptor(Type.BOOLEAN_TYPE,new Type[]{Type.getType(Object.class)}));
    }
    mv.visitJumpInsn(Opcodes.IFEQ,c1);
    mv.visitLabel(c2);
    mv.visitInsn(Opcodes.ICONST_1);
    mv.visitInsn(Opcodes.IRETURN);
    mv.visitLabel(c1);
    mv.visitVarInsn(Opcodes.ALOAD,1);
    mv.visitTypeInsn(Opcodes.CHECKCAST,Type.getInternalName(clazz));
    mv.visitVarInsn(Opcodes.ASTORE,2);
    int count=0;
    for (final Iterator it=fieldTypes.entrySet().iterator(); it.hasNext(); ) {
      final Map.Entry entry=(Map.Entry)it.next();
      final String fieldName=(String)entry.getKey();
      final Method method=(Method)entry.getValue();
      final Class fieldType=method.getReturnType();
      final String fieldFlag=fieldName + ShadowProxyFactory.FIELD_SET_FLAG;
      count++;
      final Label goNext=new Label();
      final Label l5=new Label();
      mv.visitLabel(l5);
      mv.visitVarInsn(Opcodes.ALOAD,0);
      mv.visitFieldInsn(Opcodes.GETFIELD,className,fieldFlag,Type.BOOLEAN_TYPE.getDescriptor());
      final Label l6=new Label();
      mv.visitJumpInsn(Opcodes.IFNE,l6);
      final Label l7=new Label();
      mv.visitLabel(l7);
      mv.visitVarInsn(Opcodes.ALOAD,0);
      mv.visitVarInsn(Opcodes.ALOAD,0);
      mv.visitFieldInsn(Opcodes.GETFIELD,className,ShadowProxyFactory.DELEGATE_FIELD_NAME,Type.getDescriptor(clazz));
      if (clazz.isInterface()) {
        mv.visitMethodInsn(Opcodes.INVOKEINTERFACE,Type.getInternalName(clazz),method.getName(),Type.getMethodDescriptor(method));
      }
 else {
        mv.visitMethodInsn(Opcodes.INVOKEVIRTUAL,Type.getInternalName(clazz),method.getName(),Type.getMethodDescriptor(method));
      }
      mv.visitFieldInsn(Opcodes.PUTFIELD,className,fieldName,Type.getDescriptor(fieldType));
      final Label l8=new Label();
      mv.visitLabel(l8);
      mv.visitVarInsn(Opcodes.ALOAD,0);
      mv.visitInsn(Opcodes.ICONST_1);
      mv.visitFieldInsn(Opcodes.PUTFIELD,className,fieldFlag,Type.BOOLEAN_TYPE.getDescriptor());
      mv.visitLabel(l6);
      if (fieldType.isPrimitive()) {
        mv.visitVarInsn(Opcodes.ALOAD,0);
        mv.visitFieldInsn(Opcodes.GETFIELD,className,fieldName,Type.getDescriptor(fieldType));
        mv.visitVarInsn(Opcodes.ALOAD,2);
        if (clazz.isInterface()) {
          mv.visitMethodInsn(Opcodes.INVOKEINTERFACE,Type.getInternalName(clazz),method.getName(),Type.getMethodDescriptor(method));
        }
 else {
          mv.visitMethodInsn(Opcodes.INVOKEVIRTUAL,Type.getInternalName(clazz),method.getName(),Type.getMethodDescriptor(method));
        }
        if (fieldType.equals(Long.TYPE)) {
          mv.visitInsn(Opcodes.LCMP);
          mv.visitJumpInsn(Opcodes.IFEQ,goNext);
        }
 else         if (fieldType.equals(Double.TYPE)) {
          mv.visitInsn(Opcodes.DCMPL);
          mv.visitJumpInsn(Opcodes.IFEQ,goNext);
        }
 else         if (fieldType.equals(Float.TYPE)) {
          mv.visitInsn(Opcodes.FCMPL);
          mv.visitJumpInsn(Opcodes.IFEQ,goNext);
        }
 else {
          mv.visitJumpInsn(Opcodes.IF_ICMPEQ,goNext);
        }
        mv.visitInsn(Opcodes.ICONST_0);
        mv.visitInsn(Opcodes.IRETURN);
      }
 else {
        mv.visitVarInsn(Opcodes.ALOAD,0);
        mv.visitFieldInsn(Opcodes.GETFIELD,className,fieldName,Type.getDescriptor(fieldType));
        final Label secondIfPart=new Label();
        mv.visitJumpInsn(Opcodes.IFNONNULL,secondIfPart);
        mv.visitVarInsn(Opcodes.ALOAD,2);
        if (clazz.isInterface()) {
          mv.visitMethodInsn(Opcodes.INVOKEINTERFACE,Type.getInternalName(clazz),method.getName(),Type.getMethodDescriptor(method));
        }
 else {
          mv.visitMethodInsn(Opcodes.INVOKEVIRTUAL,Type.getInternalName(clazz),method.getName(),Type.getMethodDescriptor(method));
        }
        final Label returnFalse=new Label();
        mv.visitJumpInsn(Opcodes.IFNONNULL,returnFalse);
        mv.visitLabel(secondIfPart);
        mv.visitVarInsn(Opcodes.ALOAD,0);
        mv.visitFieldInsn(Opcodes.GETFIELD,className,fieldName,Type.getDescriptor(fieldType));
        mv.visitJumpInsn(Opcodes.IFNULL,goNext);
        mv.visitVarInsn(Opcodes.ALOAD,0);
        mv.visitFieldInsn(Opcodes.GETFIELD,className,fieldName,Type.getDescriptor(fieldType));
        mv.visitVarInsn(Opcodes.ALOAD,2);
        if (clazz.isInterface()) {
          mv.visitMethodInsn(Opcodes.INVOKEINTERFACE,Type.getInternalName(clazz),method.getName(),Type.getMethodDescriptor(method));
        }
 else {
          mv.visitMethodInsn(Opcodes.INVOKEVIRTUAL,Type.getInternalName(clazz),method.getName(),Type.getMethodDescriptor(method));
        }
        if (fieldType.isInterface()) {
          mv.visitMethodInsn(Opcodes.INVOKEINTERFACE,Type.getInternalName(fieldType),"equals",Type.getMethodDescriptor(Type.BOOLEAN_TYPE,new Type[]{Type.getType(Object.class)}));
        }
 else {
          mv.visitMethodInsn(Opcodes.INVOKEVIRTUAL,Type.getInternalName(fieldType),"equals",Type.getMethodDescriptor(Type.BOOLEAN_TYPE,new Type[]{Type.getType(Object.class)}));
        }
        mv.visitJumpInsn(Opcodes.IFNE,goNext);
        mv.visitLabel(returnFalse);
        mv.visitInsn(Opcodes.ICONST_0);
        mv.visitInsn(Opcodes.IRETURN);
      }
      mv.visitLabel(goNext);
    }
    if (count > 0) {
      mv.visitInsn(Opcodes.ICONST_1);
    }
 else {
      mv.visitInsn(Opcodes.ICONST_0);
    }
    mv.visitInsn(Opcodes.IRETURN);
    final Label lastLabel=new Label();
    mv.visitLabel(lastLabel);
    mv.visitLocalVariable("this","L" + className + ";",null,l0,lastLabel,0);
    mv.visitLocalVariable("object",Type.getDescriptor(Object.class),null,l0,lastLabel,1);
    mv.visitLocalVariable("other",Type.getDescriptor(clazz),null,l0,lastLabel,2);
    mv.visitMaxs(0,0);
    mv.visitEnd();
  }
}
