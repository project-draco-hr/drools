{
  final String[] exceptions=getExceptionArrayAsString(method.getExceptionTypes());
  final MethodVisitor mv=cw.visitMethod(Opcodes.ACC_PUBLIC,method.getName(),Type.getMethodDescriptor(method),null,exceptions);
  mv.visitCode();
  final Label l0=new Label();
  mv.visitLabel(l0);
  mv.visitVarInsn(Opcodes.ALOAD,0);
  mv.visitFieldInsn(Opcodes.GETFIELD,className,ShadowProxyFactory.DELEGATE_FIELD_NAME,Type.getDescriptor(clazz));
  final Class[] parameters=method.getParameterTypes();
  for (int i=0, offset=1; i < parameters.length; i++) {
    Type type=Type.getType(parameters[i]);
    mv.visitVarInsn(type.getOpcode(Opcodes.ILOAD),offset);
    offset+=type.getSize();
  }
  if (clazz.isInterface()) {
    mv.visitMethodInsn(Opcodes.INVOKEINTERFACE,Type.getInternalName(clazz),method.getName(),Type.getMethodDescriptor(method));
  }
 else {
    mv.visitMethodInsn(Opcodes.INVOKEVIRTUAL,Type.getInternalName(clazz),method.getName(),Type.getMethodDescriptor(method));
  }
  mv.visitInsn(Type.getType(method.getReturnType()).getOpcode(Opcodes.IRETURN));
  final Label l1=new Label();
  mv.visitLabel(l1);
  mv.visitLocalVariable("this","L" + className + ";",null,l0,l1,0);
  for (int i=0, offset=0; i < parameters.length; i++) {
    mv.visitLocalVariable("arg" + i,Type.getDescriptor(parameters[i]),null,l0,l1,offset);
    offset+=Type.getType(parameters[i]).getSize();
  }
  mv.visitMaxs(0,0);
  mv.visitEnd();
}
