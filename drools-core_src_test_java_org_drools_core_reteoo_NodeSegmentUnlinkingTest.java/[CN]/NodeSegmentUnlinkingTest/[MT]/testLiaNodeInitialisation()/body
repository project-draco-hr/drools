{
  setUp(JOIN_NODE);
  KieBaseConfiguration kconf=KnowledgeBaseFactory.newKnowledgeBaseConfiguration();
  kconf.setOption(RuleEngineOption.PHREAK);
  AbstractWorkingMemory wm=new AbstractWorkingMemory(1,(ReteooRuleBase)RuleBaseFactory.newRuleBase((RuleBaseConfiguration)kconf));
  SegmentUtilities.createSegmentMemory(liaNode,wm);
  liaNode.assertObject((InternalFactHandle)wm.insert("str"),context,wm);
  LiaNodeMemory liaMem=(LiaNodeMemory)wm.getNodeMemory(liaNode);
  assertEquals(1,liaMem.getNodePosMaskBit());
  assertEquals(3,liaMem.getSegmentMemory().getAllLinkedMaskTest());
  BetaMemory bm1=(BetaMemory)wm.getNodeMemory(n1);
  assertEquals(2,bm1.getNodePosMaskBit());
  assertEquals(3,bm1.getSegmentMemory().getAllLinkedMaskTest());
  wm=new AbstractWorkingMemory(1,(ReteooRuleBase)RuleBaseFactory.newRuleBase((RuleBaseConfiguration)kconf));
  n1.assertObject((InternalFactHandle)wm.insert("str"),context,wm);
  liaMem=(LiaNodeMemory)wm.getNodeMemory(liaNode);
  assertEquals(1,liaMem.getNodePosMaskBit());
  assertEquals(3,liaMem.getSegmentMemory().getAllLinkedMaskTest());
  bm1=(BetaMemory)wm.getNodeMemory(n1);
  assertEquals(2,bm1.getNodePosMaskBit());
  assertEquals(3,bm1.getSegmentMemory().getAllLinkedMaskTest());
}
