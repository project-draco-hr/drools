{
  if (this.nodeRegistry == null) {
    this.nodeRegistry=new ProcessNodeInstanceFactoryRegistry();
  }
  ProcessNodeInstanceFactory conf=this.nodeRegistry.getRuleFlowNodeFactory(node);
  if (conf == null) {
    throw new IllegalArgumentException("Illegal node type: " + node.getClass());
  }
  RuleFlowNodeInstance nodeInstance=conf.getNodeInstance(node,this);
  if (nodeInstance == null) {
    throw new IllegalArgumentException("Illegal node type: " + node.getClass());
  }
  return nodeInstance;
}
