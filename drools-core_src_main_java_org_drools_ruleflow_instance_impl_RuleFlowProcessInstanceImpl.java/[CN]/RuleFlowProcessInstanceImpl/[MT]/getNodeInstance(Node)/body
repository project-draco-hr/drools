{
  ProcessNodeInstanceFactoryRegistry nodeRegistry=((InternalRuleBase)this.workingMemory.getRuleBase()).getConfiguration().getProcessNodeInstanceFactoryRegistry();
  ProcessNodeInstanceFactory conf=nodeRegistry.getRuleFlowNodeFactory(node);
  if (conf == null) {
    throw new IllegalArgumentException("Illegal node type: " + node.getClass());
  }
  RuleFlowNodeInstance nodeInstance=conf.getNodeInstance(node,this);
  if (nodeInstance == null) {
    throw new IllegalArgumentException("Illegal node type: " + node.getClass());
  }
  return nodeInstance;
}
