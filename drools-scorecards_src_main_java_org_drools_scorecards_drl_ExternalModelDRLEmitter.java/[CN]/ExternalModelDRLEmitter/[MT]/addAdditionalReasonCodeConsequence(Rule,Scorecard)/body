{
  if (!scorecard.isUseReasonCodes()) {
    return;
  }
  String externalClassName=null;
  String reasonCodesField=null;
  String fieldName=null;
  for (  Object obj : scorecard.getExtensionsAndCharacteristicsAndMiningSchemas()) {
    if (obj instanceof Output) {
      Output output=(Output)obj;
      final List<OutputField> outputFields=output.getOutputFields();
      final OutputField outputField=outputFields.get(0);
      externalClassName=ScorecardPMMLUtils.getExtension(outputField.getExtensions(),PMMLExtensionNames.SCORECARD_RESULTANT_SCORE_CLASS).getValue();
      fieldName=outputField.getName();
      Extension e=ScorecardPMMLUtils.getExtension(outputField.getExtensions(),PMMLExtensionNames.SCORECARD_RESULTANT_REASONCODES_FIELD);
      if (e != null) {
        reasonCodesField=e.getValue();
      }
      break;
    }
  }
  if (!(reasonCodesField == null || reasonCodesField.isEmpty()) && !(externalClassName == null || externalClassName.isEmpty()) && !(fieldName == null || fieldName.isEmpty())) {
    Consequence consequence=new Consequence();
    consequence.setSnippet("DroolsScorecard $sc = new DroolsScorecard();");
    rule.addConsequence(consequence);
    consequence=new Consequence();
    if ("pointsAbove".equalsIgnoreCase(scorecard.getReasonCodeAlgorithm())) {
      consequence.setSnippet("$sc.setReasonCodeAlgorithm(DroolsScorecard.REASON_CODE_ALGORITHM_POINTSABOVE);");
    }
 else     if ("pointsBelow".equalsIgnoreCase(scorecard.getReasonCodeAlgorithm())) {
      consequence.setSnippet("$sc.setReasonCodeAlgorithm(DroolsScorecard.REASON_CODE_ALGORITHM_POINTSBELOW);");
    }
    rule.addConsequence(consequence);
    consequence=new Consequence();
    if (scorecard.getReasonCodeAlgorithm() != null) {
      if ("pointsAbove".equalsIgnoreCase(scorecard.getReasonCodeAlgorithm())) {
        consequence.setSnippet("$sc.sortAndSetReasonCodes(DroolsScorecard.REASON_CODE_ALGORITHM_POINTSABOVE, $partialScoresList);");
      }
 else       if ("pointsBelow".equalsIgnoreCase(scorecard.getReasonCodeAlgorithm())) {
        consequence.setSnippet("$sc.sortAndSetReasonCodes(DroolsScorecard.REASON_CODE_ALGORITHM_POINTSBELOW, $partialScoresList);");
      }
      rule.addConsequence(consequence);
    }
    consequence=new Consequence();
    StringBuilder stringBuilder=new StringBuilder("$");
    stringBuilder.append(fieldName).append("Var").append(".set").append(Character.toUpperCase(reasonCodesField.charAt(0))).append(reasonCodesField.substring(1));
    stringBuilder.append("($sc.getReasonCodes());");
    consequence.setSnippet(stringBuilder.toString());
    rule.addConsequence(consequence);
  }
}
