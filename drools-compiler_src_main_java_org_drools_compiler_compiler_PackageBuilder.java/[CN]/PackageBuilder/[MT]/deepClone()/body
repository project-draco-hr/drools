{
  PackageBuilder clone=new PackageBuilder(configuration);
  clone.rootClassLoader=rootClassLoader;
  for (  Map.Entry<String,PackageRegistry> entry : pkgRegistryMap.entrySet()) {
    clone.pkgRegistryMap.put(entry.getKey(),entry.getValue().clonePackage(rootClassLoader));
  }
  clone.results.addAll(results);
  clone.ruleBase=ClassUtils.deepClone(ruleBase,rootClassLoader);
  clone.globals.putAll(globals);
  if (dslFiles != null) {
    clone.dslFiles=new ArrayList<DSLTokenizedMappingFile>();
    clone.dslFiles.addAll(dslFiles);
  }
  if (cacheTypes != null) {
    clone.cacheTypes=new HashMap<String,TypeDeclaration>();
    clone.cacheTypes.putAll(cacheTypes);
  }
  clone.packageAttributes.putAll(packageAttributes);
  for (  Map.Entry<String,List<PackageDescr>> entry : packages.entrySet()) {
    clone.packages.put(entry.getKey(),new ArrayList<PackageDescr>(entry.getValue()));
  }
  clone.packages.putAll(packages);
  return clone;
}
