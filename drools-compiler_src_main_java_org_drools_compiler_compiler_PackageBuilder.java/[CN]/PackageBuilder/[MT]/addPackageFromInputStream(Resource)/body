{
  InputStream is=resource.getInputStream();
  Object object=DroolsStreamUtils.streamIn(is,this.configuration.getClassLoader());
  is.close();
  if (object instanceof Collection) {
    @SuppressWarnings("unchecked") Collection<KnowledgePackage> pkgs=(Collection<KnowledgePackage>)object;
    for (    KnowledgePackage kpkg : pkgs) {
      overrideReSource(((KnowledgePackageImp)kpkg).pkg,resource);
      addPackage(((KnowledgePackageImp)kpkg).pkg);
    }
  }
 else   if (object instanceof KnowledgePackageImp) {
    KnowledgePackageImp kpkg=(KnowledgePackageImp)object;
    overrideReSource(kpkg.pkg,resource);
    addPackage(kpkg.pkg);
  }
 else   if (object instanceof Package) {
    Package pkg=(Package)object;
    overrideReSource(pkg,resource);
    addPackage(pkg);
  }
 else   if (object instanceof Package[]) {
    Package[] pkgs=(Package[])object;
    for (    Package pkg : pkgs) {
      overrideReSource(pkg,resource);
      addPackage(pkg);
    }
  }
 else {
    results.add(new DroolsError(resource){
      @Override public String getMessage(){
        return "Unknown binary format trying to load resource " + resource.toString();
      }
      @Override public int[] getLines(){
        return new int[0];
      }
    }
);
  }
}
