{
  String rule="package org.drools.test\n" + "import org.drools.compiler.StockTick\n" + "declare StockTick @role(event) end\n"+ "rule R1 when\n"+ "   StockTick()\n"+ "then\n"+ "end\n";
  PackageBuilder pkgbuilder=new PackageBuilder();
  pkgbuilder.addPackageFromDrl(new StringReader(rule));
  assertFalse(pkgbuilder.getErrors().toString(),pkgbuilder.hasErrors());
  Package[] pkgs=pkgbuilder.getPackages();
  byte[] spkgs=DroolsStreamUtils.streamOut(pkgs);
  KnowledgeBuilder kbuilder=KnowledgeBuilderFactory.newKnowledgeBuilder();
  kbuilder.add(ResourceFactory.newByteArrayResource(spkgs),ResourceType.PKG);
  assertFalse(kbuilder.getErrors().toString(),kbuilder.hasErrors());
  Collection<KnowledgePackage> kpkgs=kbuilder.getKnowledgePackages();
  assertEquals(2,kpkgs.size());
}
