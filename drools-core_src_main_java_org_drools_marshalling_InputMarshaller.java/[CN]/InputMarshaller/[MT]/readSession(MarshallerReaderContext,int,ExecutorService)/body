{
  FactHandleFactory handleFactory=context.ruleBase.newFactHandleFactory(context.readInt(),context.readLong());
  InitialFactHandle initialFactHandle=new InitialFactHandle(new DefaultFactHandle(context.readInt(),new InitialFactHandleDummyObject(),context.readLong()));
  context.handles.put(initialFactHandle.getId(),initialFactHandle);
  long propagationCounter=context.readLong();
  DefaultAgenda agenda=new DefaultAgenda(context.ruleBase,false);
  readAgenda(context,agenda);
  ReteooStatefulSession session=new ReteooStatefulSession(id,context.ruleBase,executor,handleFactory,initialFactHandle,propagationCounter,agenda);
  for (  RuleFlowGroup group : agenda.getRuleFlowGroupsMap().values()) {
    ((RuleFlowGroupImpl)group).setWorkingMemory(session);
  }
  context.wm=session;
  readFactHandles(context);
  readActionQueue(context);
  if (context.readBoolean()) {
    readTruthMaintenanceSystem(context);
  }
  readProcessInstances(context);
  readWorkItems(context);
  return session;
}
