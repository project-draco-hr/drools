{
  ObjectInputStream stream=context.stream;
  InternalRuleBase ruleBase=context.ruleBase;
  InternalWorkingMemory wm=context.wm;
  RuleFlowProcessInstance processInstance=new RuleFlowProcessInstance();
  processInstance.setId(stream.readLong());
  processInstance.setProcess(ruleBase.getProcess(stream.readUTF()));
  processInstance.setState(stream.readInt());
  long nodeInstanceCounter=stream.readLong();
  processInstance.setWorkingMemory(wm);
  int nbVariables=stream.readInt();
  if (nbVariables > 0) {
    VariableScopeInstance variableScopeInstance=(VariableScopeInstance)processInstance.getContextInstance(VariableScope.VARIABLE_SCOPE);
    for (int i=0; i < nbVariables; i++) {
      String name=stream.readUTF();
      try {
        Object value=stream.readObject();
        variableScopeInstance.setVariable(name,value);
      }
 catch (      ClassNotFoundException e) {
        throw new IllegalArgumentException("Could not reload variable " + name);
      }
    }
  }
  while (stream.readShort() == PersisterEnums.NODE_INSTANCE) {
    readNodeInstance(context,processInstance);
  }
  processInstance.internalSetNodeInstanceCounter(nodeInstanceCounter);
  wm.addProcessInstance(processInstance);
  return processInstance;
}
