{
  String ruleClassName=getUniqueLegalName(pkg.getName(),ruleDescr.getName(),"java");
  ruleDescr.SetClassName(ucFirst(ruleClassName));
  RuleBuilder builder=new RuleBuilder();
  builder.build(pkg,ruleDescr);
  Rule rule=builder.getRule();
  this.packageStoreWrapper.setPackageCompilationData(pkg.getPackageCompilationData());
  compile(pkg.getName() + "." + ruleDescr.getClassName(),builder.getRuleClass(),this.packageStoreWrapper);
  for (Iterator it=builder.getInvokers().keySet().iterator(); it.hasNext(); ) {
    String className=(String)it.next();
    Object invoker=builder.getInvokerLookups().get(className);
    if (invoker != null) {
      pkg.getPackageCompilationData().putInvoker(className,invoker);
    }
    String text=(String)builder.getInvokers().get(className);
    compile(className,text,this.packageStoreWrapper);
  }
  pkg.addRule(rule);
}
