{
  int len=c.size();
  Object[] arr=new Object[len];
  Iterator itr=c.iterator();
  int idx=0;
  while (true) {
    while (idx < len && itr.hasNext()) {
      arr[idx++]=itr.next();
    }
    if (!itr.hasNext()) {
      if (idx == len)       return arr;
      return ArrayUtils.copyOf(arr,idx,Object[].class);
    }
    int newcap=((arr.length / 2) + 1) * 3;
    if (newcap < arr.length) {
      if (arr.length < Integer.MAX_VALUE) {
        newcap=Integer.MAX_VALUE;
      }
 else {
        throw new OutOfMemoryError("required array size too large");
      }
    }
    arr=ArrayUtils.copyOf(arr,newcap,Object[].class);
    len=newcap;
  }
}
