{
  InputStream is;
  if (reader instanceof InputStreamReader) {
    is=new ReaderInputStream(reader,((InputStreamReader)reader).getEncoding());
  }
 else {
    is=new ReaderInputStream(reader);
  }
  SpreadsheetCompiler compiler=new SpreadsheetCompiler();
switch (configuration.getInputType()) {
case XLS:
{
      if (StringUtils.isEmpty(configuration.getWorksheetName())) {
        return compiler.compile(is,InputType.XLS);
      }
 else {
        return compiler.compile(is,configuration.getWorksheetName());
      }
    }
case CSV:
{
    return compiler.compile(is,InputType.CSV);
  }
}
return null;
}
