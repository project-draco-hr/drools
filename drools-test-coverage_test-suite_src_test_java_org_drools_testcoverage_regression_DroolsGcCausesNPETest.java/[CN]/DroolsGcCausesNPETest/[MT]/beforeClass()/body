{
  final KieModuleModel module=services.newKieModuleModel();
  final KieBaseModel base=module.newKieBaseModel(KIE_BASE_NAME);
  base.setEventProcessingMode(EventProcessingOption.STREAM);
  final Resource fileSystemResource=services.getResources().newClassPathResource(DRL_FILE_NAME,DroolsGcCausesNPETest.class);
  final KieFileSystem fileSystem=KieBaseUtil.writeKieModuleWithResourceToFileSystem(module,RELEASE_ID,fileSystemResource);
  final KieBuilder builder=services.newKieBuilder(fileSystem);
  final List<Message> errors=builder.buildAll().getResults().getMessages(Message.Level.ERROR);
  if (errors.size() > 0) {
    Assertions.fail("unexpected errors building drl: " + errors);
  }
  services.getRepository().addKieModule(builder.getKieModule());
}
