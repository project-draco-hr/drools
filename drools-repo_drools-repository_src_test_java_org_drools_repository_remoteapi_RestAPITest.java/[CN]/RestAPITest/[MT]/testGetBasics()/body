{
  RulesRepository repo=RepositorySessionUtil.getRepository();
  PackageItem pkg=repo.createPackage("testRestGetBasics","");
  pkg.updateStringProperty("This is some header",PackageItem.HEADER_PROPERTY_NAME);
  repo.save();
  AssetItem asset1=pkg.addAsset("asset1","");
  asset1.updateContent("this is content");
  asset1.updateFormat("drl");
  asset1.checkin("");
  AssetItem asset2=pkg.addAsset("asset2","");
  asset2.updateContent("this is content");
  asset2.updateFormat("xml");
  asset2.checkin("");
  AssetItem asset3=pkg.addAsset("asset3","");
  ByteArrayInputStream in=new ByteArrayInputStream("abc".getBytes());
  asset3.updateBinaryContentAttachment(in);
  asset3.updateFormat("xls");
  asset3.checkin("");
  assertTrue(asset3.isBinary());
  assertFalse(asset1.isBinary());
  RestAPI api=new RestAPI(repo);
  String url="packages/testRestGetBasics/.package";
  Response res=api.get(url);
  assertNotNull(res.lastModified);
  assertEquals(pkg.getLastModified(),res.lastModified);
  ByteArrayOutputStream out=new ByteArrayOutputStream();
  res.writeData(out);
  String dotPackage=new String(out.toByteArray());
  assertEquals(pkg.getStringProperty(PackageItem.HEADER_PROPERTY_NAME),dotPackage);
  res=api.get("packages/testRestGetBasics");
  assertTrue(res instanceof Text);
  assertNotNull(res.lastModified);
  out=new ByteArrayOutputStream();
  res.writeData(out);
  String listing=new String(out.toByteArray());
  assertNotNull(listing);
  Properties p=new Properties();
  p.load(new ByteArrayInputStream(out.toByteArray()));
  assertEquals(3,p.size());
  assertTrue(p.containsKey("asset1.drl"));
  assertTrue(p.containsKey("asset2.xml"));
  assertTrue(p.containsKey("asset3.xls"));
  assertNotNull(p.getProperty("asset1.drl"));
  String prop=p.getProperty("asset1.drl");
  System.err.println(prop);
  String[] dt=prop.split(",");
  SimpleDateFormat sdf=RestAPI.getISODateFormat();
  Date d=sdf.parse(dt[0]);
  assertNotNull(d);
  assertEquals(sdf.format(asset1.getLastModified().getTime()),dt[0]);
  assertEquals(asset1.getVersionNumber(),Long.parseLong(dt[1]));
  res=api.get("packages/testRestGetBasics/asset1.drl");
  assertTrue(res instanceof Text);
  out=new ByteArrayOutputStream();
  assertNotNull(res.lastModified);
  assertTrue(res.lastModified.getTime().after(sdf.parse("2000-04-14T18:36:37")));
  res.writeData(out);
  String s=new String(out.toByteArray());
  assertEquals(asset1.getContent(),s);
  res=api.get("packages/testRestGetBasics/asset3.xls");
  assertTrue(res instanceof Binary);
  out=new ByteArrayOutputStream();
  assertNotNull(res.lastModified);
  assertTrue(res.lastModified.getTime().after(sdf.parse("2000-04-14T18:36:37")));
  res.writeData(out);
  byte[] data=out.toByteArray();
  assertNotNull(data);
  assertEquals("abc",new String(data));
}
