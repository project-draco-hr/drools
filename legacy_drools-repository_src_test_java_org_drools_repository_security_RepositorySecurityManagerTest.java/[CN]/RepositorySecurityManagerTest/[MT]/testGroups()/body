{
  RepositorySecurityManager manager=new RepositorySecurityManager();
  PermissionGroup group=new PermissionGroup("test1");
  group.addPermission(new AssetPermission("RuleDef",new Long(1),AssetPermission.READ));
  group.addUserIdentity("michael.neale");
  manager.saveGroup(group);
  group=new PermissionGroup("test2");
  group.addPermission(new AssetPermission("RuleDef",new Long(1),AssetPermission.READ));
  group.addUserIdentity("jo.neale");
  manager.saveGroup(group);
  group=manager.loadGroup("test1");
  List groups=manager.listGroups("michael.neale");
  assertEquals(1,groups.size());
  PermissionGroup g=(PermissionGroup)groups.get(0);
  assertEquals(1,g.getAssetPermissions().size());
  assertTrue(((AssetPermission)g.getAssetPermissions().iterator().next()).hasPermission(AssetPermission.READ));
  groups=manager.listGroups("jo.neale");
  assertEquals(1,groups.size());
  manager.commitAndClose();
}
