{
  StatefulKnowledgeSession session=getExceptionSession();
  final Cheese brie=new Cheese("brie",12);
  Future futureAssert=session.asyncInsert(new Object[]{brie});
  Future futureFireAllRules=session.asyncFireAllRules();
  int i=0;
  while (!futureFireAllRules.isDone()) {
    Thread.sleep(300);
    if (i++ > 5) {
      fail("Future should have finished by now");
    }
  }
  assertTrue(futureAssert.get() instanceof List);
  assertTrue(((List)futureAssert.get()).get(0) instanceof FactHandle);
  try {
    futureFireAllRules.get();
    fail("Exception Should have been thrown");
  }
 catch (  ExecutionException e) {
  }
}
