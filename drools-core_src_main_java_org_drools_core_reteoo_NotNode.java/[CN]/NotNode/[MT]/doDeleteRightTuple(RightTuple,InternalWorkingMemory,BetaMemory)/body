{
  RightTupleSets stagedRightTuples=memory.getStagedRightTuples();
  boolean stagedDeleteWasEmpty=false;
  if (isStreamMode()) {
    stagedDeleteWasEmpty=memory.getSegmentMemory().getTupleQueue().isEmpty();
    memory.getSegmentMemory().getTupleQueue().add(new RightTupleEntry(rightTuple,rightTuple.getPropagationContext(),memory));
    if (log.isTraceEnabled()) {
      log.trace("JoinNode delete queue={} size={} pctx={} lt={}",System.identityHashCode(memory.getSegmentMemory().getTupleQueue()),memory.getSegmentMemory().getTupleQueue().size(),PropagationContextImpl.intEnumToString(rightTuple.getPropagationContext()),rightTuple);
    }
  }
 else {
    stagedDeleteWasEmpty=stagedRightTuples.addDelete(rightTuple);
  }
  if (memory.getAndDecCounter() == 1) {
    memory.linkNode(wm);
  }
 else   if (stagedDeleteWasEmpty) {
    memory.getSegmentMemory().notifyRuleLinkSegment(wm);
  }
  ;
}
