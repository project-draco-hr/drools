{
  StatefulKnowledgeSession ksession=((KnowledgeCommandContext)context).getStatefulKnowledgesession();
  if (max != -1) {
    return ksession.fireAllRules(max);
  }
 else   if (agendaFilter != null) {
    return ((StatefulKnowledgeSessionImpl)ksession).session.fireAllRules(new StatefulKnowledgeSessionImpl.AgendaFilterWrapper(agendaFilter));
  }
 else {
    return ksession.fireAllRules();
  }
}
