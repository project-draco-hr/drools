{
  StatefulKnowledgeSession ksession=((KnowledgeCommandContext)context).getStatefulKnowledgesession();
  int fired;
  if (max != -1) {
    fired=ksession.fireAllRules(max);
  }
 else   if (agendaFilter != null) {
    fired=((StatefulKnowledgeSessionImpl)ksession).session.fireAllRules(new StatefulKnowledgeSessionImpl.AgendaFilterWrapper(agendaFilter));
  }
 else {
    fired=ksession.fireAllRules();
  }
  if (this.outIdentifier != null) {
    ((ExecutionResultImpl)((KnowledgeCommandContext)context).getExecutionResults()).getResults().put(this.outIdentifier,fired);
  }
  return fired;
}
