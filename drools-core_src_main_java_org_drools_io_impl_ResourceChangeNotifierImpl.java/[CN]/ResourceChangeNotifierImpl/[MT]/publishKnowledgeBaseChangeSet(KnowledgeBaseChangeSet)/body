{
  Map<ResourceChangeListener,KnowledgeBaseChangeSetImpl> localChangeSets=new HashMap<ResourceChangeListener,KnowledgeBaseChangeSetImpl>();
  for (  Resource resource : changeSet.getResourcesAdded()) {
    Set<ResourceChangeListener> listeners=this.subscriptions.get(resource);
    for (    ResourceChangeListener listener : listeners) {
      KnowledgeBaseChangeSetImpl localChangeSet=localChangeSets.get(listener);
      if (localChangeSet == null) {
        localChangeSet=new KnowledgeBaseChangeSetImpl();
        localChangeSets.put(listener,localChangeSet);
      }
      if (localChangeSet.getResourcesAdded().isEmpty()) {
        localChangeSet.setResourcesAdded(new ArrayList<Resource>());
      }
      localChangeSet.getResourcesAdded().add(resource);
    }
  }
  for (  Resource resource : changeSet.getResourcesRemoved()) {
    Set<ResourceChangeListener> listeners=this.subscriptions.remove(resource);
    for (    ResourceChangeListener listener : listeners) {
      KnowledgeBaseChangeSetImpl localChangeSet=localChangeSets.get(listener);
      if (localChangeSet == null) {
        localChangeSet=new KnowledgeBaseChangeSetImpl();
        localChangeSets.put(listener,localChangeSet);
      }
      if (localChangeSet.getResourcesRemoved().isEmpty()) {
        localChangeSet.setResourcesRemoved(new ArrayList<Resource>());
      }
      localChangeSet.getResourcesRemoved().add(resource);
    }
  }
  for (  Resource resource : changeSet.getResourcesModified()) {
    Set<ResourceChangeListener> listeners=this.subscriptions.get(resource);
    for (    ResourceChangeListener listener : listeners) {
      KnowledgeBaseChangeSetImpl localChangeSet=localChangeSets.get(listener);
      if (localChangeSet == null) {
        localChangeSet=new KnowledgeBaseChangeSetImpl();
        localChangeSets.put(listener,localChangeSet);
      }
      if (localChangeSet.getResourcesModified().isEmpty()) {
        localChangeSet.setResourcesModified(new ArrayList<Resource>());
      }
      localChangeSet.getResourcesModified().add(resource);
    }
  }
  for (  Entry<ResourceChangeListener,KnowledgeBaseChangeSetImpl> entry : localChangeSets.entrySet()) {
    ResourceChangeListener listener=entry.getKey();
    KnowledgeBaseChangeSetImpl localChangeSet=entry.getValue();
    listener.resourceChanged(localChangeSet);
  }
}
