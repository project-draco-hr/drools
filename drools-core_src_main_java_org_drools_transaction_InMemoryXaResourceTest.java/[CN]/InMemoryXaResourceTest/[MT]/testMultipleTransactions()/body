{
  InMemoryXaResource xa=new InMemoryXaResource(snapshotter);
  Xid xid1=new DroolsXid(100,new byte[]{0x01},new byte[]{0x01});
  snapshotter.bytes=data1;
  xa.start(xid1,XAResource.TMNOFLAGS);
  Xid xid2=new DroolsXid(100,new byte[]{0x02},new byte[]{0x02});
  snapshotter.bytes=data2;
  xa.start(xid2,XAResource.TMNOFLAGS);
  assertEquals(2,xa.list.size());
  assertSame(xa.data.get(xa.list.get(0)),xa.lastSave);
  Xid xid3=new DroolsXid(100,new byte[]{0x03},new byte[]{0x03});
  snapshotter.bytes=data3;
  xa.start(xid3,XAResource.TMNOFLAGS);
  assertEquals(3,xa.list.size());
  xa.commit(xid1,true);
  assertSame(xa.data.get(xid2),xa.lastSave);
  xa.rollback(xid2);
  assertTrue(xa.list.isEmpty());
  assertTrue(xa.data.isEmpty());
}
