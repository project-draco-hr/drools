{
  URLClassLoader projectClassLoader=null;
  try {
    projectClassLoader=new URLClassLoader(new URL[]{outputDirectory.toURI().toURL()});
  }
 catch (  MalformedURLException e) {
    throw new RuntimeException(e);
  }
  KnowledgeBuilderConfiguration kConf=KnowledgeBuilderFactory.newKnowledgeBuilderConfiguration(null,projectClassLoader);
  KnowledgeJarBuilderImpl kbuilder=(KnowledgeJarBuilderImpl)KnowledgeBuilderFactory.newKnowledgeJarBuilder(kConf);
  for (  KBaseUnit kBaseUnit : kbuilder.getKBaseUnits(rootFolder,sourceFolder)) {
    if (kBaseUnit.hasErrors()) {
      getLog().error(kBaseUnit.getErrors().toString());
      throw new MojoFailureException(kBaseUnit.getKBaseName() + " build failed!");
    }
    getLog().info(kBaseUnit.getKBaseName() + " correctly built!");
  }
  kbuilder.copyKBasesToOutput(rootFolder,outputDirectory);
}
