{
  for (  NodeInstance nodeInstance : nodeInstances) {
    String prefix=parentPrefix + nodeInstance.getId() + VARIABLE_SEPARATOR;
    if (nodeInstance instanceof ContextInstanceContainer) {
      List<ContextInstance> variableScopeInstances=((ContextInstanceContainer)nodeInstance).getContextInstances(VariableScope.VARIABLE_SCOPE);
      for (      ContextInstance contextInstance : variableScopeInstances) {
        VariableScopeInstance variableScopeInstance=(VariableScopeInstance)contextInstance;
        persist(variableScopeInstance.getVariables(),prefix,newVariables);
      }
    }
    if (nodeInstance instanceof NodeInstanceContainer) {
      Collection<NodeInstance> nodeInstancesInsideTheContainer=((NodeInstanceContainer)nodeInstance).getNodeInstances();
      persistNodeVariables(nodeInstancesInsideTheContainer,prefix,newVariables);
    }
  }
}
