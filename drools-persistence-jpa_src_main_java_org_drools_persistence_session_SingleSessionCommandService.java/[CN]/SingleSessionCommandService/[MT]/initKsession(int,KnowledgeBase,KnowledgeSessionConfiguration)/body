{
  if (!doRollback && this.ksession != null) {
    return;
  }
  this.doRollback=false;
  try {
    this.sessionInfo=jpm.getApplicationScopedEntityManager().find(SessionInfo.class,sessionId);
  }
 catch (  Exception e) {
    throw new RuntimeException("Could not find session data for id " + sessionId,e);
  }
  if (sessionInfo == null) {
    throw new RuntimeException("Could not find session data for id " + sessionId);
  }
  if (this.marshallingHelper == null) {
    this.marshallingHelper=new JPASessionMarshallingHelper(kbase,conf,env);
  }
  this.sessionInfo.setJPASessionMashallingHelper(this.marshallingHelper);
  this.ksession=this.marshallingHelper.loadSnapshot(this.sessionInfo.getData(),this.ksession);
  ((InternalKnowledgeRuntime)ksession).setId(this.sessionInfo.getId());
  ((InternalKnowledgeRuntime)this.ksession).setEndOperationListener(new EndOperationListenerImpl(this.sessionInfo));
  ((JpaJDKTimerService)((InternalKnowledgeRuntime)ksession).getTimerService()).setCommandService(this);
  if (this.kContext == null) {
    this.kContext=new KnowledgeCommandContext(new ContextImpl("ksession",null),null,null,this.ksession,null);
  }
}
