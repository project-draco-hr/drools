{
  if (status != TransactionManager.STATUS_COMMITTED) {
    this.service.rollback();
  }
  this.service.synchronizations.remove(this.service);
  this.service.jpm.endCommandScopedEntityManager();
  StatefulKnowledgeSessionImpl ksession=((StatefulKnowledgeSessionImpl)this.service.ksession);
  if (ksession != null) {
    ((JPAProcessInstanceManager)((StatefulKnowledgeSessionImpl)ksession).session.getProcessInstanceManager()).clearProcessInstances();
    ((JPAWorkItemManager)((StatefulKnowledgeSessionImpl)ksession).session.getWorkItemManager()).clearWorkItems();
  }
}
