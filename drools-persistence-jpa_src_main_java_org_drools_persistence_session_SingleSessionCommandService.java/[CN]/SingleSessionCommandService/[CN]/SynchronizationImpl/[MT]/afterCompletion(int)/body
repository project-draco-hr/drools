{
  if (status != TransactionManager.STATUS_COMMITTED) {
    this.service.rollback();
  }
  SingleSessionCommandService.synchronizations.remove(this.service);
  this.service.jpm.endCommandScopedEntityManager();
  StatefulKnowledgeSessionImpl ksession=((StatefulKnowledgeSessionImpl)this.service.ksession);
  if (ksession != null) {
    ((JPAProcessInstanceManager)((InternalProcessRuntime)((InternalWorkingMemory)ksession.session).getProcessRuntime()).getProcessInstanceManager()).clearProcessInstances();
    ((JPAWorkItemManager)ksession.session.getWorkItemManager()).clearWorkItems();
  }
}
