{
  if (status != TransactionManager.STATUS_COMMITTED) {
    this.service.rollback();
  }
  SingleSessionCommandService.synchronizations.remove(this.service);
  this.service.jpm.endCommandScopedEntityManager();
  StatefulKnowledgeSession ksession=this.service.ksession;
  if (ksession != null) {
    ((JPAProcessInstanceManager)((InternalProcessRuntime)((InternalKnowledgeRuntime)ksession).getProcessRuntime()).getProcessInstanceManager()).clearProcessInstances();
    ((JPAWorkItemManager)ksession.getWorkItemManager()).clearWorkItems();
  }
}
