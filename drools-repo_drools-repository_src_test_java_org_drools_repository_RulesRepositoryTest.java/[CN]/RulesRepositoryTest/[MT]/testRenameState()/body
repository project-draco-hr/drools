{
  RulesRepository repo=RepositorySessionUtil.getRepository();
  StateItem[] items=repo.listStates();
  assertTrue(items.length > 0);
  final String oldName="stateThatHasALongNameAndWillBeRenamed";
  repo.createState(oldName);
  StateItem[] items2=repo.listStates();
  assertEquals(items.length + 1,items2.length);
  final String newName="stateThatHasALongNameAndWillBeRenamedNameAfterTheRenaming";
  repo.renameState(oldName,newName);
  StateItem[] items3=repo.listStates();
  assertEquals(items2.length,items3.length);
  try {
    repo.loadState(oldName);
    fail("Should never be here. Old name is still used.");
  }
 catch (  RulesRepositoryException e) {
  }
  assertNotNull(repo.loadState(newName));
}
