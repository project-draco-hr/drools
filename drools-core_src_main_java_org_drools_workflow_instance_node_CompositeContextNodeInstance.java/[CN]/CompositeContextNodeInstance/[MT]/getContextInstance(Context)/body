{
  ContextInstanceFactoryRegistry contextRegistry=((InternalRuleBase)getProcessInstance().getWorkingMemory().getRuleBase()).getConfiguration().getProcessContextInstanceFactoryRegistry();
  ContextInstanceFactory conf=contextRegistry.getContextInstanceFactory(context);
  if (conf == null) {
    throw new IllegalArgumentException("Illegal context type (registry not found): " + context.getClass());
  }
  ContextInstance contextInstance=(ContextInstance)conf.getContextInstance(context,this,getProcessInstance());
  if (contextInstance == null) {
    throw new IllegalArgumentException("Illegal context type (instance not found): " + context.getClass());
  }
  return contextInstance;
}
