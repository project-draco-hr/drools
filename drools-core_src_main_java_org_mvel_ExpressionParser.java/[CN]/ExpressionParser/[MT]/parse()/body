{
  stk.clear();
  fields=(Token.BOOLEAN_MODE & fields);
  cursor=0;
  if (fastExecuteMode)   parseAndExecuteAccelerated();
 else   parseAndExecuteInterpreted();
  Object result=stk.peek();
  if (isBooleanModeOnly()) {
    if (result instanceof Boolean)     return result;
 else     if (result instanceof Token) {
      if (((Token)result).getValue() instanceof Boolean) {
        return ((Token)result).getValue();
      }
      return !BlankLiteral.INSTANCE.equals(((Token)result).getValue());
    }
 else     if (result instanceof BigDecimal) {
      return !BlankLiteral.INSTANCE.equals(((BigDecimal)result).floatValue());
    }
    throw new CompileException("unknown exception in expression: encountered unknown stack element: " + result);
  }
 else   if (result instanceof Token) {
    result=((Token)result).getValue();
  }
  if (result instanceof BigDecimal) {
    if (returnBigDecimal)     return result;
 else     if (((BigDecimal)result).scale() > 14) {
      return ((BigDecimal)result).floatValue();
    }
 else     if (((BigDecimal)result).scale() > 0) {
      return ((BigDecimal)result).doubleValue();
    }
 else     if (((BigDecimal)result).longValue() > Integer.MAX_VALUE) {
      return ((BigDecimal)result).longValue();
    }
 else {
      return ((BigDecimal)result).intValue();
    }
  }
 else   return result;
}
