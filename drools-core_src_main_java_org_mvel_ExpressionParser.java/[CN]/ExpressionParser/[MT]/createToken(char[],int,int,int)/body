{
  Token tk=new Token(expr,start,end,fields);
  if (compileMode) {
    if ((tk.getFlags() & Token.NOCOMPILE) == 0) {
      ((TokenMap)tokenMap).addTokenNode(tk);
      if ((tk.getFlags() & Token.SUBEVAL) != 0)       reduceFast(tk);
    }
    setFieldFalse(Token.NOCOMPILE);
  }
 else   if ((tk.getFlags() & Token.IDENTIFIER) != 0 && (fields & Token.DO_NOT_REDUCE) == 0) {
    return reduceToken(tk);
  }
  if ((tk.getFlags() & Token.THISREF) != 0)   tk.setFinalValue(ctx);
  return tk;
}
