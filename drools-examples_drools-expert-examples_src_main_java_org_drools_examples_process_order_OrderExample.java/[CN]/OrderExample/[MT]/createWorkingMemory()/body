{
  try {
    kbase=createKnowledgeBase();
    ksession=kbase.newStatefulKnowledgeSession();
    logger=KnowledgeRuntimeLoggerFactory.newFileLogger(ksession,"log/order");
    CustomerService customerService=new DefaultCustomerService();
    Customer c=new Customer("A-12345");
    Calendar birthday=Calendar.getInstance();
    birthday.set(1982,1,1);
    c.setBirthday(birthday.getTime());
    c.setFirstName("John");
    c.setLastName("Doe");
    customerService.addCustomer(c);
    ksession.setGlobal("customerService",customerService);
    ItemCatalog itemCatalog=new DefaultItemCatalog();
    Item i=new Item("I-9876");
    i.setName("PC game");
    i.setMinimalAge(18);
    itemCatalog.addItem(i);
    i=new Item("I-5432");
    i.setName("Laptop");
    itemCatalog.addItem(i);
    ksession.setGlobal("itemCatalog",itemCatalog);
    ksession.getWorkItemManager().registerWorkItemHandler("Shipping",new ShippingWorkItemHandler(ksession));
    ksession.getWorkItemManager().registerWorkItemHandler("Email",new WorkItemHandler(){
      public void executeWorkItem(      WorkItem workItem,      WorkItemManager manager){
        System.out.println("***********************************************************");
        System.out.println("Sending email:");
        System.out.println("From: " + workItem.getParameter("From"));
        System.out.println("To: " + workItem.getParameter("To"));
        System.out.println("Subject: " + workItem.getParameter("Subject"));
        System.out.println("Text: ");
        System.out.println(workItem.getParameter("Text"));
        System.out.println("***********************************************************");
        manager.completeWorkItem(workItem.getId(),null);
      }
      public void abortWorkItem(      WorkItem workItem,      WorkItemManager manager){
      }
    }
);
    UIWorkItemHandler handler=new UIWorkItemHandler();
    ksession.getWorkItemManager().registerWorkItemHandler("Human Task",handler);
    handler.setVisible(true);
  }
 catch (  Throwable t) {
    t.printStackTrace();
  }
}
