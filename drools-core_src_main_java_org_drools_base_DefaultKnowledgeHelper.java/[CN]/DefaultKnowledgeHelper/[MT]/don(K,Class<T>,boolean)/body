{
  TraitBuilder builder=new TraitBuilder(this.getKnowledgeRuntime().getKnowledgeBase());
  ITraitable inner;
  if (core instanceof ITraitable) {
    inner=(ITraitable)core;
  }
 else {
    CoreWrapper<K> wrapper=builder.getCoreWrapper(core.getClass());
    if (wrapper == null) {
      throw new UnsupportedOperationException("Error: cannot apply a trait to non-traitable class " + core.getClass());
    }
    wrapper.init(core);
    inner=wrapper;
  }
  T thing=(T)builder.getProxy(inner,trait);
  if (!inner.getTraits().containsKey(IThing.class.getName())) {
    insert(don(inner,IThing.class,false));
  }
  if (logical) {
    insertLogical(thing);
  }
 else {
    insert(thing);
  }
  return thing;
}
