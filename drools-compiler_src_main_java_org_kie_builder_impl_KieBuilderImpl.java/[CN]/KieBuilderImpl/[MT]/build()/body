{
  if (!isBuilt() && gav != null && kieProject != null) {
    trgMfs=new MemoryFileSystem();
    writePomAndKProject();
    compileJavaClasses();
    addKBasesFilesToTrg();
    kieModule=new MemoryKieModules(gav,kieProject,trgMfs);
    if (dependencies != null && !dependencies.isEmpty()) {
      Map<GAV,InternalKieModule> modules=new HashMap<GAV,InternalKieModule>();
      for (      KieModule kieModule : dependencies) {
        modules.put(kieModule.getGAV(),(InternalKieModule)kieModule);
      }
      kieModule.setDependencies(modules);
    }
    kieModule.verify(messages);
    if (!hasResults(Level.ERROR)) {
      KieServices.Factory.get().getKieRepository().addKieModule(kieModule);
    }
  }
  return new ResultsImpl(messages.getMessages(),null);
}
