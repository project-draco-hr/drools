{
  if (!isBuilt() && gav != null && kModuleModel != null) {
    trgMfs=new MemoryFileSystem();
    writePomAndKModule();
    compileJavaClasses();
    addKBasesFilesToTrg();
    kModule=new MemoryKieModules(gav,kModuleModel,trgMfs);
    if (dependencies != null && !dependencies.isEmpty()) {
      Map<GAV,InternalKieModule> modules=new HashMap<GAV,InternalKieModule>();
      for (      KieModule kieModule : dependencies) {
        modules.put(kieModule.getGAV(),(InternalKieModule)kieModule);
      }
      kModule.setDependencies(modules);
    }
    kModule.verify(messages);
    if (!hasResults(Level.ERROR)) {
      KieServices.Factory.get().getKieRepository().addKieModule(kModule);
    }
  }
  return new ResultsImpl(messages.getMessages(),null);
}
