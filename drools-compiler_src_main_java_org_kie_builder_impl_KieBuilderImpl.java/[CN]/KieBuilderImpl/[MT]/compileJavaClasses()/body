{
  List<String> classFiles=new ArrayList<String>();
  for (  String fileName : srcMfs.getFileNames()) {
    if (fileName.endsWith(".class")) {
      trgMfs.write(fileName,srcMfs.getBytes(fileName),true);
      classFiles.add(fileName.substring(0,fileName.length() - ".class".length()));
    }
  }
  List<String> javaFiles=new ArrayList<String>();
  for (  String fileName : srcMfs.getFileNames()) {
    if (fileName.endsWith(".java") && !classFiles.contains(fileName.substring(0,fileName.length() - ".java".length()))) {
      javaFiles.add(fileName);
    }
  }
  if (javaFiles.isEmpty()) {
    return getCompositeClassLoader();
  }
  String[] sourceFiles=javaFiles.toArray(new String[javaFiles.size()]);
  EclipseJavaCompiler compiler=createCompiler("src/main/java/");
  CompilationResult res=compiler.compile(sourceFiles,srcMfs,trgMfs);
  for (  CompilationProblem problem : res.getErrors()) {
    messages.add(new MessageImpl(idGenerator++,problem));
  }
  for (  CompilationProblem problem : res.getWarnings()) {
    messages.add(new MessageImpl(idGenerator++,problem));
  }
  return res.getErrors().length == 0 ? getCompositeClassLoader() : getClass().getClassLoader();
}
