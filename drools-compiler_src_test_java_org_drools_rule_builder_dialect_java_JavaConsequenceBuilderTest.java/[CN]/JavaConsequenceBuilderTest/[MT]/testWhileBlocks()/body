{
  String consequence=" System.out.println(\"this is a test\");\n " + " Cheese c1 = $cheese;\n" + " while( c1 == $cheese )     { \r\n"+ "     modify( c1 ) { setPrice( 10 ), \n"+ "                    setOldPrice( age ) }\n "+ "     Cheese c4 = $cheese;\n"+ "     while ( true )     { \n"+ "         modify( c4 ) { setPrice( 10 ), setOldPrice( age ) }\n "+ "     }"+ " } \n "+ " Cheese c3 = $cheese;\n"+ " while ( c4 ==  $cheese ) modify( $cheese ) { setPrice( 10 ), setOldPrice( age ) }\n "+ " modify( $cheese ) { setPrice( 10 ), setOldPrice( age ) }\n "+ " System.out.println(\"we are done\");\n "+ " modify( $cheese ) { setPrice( 10 ), setOldPrice( age ) }\n "+ " System.out.println(\"we are done\");\n "+ "while (true) { System.out.println(1);}\n"+ " modify( $cheese ) { setPrice( 10 ), setOldPrice( age ) }\n ";
  setupTest("",new HashMap<String,Object>());
  ruleDescr.setConsequence(consequence);
  JavaExprAnalyzer analyzer=new JavaExprAnalyzer();
  Map<String,Class<?>> declrCls=new HashMap<String,Class<?>>();
  declrCls.put("$cheese",Cheese.class);
  JavaAnalysisResult analysis=(JavaAnalysisResult)analyzer.analyzeBlock((String)ruleDescr.getConsequence(),new BoundIdentifiers(declrCls,new HashMap<String,Class<?>>()));
  BoundIdentifiers bindings=new BoundIdentifiers(new HashMap(),new HashMap());
  bindings.getDeclarations().put("$cheese",Cheese.class);
  bindings.getDeclarations().put("age",int.class);
  List<JavaBlockDescr> descrs=new ArrayList<JavaBlockDescr>();
  builder.setContainerBlockInputs(context,descrs,analysis.getBlockDescrs(),consequence,bindings,new HashMap(),0);
  String fixed=builder.fixBlockDescr(context,(String)ruleDescr.getConsequence(),descrs,bindings,context.getDeclarationResolver().getDeclarations(context.getRule()));
  System.out.println(fixed);
}
