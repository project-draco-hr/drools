{
  KnowledgeBase kbase=SerializationHelper.serializeObject(loadKnowledgeBase("test_Dynamic1.drl","test_Dynamic3.drl","test_Dynamic4.drl"));
  Collection<KnowledgePackage> kpkgs=SerializationHelper.serializeObject(loadKnowledgePackages("test_Dynamic2.drl"));
  kbase.addKnowledgePackages(kpkgs);
  StatefulKnowledgeSession workingMemory=createKnowledgeSession(kbase);
  AgendaEventListener ael=mock(AgendaEventListener.class);
  workingMemory.addEventListener(ael);
  final List<?> list=new ArrayList<Object>();
  workingMemory.setGlobal("list",list);
  final PersonInterface bob=new Person("bob","stilton");
  bob.setStatus("Not evaluated");
  workingMemory.insert(bob);
  final Cheese stilton1=new Cheese("stilton",5);
  workingMemory.insert(stilton1);
  final Cheese stilton2=new Cheese("stilton",3);
  workingMemory.insert(stilton2);
  final Cheese stilton3=new Cheese("stilton",1);
  workingMemory.insert(stilton3);
  final Cheese cheddar=new Cheese("cheddar",5);
  workingMemory.insert(cheddar);
  verify(ael,times(15)).matchCreated(any(MatchCreatedEvent.class));
  verify(ael,never()).matchCancelled(any(MatchCancelledEvent.class));
  kbase.removeRule("org.drools.compiler.test","Who likes Stilton");
  verify(ael,times(3)).matchCancelled(any(MatchCancelledEvent.class));
  kbase.removeRule("org.drools.compiler.test","like cheese");
  verify(ael,times(7)).matchCancelled(any(MatchCancelledEvent.class));
  final Cheese muzzarela=new Cheese("muzzarela",5);
  workingMemory.insert(muzzarela);
  verify(ael,times(16)).matchCreated(any(MatchCreatedEvent.class));
  kbase.removeKnowledgePackage("org.drools.compiler.test");
  verify(ael,times(16)).matchCancelled(any(MatchCancelledEvent.class));
  kbase=SerializationHelper.serializeObject(kbase);
}
