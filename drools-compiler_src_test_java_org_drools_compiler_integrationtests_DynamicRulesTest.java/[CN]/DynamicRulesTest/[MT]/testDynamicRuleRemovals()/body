{
  KnowledgeBase kbase=SerializationHelper.serializeObject(loadKnowledgeBase("test_Dynamic1.drl","test_Dynamic3.drl","test_Dynamic4.drl"));
  Collection<KnowledgePackage> kpkgs=SerializationHelper.serializeObject(loadKnowledgePackages("test_Dynamic2.drl"));
  kbase.addKnowledgePackages(kpkgs);
  StatefulKnowledgeSession wm=createKnowledgeSession(kbase);
  final List<?> list=new ArrayList<Object>();
  wm.setGlobal("list",list);
  final PersonInterface bob=new Person("bob","stilton");
  bob.setStatus("Not evaluated");
  FactHandle fh0=wm.insert(bob);
  final Cheese stilton1=new Cheese("stilton",5);
  FactHandle fh1=wm.insert(stilton1);
  final Cheese stilton2=new Cheese("stilton",3);
  FactHandle fh2=wm.insert(stilton2);
  final Cheese stilton3=new Cheese("stilton",1);
  FactHandle fh3=wm.insert(stilton3);
  final Cheese cheddar=new Cheese("cheddar",5);
  FactHandle fh4=wm.insert(cheddar);
  wm.fireAllRules();
  assertEquals(15,list.size());
  list.clear();
  kbase.removeRule("org.drools.compiler.test","Who likes Stilton");
  wm.update(fh0,bob);
  wm.update(fh1,stilton1);
  wm.update(fh2,stilton2);
  wm.update(fh3,stilton3);
  wm.update(fh4,cheddar);
  wm.fireAllRules();
  assertEquals(12,list.size());
  list.clear();
  kbase.removeRule("org.drools.compiler.test","like cheese");
  wm.update(fh0,bob);
  wm.update(fh1,stilton1);
  wm.update(fh2,stilton2);
  wm.update(fh3,stilton3);
  wm.update(fh4,cheddar);
  wm.fireAllRules();
  assertEquals(8,list.size());
  list.clear();
  final Cheese muzzarela=new Cheese("muzzarela",5);
  wm.insert(muzzarela);
  wm.fireAllRules();
  assertEquals(1,list.size());
  list.clear();
}
