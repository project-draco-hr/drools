{
  final PackageBuilder builder=new PackageBuilder();
  builder.addPackageFromDrl(new InputStreamReader(getClass().getResourceAsStream("test_OutOfMemoryError.drl")));
  final Package pkg=builder.getPackage();
  RuleBase ruleBase=getRuleBase();
  ruleBase.addPackage(pkg);
  ruleBase=SerializationHelper.serializeObject(ruleBase);
  int i=0;
  SessionConfiguration conf=new SessionConfiguration();
  conf.setKeepReference(true);
  try {
    for (i=0; i < 300000; i++) {
      final StatefulSession session=ruleBase.newStatefulSession(conf,null);
      session.dispose();
    }
  }
 catch (  Throwable e) {
    System.out.println("Error at: " + i);
    e.printStackTrace();
    fail("Should not raise any error or exception.");
  }
}
