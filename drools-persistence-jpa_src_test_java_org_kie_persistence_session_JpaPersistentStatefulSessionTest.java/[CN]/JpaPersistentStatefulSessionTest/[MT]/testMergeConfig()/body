{
  KieServices ks=KieServices.Factory.get();
  KieBase kbase=ks.newKieContainer(ks.getRepository().getDefaultGAV()).getKieBase();
  Properties properties=new Properties();
  properties.put("drools.processInstanceManagerFactory","com.example.CustomJPAProcessInstanceManagerFactory");
  KieSessionConfiguration config=KnowledgeBaseFactory.newKnowledgeSessionConfiguration(properties);
  KieSession ksession=JPAKnowledgeService.newStatefulKnowledgeSession(kbase,config,env);
  SessionConfiguration sessionConfig=(SessionConfiguration)ksession.getSessionConfiguration();
  assertEquals("com.example.CustomJPAProcessInstanceManagerFactory",sessionConfig.getProcessInstanceManagerFactory());
}
