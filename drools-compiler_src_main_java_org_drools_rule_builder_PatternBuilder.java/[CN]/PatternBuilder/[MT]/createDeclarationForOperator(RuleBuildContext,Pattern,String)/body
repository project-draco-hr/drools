{
  Declaration declaration=null;
  int dotPos=expr.indexOf('.');
  if (dotPos < 0) {
    declaration=context.getDeclarationResolver().getDeclaration(context.getRule(),expr);
    if (declaration == null && "this".equals(expr)) {
      declaration=createDeclarationObject(context,"this",pattern);
    }
  }
 else {
    String part1=expr.substring(0,dotPos).trim();
    String part2=expr.substring(dotPos + 1).trim();
    if ("this".equals(part1)) {
      declaration=createDeclarationObject(context,part2,(Pattern)context.getBuildStack().peek());
    }
 else {
      declaration=context.getDeclarationResolver().getDeclaration(context.getRule(),part1);
      if (declaration != null) {
        if (declaration.isPatternDeclaration()) {
          declaration=createDeclarationObject(context,part2,declaration.getPattern());
        }
 else {
          declaration=null;
        }
      }
    }
  }
  return declaration;
}
