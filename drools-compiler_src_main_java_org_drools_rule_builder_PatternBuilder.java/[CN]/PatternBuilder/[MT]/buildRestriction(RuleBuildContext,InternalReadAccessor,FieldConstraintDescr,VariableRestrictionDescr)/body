{
  if (variableRestrictionDescr.getIdentifier() == null || variableRestrictionDescr.getIdentifier().equals("")) {
    context.getErrors().add(new DescrBuildError(context.getParentDescr(),variableRestrictionDescr,null,"Identifier not defined for binding field '" + fieldConstraintDescr.getFieldName() + "'"));
    return null;
  }
  Declaration declaration=context.getDeclarationResolver().getDeclaration(context.getRule(),variableRestrictionDescr.getIdentifier());
  if (declaration == null) {
    final Pattern thisPattern=(Pattern)context.getBuildStack().peek();
    final Declaration implicit=this.createDeclarationObject(context,variableRestrictionDescr.getIdentifier(),thisPattern);
    if (implicit != null) {
      declaration=implicit;
    }
 else {
      context.getErrors().add(new DescrBuildError(context.getParentDescr(),variableRestrictionDescr,null,"Unable to return Declaration for identifier '" + variableRestrictionDescr.getIdentifier() + "'"));
      return null;
    }
  }
  Target right=getRightTarget(extractor);
  Target left=(declaration.isPatternDeclaration() && !(Date.class.isAssignableFrom(declaration.getExtractor().getExtractToClass()) || Number.class.isAssignableFrom(declaration.getExtractor().getExtractToClass()))) ? Target.HANDLE : Target.FACT;
  final Evaluator evaluator=getEvaluator(context,variableRestrictionDescr,extractor.getValueType(),variableRestrictionDescr.getEvaluator(),variableRestrictionDescr.isNegated(),variableRestrictionDescr.getParameterText(),left,right);
  if (evaluator == null) {
    return null;
  }
  Restriction restriction=new VariableRestriction(extractor,declaration,evaluator);
  if (declaration.getPattern().getObjectType().equals(new ClassObjectType(DroolsQuery.class))) {
    restriction=new UnificationRestriction((VariableRestriction)restriction);
  }
  return restriction;
}
