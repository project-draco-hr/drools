{
  Restriction[] restrictions=new Restriction[top.getRestrictions().size()];
  int index=0;
  for (Iterator it=top.getRestrictions().iterator(); it.hasNext(); ) {
    RestrictionDescr restrictionDescr=(RestrictionDescr)it.next();
    if (restrictionDescr instanceof RestrictionConnectiveDescr) {
      restrictions[index++]=this.createRestriction(context,pattern,fieldConstraintDescr,(RestrictionConnectiveDescr)restrictionDescr,extractor);
    }
 else {
      restrictions[index]=buildRestriction(context,pattern,extractor,fieldConstraintDescr,restrictionDescr);
      if (restrictions[index] == null) {
        context.getErrors().add(new RuleError(context.getRule(),fieldConstraintDescr,null,"Unable to create restriction '" + restrictionDescr.toString() + "' for field '"+ fieldConstraintDescr.getFieldName()+ "' in the rule '"+ context.getRule().getName()+ "'"));
      }
      index++;
    }
  }
  if (restrictions.length > 1) {
    AbstractCompositeRestriction composite=null;
    if (top.getConnective() == RestrictionConnectiveDescr.AND) {
      composite=new AndCompositeRestriction(restrictions);
    }
 else     if (top.getConnective() == RestrictionConnectiveDescr.OR) {
      composite=new OrCompositeRestriction(restrictions);
    }
 else {
      context.getErrors().add(new RuleError(context.getRule(),fieldConstraintDescr,null,"This is a bug: Impossible to create a composite restriction for connective: " + top.getConnective() + "' for field '"+ fieldConstraintDescr.getFieldName()+ "' in the rule '"+ context.getRule().getName()+ "'"));
    }
    return composite;
  }
 else   if (restrictions.length == 1) {
    return restrictions[0];
  }
  context.getErrors().add(new RuleError(context.getRule(),fieldConstraintDescr,null,"This is a bug: trying to create a restriction for an empty restriction list for field '" + fieldConstraintDescr.getFieldName() + "' in the rule '"+ context.getRule().getName()+ "'"));
  return null;
}
