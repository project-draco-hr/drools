{
  int dotPos=value1.indexOf('.');
  if (dotPos > 0) {
    String part0=value1.substring(0,dotPos).trim();
    if ("this".equals(part0.trim())) {
      value1=value1.substring(dotPos + 1);
    }
 else     if (pattern.getDeclaration() != null && part0.equals(pattern.getDeclaration().getIdentifier())) {
      value1=value1.substring(dotPos + 1);
      expr=expr.substring(dotPos + 1);
    }
  }
  final InternalReadAccessor extractor=getFieldReadAccessor(context,relDescr,pattern.getObjectType(),value1,null,false);
  if (extractor == null) {
    return false;
  }
  ValueType vtype=extractor.getValueType();
  String operator=relDescr.getOperator().trim();
  LiteralRestrictionDescr restrictionDescr=buildLiteralRestrictionDescr(context,relDescr,value2,operator,isConstant);
  if (restrictionDescr != null) {
    FieldValue field=getFieldValue(context,vtype,restrictionDescr);
    if (field != null) {
      Constraint constraint=buildConstraint(context,vtype,field,expr,value1,operator,value2,extractor,restrictionDescr);
      if (constraint != null) {
        pattern.addConstraint(constraint);
        return true;
      }
    }
  }
  Restriction restriction=null;
  Declaration declr=null;
  if (value2.indexOf('(') < 0 && value2.indexOf('.') < 0 && value2.indexOf('[') < 0) {
    declr=context.getDeclarationResolver().getDeclaration(context.getRule(),value2);
    if (declr == null) {
      final Pattern thisPattern=(Pattern)context.getBuildStack().peek();
      declr=this.createDeclarationObject(context,value2,thisPattern);
      if (declr == null) {
        try {
          final Class<?> cls=context.getDialect().getTypeResolver().resolveType(value2);
          restrictionDescr=new LiteralRestrictionDescr(operator,relDescr.isNegated(),relDescr.getParameters(),cls.getName(),LiteralRestrictionDescr.TYPE_STRING);
          restriction=buildLiteralRestriction(context,extractor,restrictionDescr,getFieldValue(context,vtype,restrictionDescr),vtype);
        }
 catch (        ClassNotFoundException cnfe) {
          return false;
        }
      }
    }
  }
  if (declr == null) {
    String[] parts=value2.split("\\.");
    if (parts.length == 2) {
      if ("this".equals(parts[0].trim())) {
        declr=this.createDeclarationObject(context,parts[1].trim(),(Pattern)context.getBuildStack().peek());
        value2=parts[1].trim();
      }
 else {
        declr=context.getDeclarationResolver().getDeclaration(context.getRule(),parts[0].trim());
        if (declr != null) {
          if (declr.isPatternDeclaration()) {
            declr=this.createDeclarationObject(context,parts[1].trim(),declr.getPattern());
            value2=parts[1].trim();
          }
 else {
            return false;
          }
        }
      }
    }
  }
  if (declr != null) {
    Target right=getRightTarget(extractor);
    Target left=(declr.isPatternDeclaration() && !(Date.class.isAssignableFrom(declr.getExtractor().getExtractToClass()) || Number.class.isAssignableFrom(declr.getExtractor().getExtractToClass()))) ? Target.HANDLE : Target.FACT;
    final Evaluator evaluator=getEvaluator(context,relDescr,extractor.getValueType(),operator,relDescr.isNegated(),relDescr.getParametersText(),left,right);
    if (evaluator == null) {
      return false;
    }
    restriction=new VariableRestriction(extractor,declr,evaluator);
    if (declr.getPattern().getObjectType().equals(new ClassObjectType(DroolsQuery.class)) && Operator.EQUAL.getOperatorString().equals(operator)) {
      restriction=new UnificationRestriction((VariableRestriction)restriction);
    }
  }
  if (restriction == null) {
    Dialect dialect=context.getDialect();
    if (!value2.startsWith("(")) {
      MVELDialect mvelDialect=(MVELDialect)context.getDialect("mvel");
      context.setDialect(mvelDialect);
    }
    restriction=buildRestriction(context,(Pattern)context.getBuildStack().peek(),extractor,new ReturnValueRestrictionDescr(operator,relDescr.isNegated(),relDescr.getParametersText(),value2));
    context.setDialect(dialect);
  }
  if (restriction == null) {
    return false;
  }
  pattern.addConstraint(new VariableConstraint(extractor,restriction));
  return true;
}
