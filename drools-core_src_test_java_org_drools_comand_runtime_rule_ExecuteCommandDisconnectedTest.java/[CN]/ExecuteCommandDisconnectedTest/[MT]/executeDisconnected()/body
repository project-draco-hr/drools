{
  KnowledgeBase kbase=KnowledgeBaseFactory.newKnowledgeBase();
  ksession=kbase.newStatefulKnowledgeSession();
  ExecutionResultImpl localKresults=new ExecutionResultImpl();
  FixedKnowledgeCommandContext kContext=new FixedKnowledgeCommandContext(new ContextImpl("ksession",null),null,null,this.ksession,localKresults);
  commandService=new DefaultCommandService(kContext);
  List cmds=new ArrayList();
  cmds.add(new InsertObjectCommand(new String("Hi!"),"handle"));
  BatchExecutionCommand batchCmd=CommandFactory.newBatchExecution(cmds,"kresults");
  ExecuteCommand execCmd=new ExecuteCommand(batchCmd,true);
  ExecutionResults results=commandService.execute(execCmd);
  Assert.assertNotNull(results);
  Assert.assertNotNull(results.getFactHandle("handle"));
  Assert.assertTrue(((DefaultFactHandle)results.getFactHandle("handle")).isDisconnected());
  cmds=new ArrayList();
  cmds.add(new InsertObjectCommand(new String("Hi!"),"handle"));
  batchCmd=CommandFactory.newBatchExecution(cmds,"kresults");
  execCmd=new ExecuteCommand(batchCmd);
  results=commandService.execute(execCmd);
  Assert.assertNotNull(results);
  Assert.assertNotNull(results.getFactHandle("handle"));
  Assert.assertFalse(((DefaultFactHandle)results.getFactHandle("handle")).isDisconnected());
}
