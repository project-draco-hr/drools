{
  final ClassFieldInspector inspector=new ClassFieldInspector(cls);
  final Method[] getters=(Method[])inspector.getPropertyGetters().toArray(new Method[]{});
  final String generatedClassName=FieldAccessorGenerator.GEN_PACKAGE_PREFIX + cls.getName();
  final byte[] generatedClass=AccessorClassFactory.generateClass(getters,cls,generatedClassName);
  final ByteArrayClassLoader cl=new ByteArrayClassLoader(Thread.currentThread().getContextClassLoader());
  cl.addByteArray(generatedClassName,generatedClass);
  final FieldAccessor accessor=(FieldAccessor)cl.loadClass(generatedClassName).newInstance();
  final FieldAccessorMap map=new FieldAccessorMap(accessor,inspector.getFieldNames());
  return map;
}
