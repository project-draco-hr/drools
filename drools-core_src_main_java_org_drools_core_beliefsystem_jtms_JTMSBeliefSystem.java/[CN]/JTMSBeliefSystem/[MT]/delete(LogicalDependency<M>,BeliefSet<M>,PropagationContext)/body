{
  JTMSBeliefSet<M> jtmsBeliefSet=(JTMSBeliefSet<M>)beliefSet;
  boolean wasUndecided=jtmsBeliefSet.isUndecided();
  boolean wasNegated=jtmsBeliefSet.isNegated();
  boolean primeChanged=false;
  if ((jtmsBeliefSet.getPositiveFactHandle() != null && jtmsBeliefSet.getPositiveFactHandle().getObject() == node.getObject()) || (jtmsBeliefSet.getNegativeFactHandle() != null && jtmsBeliefSet.getNegativeFactHandle().getObject() == node.getObject())) {
    primeChanged=true;
  }
  beliefSet.remove(node.getMode());
  if (beliefSet.isEmpty()) {
    if (wasNegated && !wasUndecided) {
      defEP.getObjectStore().addHandle(beliefSet.getFactHandle(),beliefSet.getFactHandle().getObject());
      InternalFactHandle fh=jtmsBeliefSet.getNegativeFactHandle();
      ((NamedEntryPoint)fh.getEntryPoint()).delete(fh,context.getRuleOrigin(),node.getJustifier());
    }
    if (!(context.getType() == PropagationContext.DELETION && context.getFactHandle() == beliefSet.getFactHandle())) {
      InternalFactHandle fh=jtmsBeliefSet.getFactHandle();
      ((NamedEntryPoint)fh.getEntryPoint()).delete(fh,context.getRuleOrigin(),node.getJustifier());
    }
  }
 else   if (wasUndecided && !jtmsBeliefSet.isUndecided()) {
    insertBelief(node,defEP.getObjectTypeConfigurationRegistry().getObjectTypeConf(defEP.getEntryPoint(),node.getObject()),jtmsBeliefSet,context,false,wasNegated,wasUndecided);
  }
 else   if (primeChanged) {
    if ((wasNegated && !jtmsBeliefSet.isNegated()) || (!wasNegated && jtmsBeliefSet.isNegated())) {
      ObjectTypeConf typeConf=getObjectTypeConf(jtmsBeliefSet,wasNegated);
      deleteAfterChangedEntryPoint(node,context,typeConf,jtmsBeliefSet,wasNegated);
      typeConf=null;
      insertBelief(node,typeConf,jtmsBeliefSet,context,false,wasNegated,wasUndecided);
    }
 else {
      String value;
      Object object=null;
      InternalFactHandle fh=null;
      if (jtmsBeliefSet.isNegated()) {
        value=MODE.NEGATIVE.getId();
        fh=jtmsBeliefSet.getNegativeFactHandle();
        for (JTMSMode entry=(JTMSMode)jtmsBeliefSet.getLast(); entry != null; entry=(JTMSMode)entry.getPrevious()) {
          if (entry.getValue().equals(value)) {
            object=entry.getLogicalDependency().getObject();
            break;
          }
        }
      }
 else {
        value=MODE.POSITIVE.getId();
        fh=jtmsBeliefSet.getPositiveFactHandle();
        for (JTMSMode entry=(JTMSMode)jtmsBeliefSet.getFirst(); entry != null; entry=(JTMSMode)entry.getNext()) {
          if (entry.getValue() == null || entry.getValue().equals(value)) {
            object=entry.getLogicalDependency().getObject();
            break;
          }
        }
      }
      if (fh.getObject() != object) {
        ((NamedEntryPoint)fh.getEntryPoint()).getObjectStore().updateHandle(fh,object);
        ((NamedEntryPoint)fh.getEntryPoint()).update(fh,true,fh.getObject(),allSetButTraitBitMask(),object.getClass(),null);
      }
    }
  }
}
