{
  final Map<?,?> declarations=activation.getSubRule().getOuterDeclarations();
  for (Iterator<?> it=declarations.values().iterator(); it.hasNext(); ) {
    Declaration declaration=(Declaration)it.next();
    if ("processInstance".equals(declaration.getIdentifier())) {
      Object value=declaration.getValue(workingMemory,((InternalFactHandle)activation.getTuple().get(declaration)).getObject());
      if (value instanceof ProcessInstance) {
        return ((ProcessInstance)value).getId() == processInstanceId;
      }
    }
  }
  return true;
}
