{
  this.halt.set(false);
  int fireCount=0;
  while (continueFiring(fireLimit) && fireNextItem(agendaFilter)) {
    fireCount++;
    fireLimit=updateFireLimit(fireLimit);
    this.workingMemory.executeQueuedActions();
  }
  if (this.focusStack.size() == 1 && getMainAgendaGroup().isEmpty()) {
    getMainAgendaGroup().setActive(false);
  }
  return fireCount;
}
