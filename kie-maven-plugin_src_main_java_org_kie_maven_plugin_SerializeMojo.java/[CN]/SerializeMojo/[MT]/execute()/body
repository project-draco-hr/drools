{
  try {
    File outputFolder=new File(resDirectory);
    outputFolder.mkdirs();
    KieServices ks=KieServices.Factory.get();
    KieContainer kc=ks.newKieClasspathContainer();
    Results messages=kc.verify();
    List<Message> warnings=messages.getMessages(Message.Level.WARNING);
    for (    Message warning : warnings) {
      getLog().warn(warnings.toString());
    }
    List<Message> errors=messages.getMessages(Message.Level.ERROR);
    if (!errors.isEmpty()) {
      for (      Message error : errors) {
        getLog().error(error.toString());
      }
      throw new MojoFailureException("Build failed!");
    }
    for (    String kbase : kiebases) {
      KieBase kb=kc.getKieBase(kbase);
      getLog().info("Writing KBase: " + kbase);
      File file=new File(outputFolder,kbase.replace('.','_').toLowerCase());
      FileOutputStream out=new FileOutputStream(file);
      DroolsStreamUtils.streamOut(out,kb.getKiePackages());
      out.close();
    }
  }
 catch (  Exception e) {
    throw new MojoExecutionException("error",e);
  }
}
