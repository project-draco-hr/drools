{
  final ExternalSpreadsheetCompiler converter=new ExternalSpreadsheetCompiler();
  String basePricingDRL=null;
  String promotionalPricingDRL=null;
  try {
    basePricingDRL=converter.compile(getSpreadsheetStream(),getBasePricingRulesStream(),10,3);
    promotionalPricingDRL=converter.compile(getSpreadsheetStream(),getPromotionalPricingRulesStream(),30,3);
  }
 catch (  IOException e) {
    throw new IllegalArgumentException("Invalid spreadsheet stream.",e);
  }
  KnowledgeBuilder kbuilder=KnowledgeBuilderFactory.newKnowledgeBuilder();
  kbuilder.add(new ByteArrayResource(basePricingDRL.getBytes()),ResourceType.DRL);
  kbuilder.add(new ByteArrayResource(promotionalPricingDRL.getBytes()),ResourceType.DRL);
  if (kbuilder.hasErrors()) {
    System.out.println("Error compiling resources:");
    Iterator<KnowledgeBuilderError> errors=kbuilder.getErrors().iterator();
    while (errors.hasNext()) {
      System.out.println("\t" + errors.next().getMessage());
    }
    throw new IllegalStateException("Error compiling resources");
  }
  KnowledgeBase kbase=KnowledgeBaseFactory.newKnowledgeBase();
  kbase.addKnowledgePackages(kbuilder.getKnowledgePackages());
  return kbase;
}
