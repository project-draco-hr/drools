{
  TestWorkItemManager manager=new TestWorkItemManager();
  WorkItemImpl workItem=new WorkItemImpl();
  workItem.setName("Human Task");
  workItem.setParameter("TaskName","TaskName");
  workItem.setParameter("Comment","Comment");
  workItem.setParameter("Priority","10");
  workItem.setParameter("GroupId","Crusaders");
  handler.executeWorkItem(workItem,manager);
  Thread.sleep(500);
  BlockingTaskSummaryMessageResponseHandler responseHandler=new BlockingTaskSummaryMessageResponseHandler();
  List<String> groupIds=new ArrayList<String>();
  groupIds.add("Crusaders");
  humanTaskClient.getTasksAssignedAsPotentialOwner(null,groupIds,"en-UK",responseHandler);
  List<TaskSummary> tasks=responseHandler.getResults();
  assertEquals(1,tasks.size());
  TaskSummary taskSummary=tasks.get(0);
  assertEquals("TaskName",taskSummary.getName());
  assertEquals(10,taskSummary.getPriority());
  assertEquals("Comment",taskSummary.getDescription());
  assertEquals(Status.Ready,taskSummary.getStatus());
  System.out.println("Claiming task " + taskSummary.getId());
  BlockingTaskOperationMessageResponseHandler operationResponseHandler=new BlockingTaskOperationMessageResponseHandler();
  humanTaskClient.claim(taskSummary.getId(),"Darth Vader",operationResponseHandler);
  PermissionDeniedException denied=null;
  System.out.println("1");
  try {
    operationResponseHandler.waitTillDone(DEFAULT_WAIT_TIME);
    System.out.println("2");
  }
 catch (  PermissionDeniedException e) {
    System.out.println("EXCEPTION: " + e);
    denied=e;
  }
  assertNotNull("Should get permissed denied exception",denied);
  System.out.println("Claimed task " + taskSummary.getId());
  BlockingGetTaskMessageResponseHandler getTaskResponseHandler=new BlockingGetTaskMessageResponseHandler();
  humanTaskClient.getTask(taskSummary.getId(),getTaskResponseHandler);
  Task task=getTaskResponseHandler.getTask();
  assertEquals(Status.Ready,task.getTaskData().getStatus());
}
