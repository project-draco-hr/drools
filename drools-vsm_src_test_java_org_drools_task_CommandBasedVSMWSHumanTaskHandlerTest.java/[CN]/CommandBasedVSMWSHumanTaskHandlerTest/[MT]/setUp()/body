{
  super.setUp();
  SocketAddress address=new InetSocketAddress("127.0.0.1",9123);
  ServiceManagerData serverData=new ServiceManagerData();
  SocketAcceptor acceptor=new NioSocketAcceptor();
  acceptor.setHandler(new MinaIoHandler(SystemEventListenerFactory.getSystemEventListener(),new GenericMessageHandlerImpl(serverData,SystemEventListenerFactory.getSystemEventListener())));
  this.server=new MinaAcceptor(acceptor,address);
  this.server.start();
  SocketAddress htAddress=new InetSocketAddress("127.0.0.1",9124);
  SocketAcceptor htAcceptor=new NioSocketAcceptor();
  htAcceptor.setHandler(new MinaIoHandler(SystemEventListenerFactory.getSystemEventListener(),new TaskServerMessageHandlerImpl(taskService,SystemEventListenerFactory.getSystemEventListener())));
  this.humanTaskServer=new MinaAcceptor(htAcceptor,htAddress);
  this.humanTaskServer.start();
  NioSocketConnector htclientConnector=new NioSocketConnector();
  htclientConnector.setHandler(new MinaIoHandler(SystemEventListenerFactory.getSystemEventListener()));
  GenericConnector htMinaClient=new MinaConnector("client ht",htclientConnector,htAddress,SystemEventListenerFactory.getSystemEventListener());
  NioSocketConnector clientConnector=new NioSocketConnector();
  clientConnector.setHandler(new MinaIoHandler(SystemEventListenerFactory.getSystemEventListener()));
  GenericConnector minaClient=new MinaConnector("client SM",clientConnector,address,SystemEventListenerFactory.getSystemEventListener());
  List<GenericConnector> services=new ArrayList<GenericConnector>();
  services.add(htMinaClient);
  this.client=new ServiceManagerRemoteClient("client SM",minaClient,services);
  ((ServiceManagerRemoteClient)client).connect();
  HumanTaskServiceProvider humanTaskServiceFactory=this.client.getHumanTaskService();
  this.humanTaskClient=(HumanTaskServiceImpl)humanTaskServiceFactory.newHumanTaskServiceClient();
  KnowledgeBaseProvider kbaseFactory=this.client.getKnowledgeBaseFactory();
  KnowledgeBase kbase=kbaseFactory.newKnowledgeBase();
  this.handler=new CommandBasedVSMWSHumanTaskHandler(kbase.newStatefulKnowledgeSession());
}
