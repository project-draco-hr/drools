{
  BaseNode node=null;
  if (candidate instanceof EntryPointNode) {
    EntryPointNode epn=context.getRuleBase().getRete().getEntryPointNode(((EntryPointNode)candidate).getEntryPoint());
    if (epn != null) {
      node=epn;
    }
  }
 else   if (candidate instanceof ObjectTypeNode) {
    ObjectTypeNode otn=(ObjectTypeNode)candidate;
    Map<ObjectType,ObjectTypeNode> map=context.getRuleBase().getRete().getObjectTypeNodes(context.getCurrentEntryPoint());
    if (map != null) {
      otn=map.get(otn.getObjectType());
      if (otn != null) {
        node=otn;
      }
    }
  }
 else   if (isSharingEnabledForNode(context,candidate)) {
    if ((context.getTupleSource() != null) && (candidate instanceof TupleSink)) {
      TupleSink[] sinks=context.getTupleSource().getSinkPropagator().getSinks();
      for (int i=0; i < sinks.length; i++) {
        if (candidate.equals(sinks[i])) {
          node=(BaseNode)sinks[i];
          break;
        }
      }
    }
 else     if ((context.getObjectSource() != null) && (candidate instanceof ObjectSink)) {
      ObjectSink[] sinks=context.getObjectSource().getSinkPropagator().getSinks();
      for (int i=0; i < sinks.length; i++) {
        if (candidate.equals(sinks[i])) {
          node=(BaseNode)sinks[i];
          break;
        }
      }
    }
 else {
      throw new RuntimeDroolsException("This is a bug on node sharing verification. Please report to development team.");
    }
    if (node != null) {
      context.releaseId(candidate.getId());
    }
  }
  if (node == null) {
    node=candidate;
    if (context.getWorkingMemories().length == 0) {
      node.attach();
    }
 else {
      node.attach(context.getWorkingMemories());
    }
  }
  return node;
}
