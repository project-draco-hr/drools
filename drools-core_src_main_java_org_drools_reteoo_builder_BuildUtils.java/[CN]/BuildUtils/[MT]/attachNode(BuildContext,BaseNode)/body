{
  BaseNode node=(BaseNode)context.getNodeFromCache(candidate);
  if ((node != null) && isSharingEnabledForNode(context,node)) {
    if (!node.isInUse()) {
      if (context.getWorkingMemories().length == 0) {
        node.attach();
      }
 else {
        node.attach(context.getWorkingMemories());
      }
    }
    node.addShare();
    context.releaseLastId();
  }
 else {
    if (context.getWorkingMemories().length == 0) {
      candidate.attach();
    }
 else {
      candidate.attach(context.getWorkingMemories());
    }
    context.addNodeToCache(candidate);
    node=candidate;
  }
  return node;
}
