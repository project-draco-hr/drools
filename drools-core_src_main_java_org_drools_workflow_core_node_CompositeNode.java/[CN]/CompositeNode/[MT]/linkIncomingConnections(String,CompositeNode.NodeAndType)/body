{
  CompositeNode.NodeAndType oldNodeAndType=inConnectionMap.get(inType);
  if (oldNodeAndType != null) {
    if (oldNodeAndType.equals(inNode)) {
      return;
    }
 else {
      List<Connection> oldInConnections=oldNodeAndType.getNode().getIncomingConnections(oldNodeAndType.getType());
      if (oldInConnections != null) {
        for (        Connection connection : new ArrayList<Connection>(oldInConnections)) {
          if (connection.getFrom() instanceof CompositeNodeStart) {
            removeNode(connection.getFrom());
            ((ConnectionImpl)connection).terminate();
          }
        }
      }
    }
  }
  inConnectionMap.put(inType,inNode);
  if (inNode != null) {
    List<Connection> connections=getIncomingConnections(inType);
    for (    Connection connection : connections) {
      CompositeNodeStart start=new CompositeNodeStart(connection.getFrom(),inType);
      internalAddNode(start);
      if (inNode.getNode() != null) {
        new ConnectionImpl(start,org.drools.workflow.core.Node.CONNECTION_DEFAULT_TYPE,inNode.getNode(),inNode.getType());
      }
    }
  }
}
