{
  CompositeNode.NodeAndType oldNodeAndType=outConnectionMap.get(outType);
  if (oldNodeAndType != null) {
    if (oldNodeAndType.equals(outNode)) {
      return;
    }
 else {
      List<Connection> oldOutConnections=oldNodeAndType.getNode().getOutgoingConnections(oldNodeAndType.getType());
      for (      Connection connection : new ArrayList<Connection>(oldOutConnections)) {
        if (connection.getTo() instanceof CompositeNodeEnd) {
          removeNode(connection.getTo());
          ((ConnectionImpl)connection).terminate();
        }
      }
    }
  }
  outConnectionMap.put(outType,outNode);
  if (outNode != null) {
    List<Connection> connections=getOutgoingConnections(outType);
    for (    Connection connection : connections) {
      CompositeNodeEnd end=new CompositeNodeEnd(connection.getTo(),outType);
      internalAddNode(end);
      if (outNode.getNode() != null) {
        new ConnectionImpl(outNode.getNode(),outNode.getType(),end,org.drools.workflow.core.Node.CONNECTION_DEFAULT_TYPE);
      }
    }
  }
}
