{
  ShadowProxy proxy=null;
  if (isShadowEnabled()) {
    try {
      if (Collection.class.isAssignableFrom(this.shadowClass) || Map.class.isAssignableFrom(this.shadowClass)) {
        try {
          proxy=(ShadowProxy)this.shadowClass.getConstructor(new Class[]{cls}).newInstance(new Object[]{fact});
        }
 catch (        Exception e) {
        }
      }
      if (proxy == null) {
        if (this.instantiator == null) {
          this.setInstantiator();
        }
        proxy=(ShadowProxy)this.instantiator.newInstance();
      }
      proxy.setShadowedObject(fact);
    }
 catch (    final Exception e) {
      System.out.println("shadow: " + proxy.getClass() + ":"+ fact.getClass());
      throw new RuntimeDroolsException("Error creating shadow fact for object: " + fact,e);
    }
  }
  return proxy;
}
