{
  String rule1="A( a == 10, b == 15 )";
  String rule2="A( a == 10, i == 20 )";
  KnowledgeBase kbase=getKnowledgeBase(rule1,rule2);
  ReteooWorkingMemoryInterface wm=((StatefulKnowledgeSessionImpl)kbase.newStatefulKnowledgeSession()).session;
  ObjectTypeNode otn=getObjectTypeNode(kbase,"A");
  assertNotNull(otn);
  List<String> sp=getSettableProperties(wm,otn);
  AlphaNode alphaNode1=(AlphaNode)otn.getSinkPropagator().getSinks()[0];
  assertEquals(calculateMaskFromPattern(list("a"),0L,sp),alphaNode1.getDeclaredMask());
  assertEquals(calculateMaskFromPattern(list("a","b","i"),0L,sp),alphaNode1.getInferredMask());
  AlphaNode alphaNode1_1=(AlphaNode)alphaNode1.getSinkPropagator().getSinks()[0];
  assertEquals(calculateMaskFromPattern(list("b"),0L,sp),alphaNode1_1.getDeclaredMask());
  assertEquals(calculateMaskFromPattern(list("a","b"),0L,sp),alphaNode1_1.getInferredMask());
  LeftInputAdapterNode liaNode1=(LeftInputAdapterNode)alphaNode1_1.getSinkPropagator().getSinks()[0];
  RuleTerminalNode rtNode1=(RuleTerminalNode)liaNode1.getSinkPropagator().getSinks()[0];
  assertEquals(0,rtNode1.getDeclaredMask());
  assertEquals(calculateMaskFromPattern(list("a","b"),0L,sp),rtNode1.getInferredMask());
  AlphaNode alphaNode1_2=(AlphaNode)alphaNode1.getSinkPropagator().getSinks()[1];
  assertEquals(calculateMaskFromPattern(list("i"),0L,sp),alphaNode1_2.getDeclaredMask());
  assertEquals(calculateMaskFromPattern(list("a","i"),0L,sp),alphaNode1_2.getInferredMask());
  LeftInputAdapterNode liaNode2=(LeftInputAdapterNode)alphaNode1_2.getSinkPropagator().getSinks()[0];
  RuleTerminalNode rtNode2=(RuleTerminalNode)liaNode2.getSinkPropagator().getSinks()[0];
  assertEquals(0,rtNode2.getDeclaredMask());
  assertEquals(calculateMaskFromPattern(list("a","i"),0L,sp),rtNode2.getInferredMask());
  kbase.removeRule("org.drools","r0");
  assertEquals(calculateMaskFromPattern(list("a"),0L,sp),alphaNode1.getDeclaredMask());
  assertEquals(calculateMaskFromPattern(list("a","i"),0L,sp),alphaNode1.getInferredMask());
  assertEquals(calculateMaskFromPattern(list("i"),0L,sp),alphaNode1_2.getDeclaredMask());
  assertEquals(calculateMaskFromPattern(list("a","i"),0L,sp),alphaNode1_2.getInferredMask());
  assertEquals(0,rtNode2.getDeclaredMask());
  assertEquals(calculateMaskFromPattern(list("a","i"),0L,sp),rtNode2.getInferredMask());
  kbase=getKnowledgeBase(rule1,rule2);
  kbase.removeRule("org.drools","r1");
  otn=getObjectTypeNode(kbase,"A");
  alphaNode1=(AlphaNode)otn.getSinkPropagator().getSinks()[0];
  assertEquals(calculateMaskFromPattern(list("a"),0L,sp),alphaNode1.getDeclaredMask());
  assertEquals(calculateMaskFromPattern(list("a","b"),0L,sp),alphaNode1.getInferredMask());
  alphaNode1_1=(AlphaNode)alphaNode1.getSinkPropagator().getSinks()[0];
  assertEquals(calculateMaskFromPattern(list("b"),0L,sp),alphaNode1_1.getDeclaredMask());
  assertEquals(calculateMaskFromPattern(list("a","b"),0L,sp),alphaNode1_1.getInferredMask());
  liaNode1=(LeftInputAdapterNode)alphaNode1_1.getSinkPropagator().getSinks()[0];
  rtNode1=(RuleTerminalNode)liaNode1.getSinkPropagator().getSinks()[0];
  assertEquals(0,rtNode1.getDeclaredMask());
  assertEquals(calculateMaskFromPattern(list("a","b"),0L,sp),rtNode1.getInferredMask());
}
