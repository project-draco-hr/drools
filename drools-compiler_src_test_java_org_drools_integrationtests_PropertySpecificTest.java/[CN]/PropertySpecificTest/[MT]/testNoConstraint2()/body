{
  String rule="package org.drools\n" + "import org.drools.integrationtests.PropertySpecificTest.Order\n" + "import org.drools.integrationtests.PropertySpecificTest.OrderItem\n"+ "rule R1 when\n"+ "   $o : Order()\n"+ "   $i : OrderItem( orderId == $o.id, quantity > 2 )\n"+ "then\n"+ "   modify( $o ) { setDiscounted( true ) };\n"+ "end\n";
  KnowledgeBase kbase=loadKnowledgeBaseFromString(rule);
  StatefulKnowledgeSession ksession=kbase.newStatefulKnowledgeSession();
  Order order1=new Order("1");
  OrderItem orderItem11=new OrderItem("1",1,1.1);
  OrderItem orderItem12=new OrderItem("1",2,1.2);
  OrderItem orderItem13=new OrderItem("1",3,1.3);
  order1.setItems(list(orderItem11,orderItem12,orderItem13));
  ksession.insert(order1);
  ksession.insert(orderItem11);
  ksession.insert(orderItem12);
  ksession.insert(orderItem13);
  int rules=ksession.fireAllRules();
  assertEquals(1,rules);
  assertTrue(order1.isDiscounted());
}
