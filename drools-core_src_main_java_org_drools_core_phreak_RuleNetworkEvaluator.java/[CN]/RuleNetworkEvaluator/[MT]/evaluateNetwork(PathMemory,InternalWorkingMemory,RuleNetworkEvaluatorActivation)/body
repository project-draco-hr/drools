{
  SegmentMemory[] smems=pmem.getSegmentMemories();
  int smemIndex=0;
  SegmentMemory smem=smems[smemIndex];
  LeftInputAdapterNode liaNode=(LeftInputAdapterNode)smem.getRootNode();
  NetworkNode node;
  Memory nodeMem;
  if (liaNode == smem.getTipNode()) {
    smem=smems[++smemIndex];
    node=smem.getRootNode();
    nodeMem=smem.getNodeMemories().getFirst();
  }
 else {
    node=liaNode.getSinkPropagator().getFirstLeftTupleSink();
    nodeMem=smem.getNodeMemories().getFirst().getNext();
  }
  LeftTupleSets srcTuples=smem.getStagedLeftTuples();
  if (log.isTraceEnabled()) {
    log.trace("Rule[name={}] segments={} {}",pmem.getRuleTerminalNode().getRule().getName(),smems.length,srcTuples.toStringSizes());
  }
  Set<String> visitedRules;
  if (pmem.getRuleTerminalNode().getType() == NodeTypeEnums.QueryTerminalNode) {
    visitedRules=new HashSet<String>();
  }
 else {
    visitedRules=Collections.<String>emptySet();
  }
  LinkedList<StackEntry> stack=new LinkedList<StackEntry>();
  eval1(liaNode,pmem,(LeftTupleSink)node,nodeMem,smems,smemIndex,srcTuples,wm,stack,visitedRules,true,activation);
  return 0;
}
