{
  Environment env=this.kruntime.getEnvironment();
  EntityManager em=(EntityManager)env.get(EnvironmentName.CMD_SCOPED_ENTITY_MANAGER);
  WorkItemInfo workItemInfo=new WorkItemInfo(workItem,env);
  em.persist(workItemInfo);
  ((WorkItemImpl)workItem).setId(workItemInfo.getId());
  workItemInfo.update();
  if (this.workItems == null) {
    this.workItems=new HashMap<Long,WorkItemInfo>();
  }
  workItems.put(workItem.getId(),workItemInfo);
  WorkItemHandler handler=(WorkItemHandler)this.workItemHandlers.get(workItem.getName());
  if (handler != null) {
    handler.executeWorkItem(workItem,this);
  }
 else {
    throwWorkItemNotFoundException(workItem);
  }
}
