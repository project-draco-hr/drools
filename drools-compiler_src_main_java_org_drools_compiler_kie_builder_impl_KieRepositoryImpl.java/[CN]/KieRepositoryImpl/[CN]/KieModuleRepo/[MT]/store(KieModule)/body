{
  ReleaseId releaseId=kieModule.getReleaseId();
  String ga=releaseId.getGroupId() + ":" + releaseId.getArtifactId();
  TreeMap<ComparableVersion,WeakReference<KieModule>> artifactMap=kieModules.get(ga);
  if (artifactMap == null) {
    artifactMap=new TreeMap<ComparableVersion,WeakReference<KieModule>>();
    kieModules.put(ga,artifactMap);
  }
  ComparableVersion comparableVersion=new ComparableVersion(releaseId.getVersion());
  if (oldKieModules.get(releaseId) == null) {
    WeakReference<KieModule> kieModuleWeakReference=artifactMap.get(comparableVersion);
    if (kieModuleWeakReference != null && kieModuleWeakReference.get() != null) {
      oldKieModules.put(releaseId,kieModuleWeakReference.get());
    }
  }
  artifactMap.put(comparableVersion,new WeakReference<KieModule>(kieModule));
}
