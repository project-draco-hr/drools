{
  String source="package org.drools.compiler.test;" + "import org.drools.compiler.factmodel.traits.LegacyTraitTest.Procedure; " + "import org.drools.compiler.factmodel.traits.LegacyTraitTest; "+ "import org.drools.compiler.factmodel.traits.LegacyTraitTest.ProcedureImpl; "+ "import org.drools.compiler.factmodel.traits.LegacyTraitTest.Surgery; "+ "declare trait Surgery end "+ "rule 'Don Procedure' "+ "when "+ "    $p : Procedure() "+ "then "+ "    don( $p, Surgery.class ); "+ "end "+ "rule 'Print Provider' "+ "dialect 'mvel' "+ "when "+ "    $s : Surgery() "+ "then "+ "    System.out.println( $s.subject.name ); "+ "end "+ "\n";
  StatefulKnowledgeSession ks=getSessionFromString(source);
  TraitFactory.setMode(VirtualPropertyMode.MAP,ks.getKieBase());
  ProcedureImpl procedure=new ProcedureImpl();
  PatientImpl patient=new PatientImpl();
  patient.setName("John");
  procedure.setSubject(patient);
  ks.insert(procedure);
  ks.fireAllRules();
}
