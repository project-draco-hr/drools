{
  Map<String,Object> factData=new HashMap<String,Object>();
  this.scenario=scenario;
  for (int i=0; i < scenario.facts.length; i++) {
    FactData fact=scenario.facts[i];
    Object f=eval("new " + resolver.getFullTypeName(fact.type) + "()");
    factData.put(fact.name,f);
    populate(fact,factData);
  }
  this.populatedData=factData;
  HashSet<String> ruleList=new HashSet<String>();
  ruleList.addAll(Arrays.asList(scenario.ruleTrace.rules));
  TestingEventListener listener=new TestingEventListener(ruleList,wm.getRuleBase(),scenario.ruleTrace.inclusive);
  wm.addEventListener(listener);
  insertData(wm,this.populatedData);
  wm.fireAllRules(scenario.maxRuleFirings);
  scenario.ruleTrace.firingCounts=listener.firingCounts;
  for (int i=0; i < scenario.assertions.length; i++) {
    Assertion assertion=scenario.assertions[i];
    if (assertion instanceof VerifyFact) {
      verify((VerifyFact)assertion);
    }
 else     if (assertion instanceof VerifyRuleFired) {
      verify((VerifyRuleFired)assertion,scenario.ruleTrace.firingCounts);
    }
  }
}
