{
  final String className="predicate" + context.getNextId();
  predicateDescr.setClassMethodName(className);
  final FieldExtractor extractor=getFieldExtractor(context,utils,predicateDescr,column.getObjectType(),predicateDescr.getFieldName());
  if (extractor == null) {
    return;
  }
  final Declaration declaration=column.addDeclaration(predicateDescr.getDeclaration(),extractor);
  context.getDeclarations().put(declaration.getIdentifier(),declaration);
  if (context.getInnerDeclarations() != null) {
    context.getInnerDeclarations().put(declaration.getIdentifier(),declaration);
  }
  final List[] usedIdentifiers=utils.getUsedIdentifiers(context,predicateDescr,predicateDescr.getText());
  usedIdentifiers[0].remove(predicateDescr.getDeclaration());
  final List tupleDeclarations=new ArrayList();
  final List factDeclarations=new ArrayList();
  for (int i=0, size=usedIdentifiers[0].size(); i < size; i++) {
    Declaration decl=(Declaration)context.getDeclarations().get((String)usedIdentifiers[0].get(i));
    if (decl.getColumn() == column) {
      factDeclarations.add(decl);
    }
 else {
      tupleDeclarations.add(decl);
    }
  }
  Declaration[] previousDeclarations=(Declaration[])tupleDeclarations.toArray(new Declaration[tupleDeclarations.size()]);
  Declaration[] localDeclarations=(Declaration[])factDeclarations.toArray(new Declaration[factDeclarations.size()]);
  final PredicateConstraint predicateConstraint=new PredicateConstraint(declaration,previousDeclarations,localDeclarations);
  column.addConstraint(predicateConstraint);
  StringTemplate st=utils.getRuleGroup().getInstanceOf("predicateMethod");
  st.setAttribute("declaration",declaration);
  st.setAttribute("declarationType",declaration.getExtractor().getExtractToClass().getName().replace('$','.'));
  utils.setStringTemplateAttributes(context,st,previousDeclarations,(String[])usedIdentifiers[1].toArray(new String[usedIdentifiers[1].size()]));
  final String[] localDeclarationTypes=new String[localDeclarations.length];
  for (int i=0, size=localDeclarations.length; i < size; i++) {
    localDeclarationTypes[i]=localDeclarations[i].getExtractor().getExtractToClass().getName().replace('$','.');
  }
  st.setAttribute("localDeclarations",localDeclarations);
  st.setAttribute("localDeclarationTypes",localDeclarationTypes);
  st.setAttribute("methodName",className);
  final String predicateText=utils.getFunctionFixer().fix(predicateDescr.getText(),context.getVariables());
  st.setAttribute("text",predicateText);
  context.getMethods().add(st.toString());
  st=utils.getInvokerGroup().getInstanceOf("predicateInvoker");
  st.setAttribute("package",context.getPkg().getName());
  st.setAttribute("ruleClassName",utils.ucFirst(context.getRuleDescr().getClassName()));
  st.setAttribute("invokerClassName",context.getRuleDescr().getClassName() + utils.ucFirst(className) + "Invoker");
  st.setAttribute("methodName",className);
  st.setAttribute("declaration",declaration);
  st.setAttribute("declarationType",declaration.getExtractor().getExtractToClass().getName().replace('$','.'));
  utils.setStringTemplateAttributes(context,st,previousDeclarations,(String[])usedIdentifiers[1].toArray(new String[usedIdentifiers[1].size()]));
  st.setAttribute("localDeclarations",localDeclarations);
  st.setAttribute("localDeclarationTypes",localDeclarationTypes);
  st.setAttribute("hashCode",predicateText.hashCode());
  final String invokerClassName=context.getPkg().getName() + "." + context.getRuleDescr().getClassName()+ utils.ucFirst(className)+ "Invoker";
  context.getInvokers().put(invokerClassName,st.toString());
  context.getInvokerLookups().put(invokerClassName,predicateConstraint);
  context.getDescrLookups().put(invokerClassName,predicateDescr);
}
