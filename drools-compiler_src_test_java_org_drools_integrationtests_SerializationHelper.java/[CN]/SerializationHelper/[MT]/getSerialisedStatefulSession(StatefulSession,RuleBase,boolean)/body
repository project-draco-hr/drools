{
  ByteArrayOutputStream bos=new ByteArrayOutputStream();
  ((ReteooStatefulSession)session).getTimerService();
  ObjectOutput out=new ObjectOutputStream(bos);
  out.writeObject(session);
  out.close();
  bos.close();
  final byte[] b1=bos.toByteArray();
  ByteArrayInputStream bais=new ByteArrayInputStream(b1);
  StatefulSession session2=ruleBase.newStatefulSession(bais);
  bais.close();
  bos=new ByteArrayOutputStream();
  out=new ObjectOutputStream(bos);
  out.writeObject(session2);
  out.close();
  bos.close();
  final byte[] b2=bos.toByteArray();
  if (!areByteArraysEqual(b1,b2)) {
    throw new IllegalArgumentException("byte streams for serialisation test are not equal");
  }
  session2.setGlobalResolver(session.getGlobalResolver());
  if (dispose) {
    session.dispose();
  }
  return session2;
}
