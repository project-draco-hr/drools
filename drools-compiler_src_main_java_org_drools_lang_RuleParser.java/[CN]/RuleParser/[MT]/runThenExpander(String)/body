{
  StringTokenizer lines=new StringTokenizer(text,"\n\r");
  StringBuffer expanded=new StringBuffer();
  String eol=System.getProperty("line.separator");
  while (lines.hasMoreTokens()) {
    String line=lines.nextToken();
    line=line.trim();
    if (line.length() > 0) {
      if (line.startsWith(">")) {
        expanded.append(line.substring(1));
        expanded.append(eol);
      }
 else {
        expanded.append(expander.expand("then",line));
        expanded.append(eol);
      }
    }
  }
  return expanded.toString();
}
