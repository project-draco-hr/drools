{
  final StringTokenizer lines=new StringTokenizer(text,"\n\r");
  final StringBuffer expanded=new StringBuffer();
  final String eol=System.getProperty("line.separator");
  while (lines.hasMoreTokens()) {
    startLine++;
    String line=lines.nextToken();
    line=line.trim();
    if (line.length() > 0) {
      if (line.startsWith(">")) {
        expanded.append(line.substring(1));
        expanded.append(eol);
      }
 else {
        try {
          expanded.append(this.expander.expand("then",line));
          expanded.append(eol);
        }
 catch (        final Exception e) {
          this.errors.add(new ExpanderException("Unable to expand: " + line + ". Due to "+ e.getMessage(),startLine));
        }
      }
    }
  }
  if (this.expanderDebug) {
    System.out.println("Expanding RHS: " + text + " ----> "+ expanded.toString()+ " --> from line starting: "+ startLine);
  }
  return expanded.toString();
}
