{
  StringTokenizer lines=new StringTokenizer(text,"\n\r");
  StringBuffer expanded=new StringBuffer();
  String eol=System.getProperty("line.separator");
  while (lines.hasMoreTokens()) {
    startLine++;
    String line=lines.nextToken();
    line=line.trim();
    if (line.length() > 0) {
      if (line.startsWith(">")) {
        expanded.append(line.substring(1));
        expanded.append(eol);
      }
 else {
        try {
          expanded.append(expander.expand("then",line));
          expanded.append(eol);
        }
 catch (        Exception e) {
          this.errors.add(new ExpanderException("Unable to expand: " + line + ". Due to "+ e.getMessage(),startLine));
        }
      }
    }
  }
  return expanded.toString();
}
