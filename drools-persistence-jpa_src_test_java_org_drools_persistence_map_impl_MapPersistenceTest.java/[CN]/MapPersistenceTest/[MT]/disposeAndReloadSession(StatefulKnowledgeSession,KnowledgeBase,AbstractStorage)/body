{
  long sessionId=ksession.getId();
  ksession.dispose();
  AbstractStorageEnvironmentBuilder envBuilder=new AbstractStorageEnvironmentBuilder(storage);
  Environment env=KnowledgeBaseFactory.newEnvironment();
  env.set(EnvironmentName.TRANSACTION_MANAGER,envBuilder.getTransactionManager());
  env.set(EnvironmentName.ENTITY_MANAGER_FACTORY,envBuilder.getPersistenceContextManager());
  return JPAKnowledgeService.loadStatefulKnowledgeSession(sessionId,kbase,null,env);
}
