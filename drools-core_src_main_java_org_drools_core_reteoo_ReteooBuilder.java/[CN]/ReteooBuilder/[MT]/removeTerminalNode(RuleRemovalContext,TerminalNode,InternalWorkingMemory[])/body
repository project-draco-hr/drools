{
  if (this.ruleBase.getConfiguration().isPhreakEnabled()) {
    AddRemoveRule.removeRule(tn,workingMemories,ruleBase);
  }
  RuleRemovalContext.CleanupAdapter adapter=null;
  if (!this.ruleBase.getConfiguration().isPhreakEnabled()) {
    if (tn instanceof RuleTerminalNode) {
      adapter=new RuleTerminalNode.RTNCleanupAdapter((RuleTerminalNode)tn);
    }
    context.setCleanupAdapter(adapter);
  }
  BaseNode node=(BaseNode)tn;
  LinkedList<BaseNode> betaStack=new LinkedList<BaseNode>();
  LinkedList<BaseNode> alphaStack=new LinkedList<BaseNode>();
  LinkedList<BaseNode> stillInUse=new LinkedList<BaseNode>();
  boolean processRian=true;
  while (node != null) {
    removeNode(node,alphaStack,betaStack,stillInUse,processRian,workingMemories,context);
    if (!betaStack.isEmpty()) {
      node=betaStack.removeLast();
      if (node.getType() == NodeTypeEnums.RightInputAdaterNode) {
        processRian=true;
      }
 else {
        processRian=false;
      }
    }
 else     if (!alphaStack.isEmpty()) {
      node=alphaStack.removeLast();
    }
 else {
      node=null;
    }
  }
  ;
  resetMasks(stillInUse);
}
