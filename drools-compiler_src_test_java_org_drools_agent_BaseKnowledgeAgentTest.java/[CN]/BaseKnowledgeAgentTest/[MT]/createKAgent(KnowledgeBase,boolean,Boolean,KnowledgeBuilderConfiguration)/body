{
  KnowledgeAgentConfiguration aconf=KnowledgeAgentFactory.newKnowledgeAgentConfiguration();
  aconf.setProperty("drools.agent.scanDirectories","true");
  aconf.setProperty("drools.agent.scanResources","true");
  aconf.setProperty("drools.agent.newInstance",Boolean.toString(newInstance));
  if (useKBaseClassLoaderForCompiling != null) {
    aconf.setProperty("drools.agent.useKBaseClassLoaderForCompiling","" + useKBaseClassLoaderForCompiling);
  }
  KnowledgeAgent kagent=KnowledgeAgentFactory.newKnowledgeAgent("test agent",kbase,aconf,builderConf);
  assertEquals("test agent",kagent.getName());
  return kagent;
}
