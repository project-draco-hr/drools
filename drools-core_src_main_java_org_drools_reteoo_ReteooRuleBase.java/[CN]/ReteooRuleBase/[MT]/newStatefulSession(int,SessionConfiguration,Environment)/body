{
  if (this.getConfig().isSequential()) {
    throw new RuntimeException("Cannot have a stateful rule session, with sequential configuration set to true");
  }
  ReteooStatefulSession session;
synchronized (this.pkgs) {
    ExecutorService executor=ExecutorServiceFactory.createExecutorService(this.getConfig().getExecutorService());
    session=new ReteooStatefulSession(id,this,executor,sessionConfig,environment);
    executor.setCommandExecutor(new CommandExecutor(session));
    if (sessionConfig.isKeepReference()) {
      super.addStatefulSession(session);
      for (      Object listener : session.getRuleBaseUpdateListeners()) {
        addEventListener((RuleBaseEventListener)listener);
      }
    }
    session.startPartitionManagers();
    session.queueWorkingMemoryAction(new WorkingMemoryReteAssertAction(session.getInitialFactHandle(),false,true,null,null));
  }
  return session;
}
