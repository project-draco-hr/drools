{
  removePropertyChangeListener(handle);
  PropagationContextImpl context=new PropagationContextImpl(++this.propagationIdCounter,PropagationContext.RETRACTION,rule,activation);
  Set pendingActivations=(Set)this.blockingFactHandles.remove(((FactHandleImpl)handle).getId());
  if (pendingActivations != null) {
    for (Iterator it=pendingActivations.iterator(); it.hasNext(); ) {
      PendingActivation item=(PendingActivation)it.next();
      item.decrementBlockingFactsCount();
      if (!item.containsBlockingFacts()) {
        boolean allPresent=true;
        FactHandleImpl[] factHandles=(FactHandleImpl[])item.getTuple().getFactHandles();
        for (int i=0; i < factHandles.length && allPresent; i++) {
          allPresent=this.objects.containsKey(factHandles[i].getId());
        }
        if (allPresent) {
          this.assertTuple(item.getTuple(),new HashSet(),item.getContext(),item.getRule());
        }
      }
    }
  }
  Set postedActivations=(Set)this.factHandleActivations.remove(((FactHandleImpl)handle).getId());
  if (postedActivations != null) {
    for (Iterator it=postedActivations.iterator(); it.hasNext(); ) {
      PostedActivation item=(PostedActivation)it.next();
      if (!item.isRemoved()) {
        Activation itemActivation=(AgendaItem)item.getActivation();
        if (!((LeapsTuple)itemActivation.getTuple()).isActivationNull() && itemActivation.isActivated()) {
          item.getActivation().remove();
          getAgendaEventSupport().fireActivationCancelled(item.getActivation());
        }
        removeLogicalDependencies(item.getActivation(),context,rule);
        item.setRemoved();
      }
    }
  }
  this.stack.remove(new Token(this,(FactHandleImpl)handle));
  Object oldObject=removeObject(handle);
  if (removeLogical) {
    removeLogicalDependencies(handle);
    this.equalsMap.remove(oldObject);
  }
  if (updateEqualsMap) {
    this.equalsMap.remove(oldObject);
  }
  this.workingMemoryEventSupport.fireObjectRetracted(context,handle,oldObject);
}
