{
  if (!this.firing) {
    try {
      this.firing=true;
      this.pushTokenOnStack(new Token(this,null));
      while (!this.stack.isEmpty()) {
        Token token=(Token)this.stack.peek();
        boolean done=false;
        while (!done) {
          if (!token.isResume()) {
            if (token.hasNextRuleHandle()) {
              token.nextRuleHandle();
            }
 else {
              this.stack.remove(token);
              done=true;
            }
          }
          if (!done) {
            try {
              TokenEvaluator.evaluate(token);
              if (token.getDominantFactHandle() != null) {
                token.setResume(true);
                done=true;
              }
            }
 catch (            NoMatchesFoundException ex) {
              token.setResume(false);
            }
catch (            Exception e) {
              e.printStackTrace();
              System.out.println("exception - " + e);
            }
          }
          while (this.agenda.fireNextItem(agendaFilter)) {
            ;
          }
        }
      }
      this.idLastFireAllAt=((HandleFactory)this.handleFactory).getNextId();
      for (Enumeration e=this.factTables.elements(); e.hasMoreElements(); ) {
        ((FactTable)e.nextElement()).setReseededStack(true);
      }
    }
  finally {
      this.firing=false;
    }
  }
}
