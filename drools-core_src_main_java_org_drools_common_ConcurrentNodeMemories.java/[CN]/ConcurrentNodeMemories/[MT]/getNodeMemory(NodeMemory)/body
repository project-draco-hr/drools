{
  if (node.getId() >= this.memories.length()) {
    resize(node);
  }
  Object memory=this.memories.get(node.getId());
  if (memory == null) {
    memory=node.createMemory(this.rulebase.getConfiguration());
    if (!this.memories.compareAndSet(node.getId(),null,memory)) {
      memory=this.memories.get(node.getId());
    }
  }
  return memory;
}
