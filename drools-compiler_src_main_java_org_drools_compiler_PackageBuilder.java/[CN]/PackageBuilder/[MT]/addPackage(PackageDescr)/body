{
  validatePackageName(packageDescr);
  validateUniqueRuleNames(packageDescr);
  String dialectName=null;
  if (dialectName == null && this.dialect == null) {
    this.dialect=this.configuration.getDefaultDialect();
  }
  if (dialectName != null) {
    this.dialect=this.configuration.getDialectRegistry().getDialectConfiguration(dialectName).getDialect();
  }
 else   if (this.dialect == null) {
    this.dialect=this.configuration.getDefaultDialect();
  }
  if (this.pkg != null) {
    mergePackage(this.pkg,packageDescr);
  }
 else {
    this.pkg=newPackage(packageDescr);
  }
  this.builder=new RuleBuilder();
  if (!hasErrors()) {
    for (final Iterator it=packageDescr.getFactTemplates().iterator(); it.hasNext(); ) {
      addFactTemplate((FactTemplateDescr)it.next());
    }
    for (final Iterator it=packageDescr.getFunctions().iterator(); it.hasNext(); ) {
      FunctionDescr functionDescr=(FunctionDescr)it.next();
      final String functionClassName=this.pkg.getName() + "." + ucFirst(functionDescr.getName());
      functionDescr.setClassName(functionClassName);
      this.pkg.addStaticImport(functionClassName + "." + functionDescr.getName());
    }
    for (final Iterator it=packageDescr.getFunctions().iterator(); it.hasNext(); ) {
      addFunction((FunctionDescr)it.next());
    }
    for (final Iterator it=packageDescr.getRules().iterator(); it.hasNext(); ) {
      addRule((RuleDescr)it.next());
    }
  }
  this.configuration.getDialectRegistry().compileAll();
  if (this.pkg.getPackageCompilationData().isDirty()) {
    this.pkg.getPackageCompilationData().reload();
  }
  this.results=this.configuration.getDialectRegistry().addResults(this.results);
}
