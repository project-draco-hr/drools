{
  ClassBuilder cb=new ClassBuilder();
  String fullName=typeDescr.getNamespace() + "." + typeDescr.getTypeName();
  ClassDefinition def=new ClassDefinition(fullName);
  Map<String,TypeFieldDescr> flds=typeDescr.getFields();
  try {
    for (    TypeFieldDescr field : flds.values()) {
      String fullFieldType=pkgRegistry.getTypeResolver().resolveType(field.getPattern().getObjectType()).getName();
      FieldDefinition fieldDef=new FieldDefinition(field.getFieldName(),fullFieldType);
      boolean isKey=field.getMetaAttributes().containsKey("key");
      fieldDef.setKey(isKey);
      def.addField(fieldDef);
    }
    byte[] d=cb.buildClass(def);
    pkgRegistry.getPackage().getPackageScopeClassLoader().addClass(fullName,d);
    type.setTypeClassDef(def);
  }
 catch (  Exception e) {
    e.printStackTrace();
    this.results.add(new TypeDeclarationError("Unable to create a class for declared type " + fullName + ": "+ e.getMessage()+ ";",typeDescr.getLine()));
  }
}
