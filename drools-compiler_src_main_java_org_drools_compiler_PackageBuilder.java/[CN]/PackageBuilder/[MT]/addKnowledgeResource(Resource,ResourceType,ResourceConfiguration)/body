{
  try {
    ((InternalResource)resource).setResourceType(type);
    if (ResourceType.DRL.equals(type)) {
      addPackageFromDrl(resource);
    }
 else     if (ResourceType.DESCR.equals(type)) {
      addPackageFromDrl(resource);
    }
 else     if (ResourceType.DSLR.equals(type)) {
      addPackageFromDslr(resource);
    }
 else     if (ResourceType.DSL.equals(type)) {
      addDsl(resource);
    }
 else     if (ResourceType.XDRL.equals(type)) {
      addPackageFromXml(resource);
    }
 else     if (ResourceType.BRL.equals(type)) {
      addPackageFromBrl(resource);
    }
 else     if (ResourceType.DRF.equals(type)) {
      addProcessFromXml(resource);
    }
 else     if (ResourceType.BPMN2.equals(type)) {
      BPMN2ProcessFactory.configurePackageBuilder(this);
      addProcessFromXml(resource);
    }
 else     if (ResourceType.DTABLE.equals(type)) {
      addPackageFromDecisionTable(resource,configuration);
    }
 else     if (ResourceType.PKG.equals(type)) {
      InputStream is=resource.getInputStream();
      Package pkg=(Package)DroolsStreamUtils.streamIn(is,this.configuration.getClassLoader());
      is.close();
      addPackage(pkg);
    }
 else     if (ResourceType.CHANGE_SET.equals(type)) {
      XmlChangeSetReader reader=new XmlChangeSetReader(this.configuration.getSemanticModules());
      if (resource instanceof ClassPathResource) {
        reader.setClassLoader(((ClassPathResource)resource).getClassLoader(),((ClassPathResource)resource).getClazz());
      }
 else {
        reader.setClassLoader(this.configuration.getClassLoader(),null);
      }
      ChangeSet changeSet=reader.read(resource.getReader());
      if (changeSet == null) {
      }
      for (      Resource nestedResource : changeSet.getResourcesAdded()) {
        InternalResource iNestedResourceResource=(InternalResource)nestedResource;
        if (iNestedResourceResource.isDirectory()) {
          this.resourceDirectories.add(iNestedResourceResource);
          for (          Resource childResource : iNestedResourceResource.listResources()) {
            if (((InternalResource)childResource).isDirectory()) {
              continue;
            }
            ((InternalResource)childResource).setResourceType(iNestedResourceResource.getResourceType());
            addKnowledgeResource(childResource,iNestedResourceResource.getResourceType(),iNestedResourceResource.getConfiguration());
          }
        }
 else {
          addKnowledgeResource(iNestedResourceResource,iNestedResourceResource.getResourceType(),iNestedResourceResource.getConfiguration());
        }
      }
    }
 else     if (ResourceType.XSD.equals(type)) {
      JaxbConfigurationImpl confImpl=(JaxbConfigurationImpl)configuration;
      String[] classes=DroolsJaxbHelperProviderImpl.addXsdModel(resource,this,confImpl.getXjcOpts(),confImpl.getSystemId());
      for (      String cls : classes) {
        confImpl.getClasses().add(cls);
      }
    }
 else     if (ResourceType.PMML.equals(type)) {
      PMMLCompiler compiler=getPMMLCompiler();
      if (compiler != null) {
        String theory=compiler.compile(resource.getInputStream(),getPackageRegistry());
        addKnowledgeResource(new ByteArrayResource(theory.getBytes()),ResourceType.DRL,configuration);
      }
 else {
        throw new RuntimeException("Unknown resource type: " + type);
      }
    }
 else {
      ResourceTypeBuilder builder=ResourceTypeBuilderRegistry.getInstance().getResourceTypeBuilder(type);
      if (builder != null) {
        builder.setPackageBuilder(this);
        builder.addKnowledgeResource(resource,type,configuration);
      }
 else {
        throw new RuntimeException("Unknown resource type: " + type);
      }
    }
  }
 catch (  RuntimeException e) {
    throw e;
  }
catch (  Exception e) {
    throw new RuntimeException(e);
  }
}
