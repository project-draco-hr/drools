{
  final String ruleClassName=getUniqueLegalName(this.pkg.getName(),ruleDescr.getName(),"java",this.src);
  ruleDescr.setClassName(ucFirst(ruleClassName));
  final RuleBuilder builder=new RuleBuilder(getTypeResolver(),getFunctionFixer(),this.classFieldExtractorCache);
  builder.build(this.pkg,ruleDescr);
  this.results.addAll(builder.getErrors());
  final Rule rule=builder.getRule();
  if (builder.getRuleClass() != null) {
    addRuleSemantics(builder,rule,ruleDescr);
  }
  this.pkg.addRule(rule);
  String name=pkg.getName() + "." + ucFirst(ruleDescr.getClassName());
  LineMappings mapping=new LineMappings(name);
  mapping.setStartLine(ruleDescr.getConsequenceLine());
  mapping.setOffset(ruleDescr.getConsequenceOffset());
  this.lineMappings.put(name,mapping);
}
