{
  MemoryXaResource xa=pm.getXAResource();
  Xid xid=new DroolsXid(100,new byte[]{0x01},new byte[]{0x01});
  snapshotter.bytes=data1;
  xa.start(xid,XAResource.TMNOFLAGS);
  snapshotter.bytes=data2;
  xa.commit(xid,true);
  assertEquals(0,xa.list.size());
  assertSame(data2,pm.lastSave);
  xa.rollback(xid);
  assertTrue(assertEquals(data2,snapshotter.bytes));
  assertTrue(xa.list.isEmpty());
  assertTrue(xa.data.isEmpty());
}
