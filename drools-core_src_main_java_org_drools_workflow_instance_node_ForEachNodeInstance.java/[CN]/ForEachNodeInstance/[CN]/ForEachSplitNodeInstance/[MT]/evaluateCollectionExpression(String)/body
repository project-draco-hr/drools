{
  VariableScopeInstance variableScopeInstance=(VariableScopeInstance)resolveContextInstance(VariableScope.VARIABLE_SCOPE,collectionExpression);
  if (variableScopeInstance == null) {
    throw new IllegalArgumentException("Could not find collection " + collectionExpression);
  }
  Object collection=variableScopeInstance.getVariable(collectionExpression);
  if (collection == null) {
    return Collections.EMPTY_LIST;
  }
  if (collection instanceof Collection<?>) {
    return (Collection<?>)collection;
  }
  if (collection.getClass().isArray()) {
    List<Object> list=new ArrayList<Object>();
    for (    Object o : (Object[])collection) {
      list.add(o);
    }
    return list;
  }
  throw new IllegalArgumentException("Unexpected collection type: " + collection.getClass());
}
