{
  Object collection=null;
  VariableScopeInstance variableScopeInstance=(VariableScopeInstance)resolveContextInstance(VariableScope.VARIABLE_SCOPE,collectionExpression);
  if (variableScopeInstance != null) {
    collection=variableScopeInstance.getVariable(collectionExpression);
  }
 else {
    try {
      collection=MVEL.eval(collectionExpression,new NodeInstanceResolverFactory(this));
    }
 catch (    Throwable t) {
      throw new IllegalArgumentException("Could not find collection " + collectionExpression);
    }
  }
  if (collection == null) {
    return Collections.EMPTY_LIST;
  }
  if (collection instanceof Collection<?>) {
    return (Collection<?>)collection;
  }
  if (collection.getClass().isArray()) {
    List<Object> list=new ArrayList<Object>();
    for (    Object o : (Object[])collection) {
      list.add(o);
    }
    return list;
  }
  throw new IllegalArgumentException("Unexpected collection type: " + collection.getClass());
}
