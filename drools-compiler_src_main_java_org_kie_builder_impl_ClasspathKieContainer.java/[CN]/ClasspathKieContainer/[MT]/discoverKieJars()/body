{
  ClassLoader classLoader=Thread.currentThread().getContextClassLoader();
  final Enumeration<URL> e;
  try {
    e=classLoader.getResources("META-INF/kproject.xml");
  }
 catch (  IOException exc) {
    log.error("Unable to find and build index of kproject.xml \n" + exc.getMessage());
    return;
  }
  List<KieProjectModel> kProjects=new ArrayList<KieProjectModel>();
  Map<KieProjectModel,String> urls=new IdentityHashMap<KieProjectModel,String>();
  while (e.hasMoreElements()) {
    URL url=e.nextElement();
    ;
    try {
      KieProjectModel kieProject=KieProjectModelImpl.fromXML(url);
      kProjects.add(kieProject);
      String fixedURL=fixURL(url);
      urls.put(kieProject,fixedURL);
      String pomProperties=getPomProperties(fixedURL);
      GAV gav=GAVImpl.fromPropertiesString(pomProperties);
      String rootPath=fixedURL;
      if (rootPath.lastIndexOf(':') > 0) {
        rootPath=fixedURL.substring(rootPath.lastIndexOf(':') + 1);
      }
      InternalKieJar kieJar=null;
      File file=new File(rootPath);
      if (fixedURL.endsWith(".jar")) {
        kieJar=new ZipKieJar(gav,kieProject,file);
      }
 else       if (file.isDirectory()) {
        kieJar=new FileKieJar(gav,kieProject,file);
      }
 else {
        log.error("Unable to build index of kproject.xml url=" + url.toExternalForm() + "\n");
        continue;
      }
      kieJars.put(gav,kieJar);
    }
 catch (    Exception exc) {
      log.error("Unable to build index of kproject.xml url=" + url.toExternalForm() + "\n"+ exc.getMessage());
    }
  }
}
