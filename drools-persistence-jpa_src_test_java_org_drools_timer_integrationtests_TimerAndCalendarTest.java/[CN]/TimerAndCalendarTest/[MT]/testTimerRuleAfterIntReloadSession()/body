{
  KnowledgeBase kbase=KnowledgeBaseFactory.newKnowledgeBase();
  StatefulKnowledgeSession ksession=createSession(kbase);
  SessionPseudoClock clock=(SessionPseudoClock)ksession.<SessionClock>getSessionClock();
  clock.advanceTime(300,TimeUnit.MILLISECONDS);
  ksession.fireAllRules();
  clock=(SessionPseudoClock)ksession.<SessionClock>getSessionClock();
  clock.advanceTime(300,TimeUnit.MILLISECONDS);
  ksession=disposeAndReloadSession(ksession,kbase);
  clock=(SessionPseudoClock)ksession.<SessionClock>getSessionClock();
  clock.advanceTime(300,TimeUnit.MILLISECONDS);
  String timerRule="package org.drools.test\n" + "global java.util.List list \n" + "rule TimerRule \n"+ "   timer (int:1000 500) \n"+ "when \n"+ "then \n"+ "        list.add(list.size()); \n"+ " end";
  Resource resource=ResourceFactory.newByteArrayResource(timerRule.getBytes());
  Collection<KnowledgePackage> kpackages=buildKnowledgePackage(resource,ResourceType.DRL);
  kbase.addKnowledgePackages(kpackages);
  clock=(SessionPseudoClock)ksession.<SessionClock>getSessionClock();
  clock.advanceTime(10,TimeUnit.MILLISECONDS);
  ksession.fireAllRules();
  clock=(SessionPseudoClock)ksession.<SessionClock>getSessionClock();
  clock.advanceTime(10,TimeUnit.MILLISECONDS);
  ksession=disposeAndReloadSession(ksession,kbase);
  clock=(SessionPseudoClock)ksession.<SessionClock>getSessionClock();
  clock.advanceTime(10,TimeUnit.MILLISECONDS);
  List<Integer> list=Collections.synchronizedList(new ArrayList<Integer>());
  ksession.setGlobal("list",list);
  Assert.assertEquals(0,list.size());
  clock=(SessionPseudoClock)ksession.<SessionClock>getSessionClock();
  clock.advanceTime(1700,TimeUnit.MILLISECONDS);
  Assert.assertEquals(2,list.size());
  ksession=disposeAndReloadSession(ksession,kbase);
  ksession.setGlobal("list",list);
  clock=(SessionPseudoClock)ksession.<SessionClock>getSessionClock();
  clock.advanceTime(1000,TimeUnit.MILLISECONDS);
  Assert.assertEquals(4,list.size());
}
