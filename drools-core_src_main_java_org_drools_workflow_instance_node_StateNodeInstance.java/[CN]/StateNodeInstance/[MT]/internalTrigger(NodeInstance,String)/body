{
  StateNode stateNode=getStateNode();
  Connection selected=null;
  int priority=Integer.MAX_VALUE;
  for (  Connection connection : stateNode.getOutgoingConnections(NodeImpl.CONNECTION_DEFAULT_TYPE)) {
    Constraint constraint=stateNode.getConstraint(connection);
    if (constraint != null && constraint.getPriority() < priority) {
      String rule="RuleFlowStateNode-" + getProcessInstance().getProcessId() + "-"+ getStateNode().getUniqueId()+ "-"+ connection.getTo().getId()+ "-"+ connection.getToType();
      boolean isActive=((InternalAgenda)getProcessInstance().getAgenda()).isRuleActiveInRuleFlowGroup("DROOLS_SYSTEM",rule,getProcessInstance().getId());
      if (isActive) {
        selected=connection;
        priority=constraint.getPriority();
      }
    }
  }
  if (selected != null) {
    ((NodeInstanceContainer)getNodeInstanceContainer()).removeNodeInstance(this);
    triggerConnection(selected);
  }
 else {
    addTriggerListener();
    addActivationListener();
  }
}
