{
  String ruleFlowGroup=event.getActivation().getRule().getRuleFlowGroup();
  if ("DROOLS_SYSTEM".equals(ruleFlowGroup)) {
    String ruleName=event.getActivation().getRule().getName();
    String constraintNameStart="RuleFlowStateNode-" + getProcessInstance().getProcessId() + "-"+ getNode().getId();
    if (ruleName.startsWith(constraintNameStart)) {
      Connection selected=null;
      int priority=Integer.MAX_VALUE;
      for (      Connection connection : getNode().getOutgoingConnections(NodeImpl.CONNECTION_DEFAULT_TYPE)) {
        Constraint constraint=getStateNode().getConstraint(connection);
        if (constraint != null && constraint.getPriority() < priority) {
          String constraintName=constraintNameStart + "-" + connection.getTo().getId()+ "-"+ connection.getToType();
          if (constraintName.equals(ruleName) && checkProcessInstance(event.getActivation())) {
            selected=connection;
            priority=constraint.getPriority();
          }
        }
      }
      if (selected != null) {
synchronized (getProcessInstance()) {
          removeEventListeners();
          ((NodeInstanceContainer)getNodeInstanceContainer()).removeNodeInstance(this);
          triggerConnection(selected);
        }
      }
    }
  }
}
