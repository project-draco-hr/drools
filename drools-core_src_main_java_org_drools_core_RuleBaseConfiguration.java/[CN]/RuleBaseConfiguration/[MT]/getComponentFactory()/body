{
  if (!isPhreakEnabled()) {
    if (!(componentFactory.getWorkingMemoryFactory().getClass().getName().endsWith("ReteWorkingMemory"))) {
      if (wmFactory == null) {
        try {
          wmFactory=(WorkingMemoryFactory)Class.forName("org.drools.reteoo.common.ReteWorkingMemoryFactory").newInstance();
        }
 catch (        Exception e) {
          throw new RuntimeException(e);
        }
      }
      componentFactory.setWorkingMemoryFactory(wmFactory);
    }
    if (!(componentFactory.getNodeFactoryService().getClass().getName().endsWith("ReteNodeFactory"))) {
      if (reteNodeFactory == null) {
        try {
          reteNodeFactory=(NodeFactory)Class.forName("org.drools.reteoo.builder.ReteNodeFactory").newInstance();
        }
 catch (        Exception e) {
          throw new RuntimeException(e);
        }
      }
      componentFactory.setNodeFactoryProvider(reteNodeFactory);
    }
    if (!(componentFactory.getPropagationContextFactory().getClass().getName().endsWith("RetePropagationContextFactory"))) {
      if (pctxFactory == null) {
        try {
          pctxFactory=(PropagationContextFactory)Class.forName("org.drools.reteoo.common.RetePropagationContextFactory").newInstance();
        }
 catch (        Exception e) {
          throw new RuntimeException(e);
        }
      }
      componentFactory.setPropagationContextFactory(pctxFactory);
    }
    if (!(componentFactory.getAgendaFactory().getClass().getName().endsWith("ReteAgendaFactory"))) {
      if (agendaFactory == null) {
        try {
          agendaFactory=(AgendaFactory)Class.forName("org.drools.reteoo.common.ReteAgendaFactory").newInstance();
        }
 catch (        Exception e) {
          throw new RuntimeException(e);
        }
      }
      componentFactory.setAgendaFactory(agendaFactory);
    }
  }
  return componentFactory;
}
