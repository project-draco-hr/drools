{
  if (!isPhreakEnabled()) {
    if (!(componentFactory.getNodeFactoryService().getClass().getName().endsWith("ReteNodeFactory"))) {
      if (reteNodeFactory == null) {
        try {
          reteNodeFactory=(NodeFactory)Class.forName("org.drools.core.reteoo.builder.ReteNodeFactory").newInstance();
        }
 catch (        Exception e) {
          throw new RuntimeException(e);
        }
      }
      componentFactory.setNodeFactoryProvider(reteNodeFactory);
    }
    if (agendaCls == null) {
      try {
        agendaCls=Class.forName("org.drools.core.common.ReteAgenda");
      }
 catch (      Exception e) {
        throw new RuntimeException(e);
      }
    }
  }
  return componentFactory;
}
