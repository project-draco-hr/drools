{
  String drl="";
  drl+="package test\n";
  drl+="import org.drools.compiler.Person\n";
  drl+="import org.drools.compiler.Pet\n";
  drl+="import java.util.ArrayList\n";
  drl+="rule test\n";
  drl+="when\n";
  drl+="$person:Person()\n";
  drl+="$pets : ArrayList()\n";
  drl+="   from collect( \n";
  drl+="      Pet(\n";
  drl+="         ownerName == $person.name\n";
  drl+="      )\n";
  drl+="   )\n";
  drl+="then\n";
  drl+="end\n";
  KnowledgeBuilder kbuilder=KnowledgeBuilderFactory.newKnowledgeBuilder();
  kbuilder.add(ResourceFactory.newReaderResource(new StringReader(drl)),ResourceType.DRL);
  KnowledgeBuilderErrors errors=kbuilder.getErrors();
  if (errors.size() > 0) {
    fail(errors.toString());
  }
  assertFalse(kbuilder.hasErrors());
  KnowledgeBase kbase=KnowledgeBaseFactory.newKnowledgeBase();
  kbase.addKnowledgePackages(kbuilder.getKnowledgePackages());
  StatefulKnowledgeSession ksession=createKnowledgeSession(kbase);
  ksession.insert(new Person("Toni"));
  ksession.insert(new Pet("Toni"));
}
