{
  final EventSupport eventsupport=(EventSupport)this.workingMemory;
  ((InternalAgendaGroup)agendaGroup).setClearedForRecency(this.workingMemory.getFactHandleFactory().getRecency());
  List<RuleInstanceAgendaItem> lazyItems=null;
  if (this.unlinkingEnabled) {
    lazyItems=new ArrayList<RuleInstanceAgendaItem>();
  }
  for (  Activation aQueueable : ((InternalAgendaGroup)agendaGroup).getAndClear()) {
    final AgendaItem item=(AgendaItem)aQueueable;
    if (item == null) {
      continue;
    }
    if (this.unlinkingEnabled && item.isRuleNetworkEvaluatorActivation()) {
      lazyItems.add((RuleInstanceAgendaItem)item);
      continue;
    }
    item.setActivated(false);
    if (item.getActivationGroupNode() != null) {
      item.getActivationGroupNode().getActivationGroup().removeActivation(item);
    }
    if (item.getActivationNode() != null) {
      final InternalRuleFlowGroup ruleFlowGroup=(InternalRuleFlowGroup)item.getActivationNode().getParentContainer();
      ruleFlowGroup.removeActivation(item);
    }
    eventsupport.getAgendaEventSupport().fireActivationCancelled(item,this.workingMemory,MatchCancelledCause.CLEAR);
  }
  if (this.unlinkingEnabled) {
    for (    RuleInstanceAgendaItem lazyItem : lazyItems) {
      ((InternalAgendaGroup)agendaGroup).add(lazyItem);
    }
  }
}
