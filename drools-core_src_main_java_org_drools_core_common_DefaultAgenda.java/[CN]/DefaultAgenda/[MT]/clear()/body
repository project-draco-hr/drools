{
  this.focusStack.clear();
  this.focusStack.add(getMainAgendaGroup());
  if (!this.scheduledActivations.isEmpty()) {
    for (ScheduledAgendaItem item=this.scheduledActivations.removeFirst(); item != null; item=this.scheduledActivations.removeFirst()) {
      item.setEnqueued(false);
      Scheduler.removeAgendaItem(item,this);
    }
  }
  getStageActivationsGroup().clear();
  List<RuleInstanceAgendaItem> lazyItems=null;
  for (  InternalAgendaGroup group : this.agendaGroups.values()) {
    if (this.unlinkingEnabled) {
      ((InternalAgendaGroup)group).setClearedForRecency(this.workingMemory.getFactHandleFactory().getRecency());
      lazyItems=new ArrayList<RuleInstanceAgendaItem>();
      for (      Match a : group.getActivations()) {
        if (((Activation)a).isRuleNetworkEvaluatorActivation()) {
          lazyItems.add((RuleInstanceAgendaItem)a);
        }
      }
    }
    group.clear();
    if (this.unlinkingEnabled) {
      for (      RuleInstanceAgendaItem lazyItem : lazyItems) {
        group.add(lazyItem);
      }
    }
  }
  for (  RuleFlowGroup group : this.ruleFlowGroups.values()) {
    if (this.unlinkingEnabled) {
      ((InternalRuleFlowGroup)group).setClearedForRecency(this.workingMemory.getFactHandleFactory().getRecency());
      lazyItems=new ArrayList<RuleInstanceAgendaItem>();
      for (      Match a : ((InternalRuleFlowGroup)group).getActivations()) {
        if (((Activation)a).isRuleNetworkEvaluatorActivation()) {
          lazyItems.add((RuleInstanceAgendaItem)a);
        }
      }
    }
    group.clear();
    if (this.unlinkingEnabled) {
      for (      RuleInstanceAgendaItem lazyItem : lazyItems) {
        lazyItem.setActivationNode(null);
        ((InternalRuleFlowGroup)group).addActivation(lazyItem);
      }
    }
  }
  for (  ActivationGroup group : this.activationGroups.values()) {
    group.setTriggeredForRecency(this.workingMemory.getFactHandleFactory().getRecency());
    group.clear();
  }
}
