{
  unstageActivations();
  this.halt.set(false);
  int fireCount=0;
  int fireResult=1;
  while (continueFiring(fireLimit) && fireResult >= 0) {
    fireResult=fireNextItem(agendaFilter);
    if (fireResult == 1) {
      fireCount++;
      fireLimit=updateFireLimit(fireLimit);
    }
    this.workingMemory.executeQueuedActions();
  }
  if (this.focusStack.size() == 1 && getMainAgendaGroup().isEmpty()) {
    getMainAgendaGroup().setActive(false);
  }
  return fireCount;
}
