{
  InternalAgendaGroup agendaGroup;
  while (true) {
    agendaGroup=(InternalAgendaGroup)this.focusStack.getLast();
    if (!((InternalRuleFlowGroup)agendaGroup).isAutoDeactivate()) {
      return agendaGroup;
    }
    final boolean empty=agendaGroup.isEmpty();
    if (empty && (this.focusStack.size() > 1)) {
      agendaGroup.setActive(false);
      this.focusStack.removeLast();
      final EventSupport eventsupport=(EventSupport)this.workingMemory;
      eventsupport.getAgendaEventSupport().fireAgendaGroupPopped(agendaGroup,this.workingMemory);
    }
 else {
      agendaGroup=(empty) ? null : agendaGroup;
      break;
    }
  }
  if (agendaGroup != null) {
    if (!agendaGroup.isActive()) {
      agendaGroup.setActivatedForRecency(this.workingMemory.getFactHandleFactory().getRecency());
    }
    agendaGroup.setActive(true);
  }
  return agendaGroup;
}
