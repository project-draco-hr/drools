{
  TimerService clock=workingMemory.getTimerService();
  long currentTime=clock.getCurrentTime();
  SlidingTimeWindowContext queue=(SlidingTimeWindowContext)context;
  EventFactHandle handle=queue.queue.peek();
synchronized (queue.queue) {
    while (handle != null && isExpired(currentTime,handle)) {
      queue.expiringHandle=handle;
      queue.queue.remove();
      if (handle.isValid()) {
        final PropagationContext expiresPctx=new PropagationContextImpl(workingMemory.getNextPropagationIdCounter(),PropagationContext.EXPIRATION,null,null,handle);
        ObjectTypeNode.doRetractObject(handle,expiresPctx,workingMemory);
        expiresPctx.evaluateActionQueue(workingMemory);
      }
      queue.expiringHandle=null;
      handle=queue.queue.peek();
    }
  }
  updateNextExpiration(handle,pctx,workingMemory,memory,this,queue,windowNode);
}
