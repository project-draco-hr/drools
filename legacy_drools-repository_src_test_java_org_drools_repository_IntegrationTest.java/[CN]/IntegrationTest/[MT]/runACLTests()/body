{
  RuleSetDef setA=new RuleSetDef("aclSet",null);
  setA.addRule(new RuleDef("offline1","blah"));
  setA.addRule(new RuleDef("offline2","blah"));
  RepositoryManager repo=RepositoryFactory.getStatefulRepository();
  repo.save(setA);
  repo.close();
  RepositorySecurityManager mgr=new RepositorySecurityManager();
  mgr.enableSecurity(true);
  repo=RepositoryFactory.getRepository(getAclTestUser(),true);
  try {
    setA=repo.loadRuleSet("aclSet",1);
    fail("Should not be allowed to load");
  }
 catch (  RepositorySecurityException e) {
  }
  mgr.addUserToGroup("aclTester","aclTesters");
  mgr.addPermissionToGroup("aclTesters",new AssetPermission(setA,AssetPermission.READ));
  repo.close();
  repo=RepositoryFactory.getRepository(getAclTestUser(),true);
  try {
    setA=repo.loadRuleSet("aclSet",1);
    fail("Should not be allowed to load");
  }
 catch (  RepositorySecurityException e) {
  }
  repo.close();
  mgr.addPermissionToGroup("aclTesters",new AssetPermission(RuleDef.class.getName(),AssetPermission.ALL_INSTANCES,AssetPermission.READ));
  repo=RepositoryFactory.getRepository(getAclTestUser(),true);
  setA=repo.loadRuleSet("aclSet",1);
  assertNotNull(setA);
  repo.close();
  mgr.enableSecurity(false);
  mgr.commitAndClose();
}
