{
  ReteooWorkingMemory wm=(ReteooWorkingMemory)context.wm;
  final boolean multithread=wm.isPartitionManagersActive();
  if (multithread) {
    context.writeBoolean(true);
    wm.stopPartitionManagers();
  }
 else {
    context.writeBoolean(false);
  }
  context.writeInt(wm.getFactHandleFactory().getId());
  context.writeLong(wm.getFactHandleFactory().getRecency());
  InternalFactHandle handle=context.wm.getInitialFactHandle();
  context.writeInt(handle.getId());
  context.writeLong(handle.getRecency());
  context.writeLong(wm.getPropagationIdCounter());
  writeAgenda(context);
  writeFactHandles(context);
  writeActionQueue(context);
  if (wm.getTruthMaintenanceSystem() != null) {
    context.writeBoolean(true);
    writeTruthMaintenanceSystem(context);
  }
 else {
    context.writeBoolean(false);
  }
  if (context.marshalProcessInstances) {
    writeProcessInstances(context);
  }
  if (context.marshalWorkItems) {
    writeWorkItems(context);
  }
  if (context.marshalTimers) {
    writeTimers(context);
  }
  if (multithread) {
    wm.startPartitionManagers();
  }
}
