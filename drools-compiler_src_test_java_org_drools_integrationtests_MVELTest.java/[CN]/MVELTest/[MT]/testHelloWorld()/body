{
  final Reader reader=new InputStreamReader(getClass().getResourceAsStream("test_mvel.drl"));
  RuleBase ruleBase=loadRuleBase(reader);
  ByteArrayOutputStream out=new ByteArrayOutputStream();
  ObjectOutputStream obj=new ObjectOutputStream(out);
  obj.writeObject(ruleBase);
  obj.close();
  byte[] buf=out.toByteArray();
  DroolsObjectInputStream in=new DroolsObjectInputStream(new ByteArrayInputStream(buf));
  ruleBase=(RuleBase)in.readObject();
  final WorkingMemory workingMemory=ruleBase.newStatefulSession();
  final List list=new ArrayList();
  workingMemory.setGlobal("list",list);
  final List list2=new ArrayList();
  workingMemory.setGlobal("list2",list2);
  Cheese c=new Cheese("stilton",10);
  workingMemory.insert(c);
  workingMemory.fireAllRules();
  assertEquals(2,list.size());
  assertEquals(new Integer(30),list.get(0));
  assertEquals(new Integer(22),list.get(1));
  assertEquals("hello world",list2.get(0));
  Date dt=DateUtils.parseDate("10-Jul-1974");
  assertEquals(dt,c.getUsedBy());
}
