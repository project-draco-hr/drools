{
  try {
    Node ruleNode=getVersionContentNode();
    if (StorageEventManager.hasLoadEvent()) {
      return IOUtils.toByteArray(StorageEventManager.getLoadEvent().loadContent(this));
    }
    if (isBinary()) {
      Property data=ruleNode.getProperty(CONTENT_PROPERTY_BINARY_NAME);
      InputStream in=data.getBinary().getStream();
      byte[] bytes=new byte[(int)data.getLength()];
      int offset=0;
      int numRead=0;
      while (offset < bytes.length && (numRead=in.read(bytes,offset,bytes.length - offset)) >= 0) {
        offset+=numRead;
      }
      if (offset < bytes.length) {
        throw new RulesRepositoryException("Could not completely read asset " + getName());
      }
      in.close();
      return bytes;
    }
 else {
      return getContent().getBytes();
    }
  }
 catch (  Exception e) {
    log.error(e.getMessage(),e);
    if (e instanceof RuntimeException)     throw (RuntimeException)e;
    throw new RulesRepositoryException(e);
  }
}
