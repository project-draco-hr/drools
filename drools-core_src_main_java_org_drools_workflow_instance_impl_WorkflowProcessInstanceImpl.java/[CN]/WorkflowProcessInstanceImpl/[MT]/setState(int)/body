{
  super.setState(state);
  if (state == ProcessInstanceImpl.STATE_COMPLETED) {
    ((EventSupport)this.workingMemory).getRuleFlowEventSupport().fireBeforeRuleFlowProcessCompleted(this,this.workingMemory);
    while (!nodeInstances.isEmpty()) {
      NodeInstance nodeInstance=(NodeInstance)nodeInstances.get(0);
      nodeInstance.cancel();
    }
    workingMemory.removeProcessInstance(this);
    ((EventSupport)this.workingMemory).getRuleFlowEventSupport().fireAfterRuleFlowProcessCompleted(this,this.workingMemory);
  }
}
