{
  final PackageBuilder builder=new PackageBuilder();
  final Reader source=new InputStreamReader(getClass().getResourceAsStream("rule_with_expander_dsl_more.drl"));
  final Reader dsl=new InputStreamReader(getClass().getResourceAsStream("test_expander.dsl"));
  builder.addPackageFromDrl(source,dsl);
  final Package pkg=builder.getPackage();
  assertTrue(pkg.isValid());
  assertEquals(null,pkg.getErrorSummary());
  final String err=builder.printErrors();
  assertEquals("",err);
  assertEquals(0,builder.getErrors().length);
  final RuleBase ruleBase=getRuleBase();
  ruleBase.addPackage(pkg);
  final WorkingMemory wm=ruleBase.newWorkingMemory();
  wm.assertObject("rage");
  wm.assertObject(new Integer(66));
  final List messages=new ArrayList();
  wm.setGlobal("messages",messages);
  wm.fireAllRules();
  assertEquals(0,messages.size());
  wm.assertObject("fire");
  wm.fireAllRules();
  assertEquals(0,messages.size());
  wm.assertObject(new Integer(42));
  wm.fireAllRules();
  assertEquals(1,messages.size());
}
