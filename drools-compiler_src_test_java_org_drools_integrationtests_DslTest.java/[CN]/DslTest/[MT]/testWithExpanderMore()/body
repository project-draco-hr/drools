{
  final PackageBuilder builder=new PackageBuilder();
  final Reader source=new InputStreamReader(getClass().getResourceAsStream("rule_with_expander_dsl_more.dslr"));
  final Reader dsl=new InputStreamReader(getClass().getResourceAsStream("test_expander.dsl"));
  builder.addPackageFromDrl(source,dsl);
  final Package pkg=builder.getPackage();
  assertTrue(pkg.isValid());
  assertEquals(null,pkg.getErrorSummary());
  final String err=builder.getErrors().toString();
  assertEquals("",err);
  assertEquals(0,builder.getErrors().getErrors().length);
  RuleBase ruleBase=getRuleBase();
  ruleBase.addPackage(pkg);
  ruleBase=SerializationHelper.serializeObject(ruleBase);
  WorkingMemory wm=ruleBase.newStatefulSession();
  wm.insert(new Person("rage"));
  wm.insert(new Cheese("cheddar",15));
  final List messages=new ArrayList();
  wm.setGlobal("messages",messages);
  wm.fireAllRules();
  assertEquals(0,messages.size());
  wm.insert(new Person("fire"));
  wm.fireAllRules();
  assertEquals(0,messages.size());
  wm.insert(new Cheese("brie",15));
  wm.fireAllRules();
  assertEquals(1,messages.size());
}
