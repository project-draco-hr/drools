{
  String xml="";
  xml+="<change-set xmlns='http://drools.org/drools-5.0/change-set'";
  xml+="    xmlns:xs='http://www.w3.org/2001/XMLSchema-instance'";
  xml+="    xs:schemaLocation='http://drools.org/drools-5.0/change-set drools-change-set-5.0.xsd' >";
  xml+="    <add> ";
  xml+="        <resource source='classpath:pkg/mortgages.pkg' type='PKG' />";
  xml+="    </add> ";
  xml+="</change-set>";
  KnowledgeBase kbase=KnowledgeBaseFactory.newKnowledgeBase();
  KnowledgeAgent kagent=this.createKAgent(kbase,true);
  kagent.applyChangeSet(ResourceFactory.newByteArrayResource(xml.getBytes()));
  this.kbaseUpdated=false;
  assertEquals(1,kagent.getKnowledgeBase().getKnowledgePackages().size());
  Thread.sleep(2000);
  ClassPathResource cpResource=(ClassPathResource)ResourceFactory.newClassPathResource("pkg/mortgages.pkg");
  File f=new File(cpResource.getURL().getFile());
  assertTrue(f.exists());
  f.setLastModified(System.currentTimeMillis());
  this.waitUntilKBaseUpdate();
  assertEquals(1,kagent.getKnowledgeBase().getKnowledgePackages().size());
  kagent.dispose();
}
