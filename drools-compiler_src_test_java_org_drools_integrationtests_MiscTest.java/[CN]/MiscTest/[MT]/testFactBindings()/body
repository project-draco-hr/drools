{
  final PackageBuilder builder=new PackageBuilder();
  builder.addPackageFromDrl(new InputStreamReader(getClass().getResourceAsStream("test_FactBindings.drl")));
  final Package pkg=builder.getPackage();
  final RuleBase ruleBase=getRuleBase();
  ruleBase.addPackage(pkg);
  final WorkingMemory workingMemory=ruleBase.newStatefulSession();
  final List events=new ArrayList();
  final WorkingMemoryEventListener listener=new DefaultWorkingMemoryEventListener(){
    public void objectModified(    ObjectModifiedEvent event){
      events.add(event);
    }
  }
;
  workingMemory.addEventListener(listener);
  final Person bigCheese=new Person("big cheese");
  final Cheese cheddar=new Cheese("cheddar",15);
  bigCheese.setCheese(cheddar);
  final FactHandle bigCheeseHandle=workingMemory.assertObject(bigCheese);
  final FactHandle cheddarHandle=workingMemory.assertObject(cheddar);
  workingMemory.fireAllRules();
  ObjectModifiedEvent event=(ObjectModifiedEvent)events.get(0);
  assertSame(cheddarHandle,event.getFactHandle());
  assertSame(cheddar,event.getOldObject());
  assertSame(cheddar,event.getObject());
  event=(ObjectModifiedEvent)events.get(1);
  assertSame(bigCheeseHandle,event.getFactHandle());
  assertSame(bigCheese,event.getOldObject());
  assertSame(bigCheese,event.getObject());
}
