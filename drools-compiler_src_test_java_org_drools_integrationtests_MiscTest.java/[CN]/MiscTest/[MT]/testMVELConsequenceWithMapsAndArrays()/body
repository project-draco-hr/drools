{
  String rule="package org.test;\n";
  rule+="import java.util.ArrayList\n";
  rule+="import java.util.HashMap\n";
  rule+="global java.util.List list\n";
  rule+="rule \"Test Rule\"\n";
  rule+="    dialect \"mvel\"";
  rule+="when\n";
  rule+="then\n";
  rule+="    m = new HashMap();\n";
  rule+="    l = new ArrayList();\n";
  rule+="    l.add(\"first\");\n";
  rule+="    m.put(\"content\", l);\n";
  rule+="    System.out.println(((ArrayList)m[\"content\"])[0]);\n";
  rule+="    list.add(((ArrayList)m[\"content\"])[0]);\n";
  rule+="end";
  final PackageBuilder builder=new PackageBuilder();
  builder.addPackageFromDrl(new StringReader(rule));
  final Package pkg=builder.getPackage();
  final RuleBase ruleBase=getRuleBase();
  ruleBase.addPackage(pkg);
  StatefulSession session=ruleBase.newStatefulSession();
  List list=new ArrayList();
  session.setGlobal("list",list);
  session=SerializationHelper.getSerialisedStatefulSession(session,ruleBase);
  session.fireAllRules();
  assertEquals(1,((List)session.getGlobal("list")).size());
  assertEquals("first",((List)session.getGlobal("list")).get(0));
}
