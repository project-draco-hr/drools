{
  PackageBuilder builder=new PackageBuilder();
  builder.addPackageFromDrl(new InputStreamReader(MiscTest.class.getResourceAsStream("test_CrossProductRemovingIdentityEquals.drl")));
  RuleBaseConfiguration conf=new RuleBaseConfiguration();
  conf.setShadowProxy(true);
  RuleBase rb=RuleBaseFactory.newRuleBase(conf);
  rb.addPackage(builder.getPackage());
  StatefulSession session=rb.newStatefulSession();
  List list1=new ArrayList();
  List list2=new ArrayList();
  session.setGlobal("list1",list1);
  session.setGlobal("list2",list2);
  SpecialString first42=new SpecialString("42");
  SpecialString second43=new SpecialString("42");
  SpecialString world=new SpecialString("World");
  session.insert(world);
  session.insert(first42);
  session.insert(second43);
  session.fireAllRules();
  assertEquals(6,list1.size());
  assertEquals(6,list2.size());
  assertEquals(second43,list1.get(0));
  assertEquals(first42,list1.get(1));
  assertEquals(world,list1.get(2));
  assertEquals(second43,list1.get(3));
  assertEquals(first42,list1.get(4));
  assertEquals(world,list1.get(5));
  assertEquals(first42,list2.get(0));
  assertEquals(second43,list2.get(1));
  assertEquals(second43,list2.get(2));
  assertEquals(world,list2.get(3));
  assertEquals(world,list2.get(4));
  assertEquals(first42,list2.get(5));
}
