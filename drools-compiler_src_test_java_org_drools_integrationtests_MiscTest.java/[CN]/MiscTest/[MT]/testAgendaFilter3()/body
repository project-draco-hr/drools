{
  String str="package org.drools\n" + "rule Aaa when then end\n" + "rule Bbb when then end\n";
  KnowledgeBase kbase=loadKnowledgeBaseFromString(str);
  StatefulKnowledgeSession ksession=createKnowledgeSession(kbase);
  org.kie.event.rule.AgendaEventListener ael=mock(org.kie.event.rule.AgendaEventListener.class);
  ksession.addEventListener(ael);
  RuleNameMatchesAgendaFilter af=new RuleNameMatchesAgendaFilter(".*b.");
  int rules=ksession.fireAllRules(af);
  assertEquals(1,rules);
  ArgumentCaptor<org.kie.event.rule.AfterMatchFiredEvent> arg=ArgumentCaptor.forClass(org.kie.event.rule.AfterMatchFiredEvent.class);
  verify(ael).afterActivationFired(arg.capture());
  assertThat(arg.getValue().getMatch().getRule().getName(),is("Bbb"));
}
