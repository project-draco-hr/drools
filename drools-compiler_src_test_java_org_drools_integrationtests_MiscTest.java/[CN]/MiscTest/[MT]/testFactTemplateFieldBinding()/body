{
  String rule1="package org.drools.entity\n";
  rule1+=" global java.util.List list\n";
  rule1+="template Settlement\n";
  rule1+="    String InstrumentType\n";
  rule1+="    String InstrumentName\n";
  rule1+="end\n" + "rule TestEntity\n";
  rule1+="    when\n";
  rule1+="        Settlement(InstrumentType == \"guitar\", name : InstrumentName)\n";
  rule1+="    then \n";
  rule1+="        list.add( name ) ;\n";
  rule1+="end\n";
  PackageBuilder builder=new PackageBuilder();
  builder.addPackageFromDrl(new StringReader(rule1));
  Package pkg=builder.getPackage();
  RuleBase ruleBase=RuleBaseFactory.newRuleBase();
  ruleBase.addPackage(pkg);
  WorkingMemory wm=ruleBase.newStatefulSession();
  List list=new ArrayList();
  wm.setGlobal("list",list);
  final FactTemplate cheese=pkg.getFactTemplate("Settlement");
  final Fact guitar=cheese.createFact(0);
  guitar.setFieldValue("InstrumentType","guitar");
  guitar.setFieldValue("InstrumentName","gibson");
  wm.insert(guitar);
  wm.fireAllRules();
  assertEquals("gibson",list.get(0));
}
