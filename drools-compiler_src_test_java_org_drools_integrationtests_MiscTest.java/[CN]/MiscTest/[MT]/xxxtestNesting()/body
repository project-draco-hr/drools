{
  Person p=new Person();
  p.setName("Michael");
  Address add1=new Address();
  add1.setStreet("High");
  Address add2=new Address();
  add2.setStreet("Low");
  List l=new ArrayList();
  l.add(add1);
  l.add(add2);
  p.setAddresses(l);
  final PackageBuilder builder=new PackageBuilder();
  builder.addPackageFromDrl(new InputStreamReader(getClass().getResourceAsStream("nested_fields.drl")));
  assertFalse(builder.getErrors().toString(),builder.hasErrors());
  DrlParser parser=new DrlParser();
  PackageDescr desc=parser.parse(new InputStreamReader(getClass().getResourceAsStream("nested_fields.drl")));
  List packageAttrs=desc.getAttributes();
  assertEquals(1,desc.getRules().size());
  assertEquals(1,packageAttrs.size());
  RuleDescr rule=(RuleDescr)desc.getRules().get(0);
  List ruleAttrs=rule.getAttributes();
  assertEquals(1,ruleAttrs.size());
  assertEquals("mvel",((AttributeDescr)ruleAttrs.get(0)).getValue());
  assertEquals("dialect",((AttributeDescr)ruleAttrs.get(0)).getName());
  final RuleBase ruleBase=getRuleBase();
  ruleBase.addPackage(builder.getPackage());
  final WorkingMemory memory=ruleBase.newStatefulSession();
  memory.insert(p);
  memory.fireAllRules();
}
