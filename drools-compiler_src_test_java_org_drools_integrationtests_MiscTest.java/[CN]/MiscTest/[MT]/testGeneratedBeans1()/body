{
  final PackageBuilderConfiguration pbconf=new PackageBuilderConfiguration();
  pbconf.setDumpDir(new File("target"));
  final PackageBuilder builder=new PackageBuilder(pbconf);
  builder.addPackageFromDrl(new InputStreamReader(getClass().getResourceAsStream("test_GeneratedBeans.drl")));
  assertFalse(builder.getErrors().toString(),builder.hasErrors());
  Package p=builder.getPackage();
  assertEquals(2,p.getRules().length);
  RuleBaseConfiguration conf=new RuleBaseConfiguration();
  RuleBase ruleBase=RuleBaseFactory.newRuleBase(conf);
  ruleBase.addPackage(p);
  ruleBase=SerializationHelper.serializeObject(ruleBase);
  FactType cheeseFact=ruleBase.getFactType("org.drools.generatedbeans.Cheese");
  Object cheese=cheeseFact.newInstance();
  cheeseFact.set(cheese,"type","stilton");
  assertEquals("stilton",cheeseFact.get(cheese,"type"));
  assertEquals("stilton",cheeseFact.getField("type").getFieldAccessor().getValue(cheese));
  StatefulSession wm=ruleBase.newStatefulSession();
  List result=new ArrayList();
  wm.setGlobal("list",result);
  wm.insert(cheese);
  wm.fireAllRules();
  assertEquals(1,result.size());
  assertEquals(new Integer(5),result.get(0));
  FactType personFact=ruleBase.getFactType("org.drools.generatedbeans.Person");
  Object person=personFact.newInstance();
  personFact.getField("likes").getFieldAccessor().setValue(person,cheese);
  personFact.getField("age").getFieldAccessor().setIntValue(person,7);
  wm.insert(person);
  wm.fireAllRules();
  assertEquals(2,result.size());
  assertEquals(person,result.get(1));
}
