{
  KnowledgeBuilder kbuilder=KnowledgeBuilderFactory.newKnowledgeBuilder();
  kbuilder.add(ResourceFactory.newClassPathResource("test_AgendaGroups.drl",getClass()),ResourceType.DRL);
  assertFalse(kbuilder.hasErrors());
  KnowledgeBase kbase=KnowledgeBaseFactory.newKnowledgeBase();
  kbase.addKnowledgePackages(kbuilder.getKnowledgePackages());
  kbase=SerializationHelper.serializeObject(kbase);
  final StatefulKnowledgeSession session=createKnowledgeSession(kbase);
  final List list=new ArrayList();
  session.setGlobal("list",list);
  final Cheese brie=new Cheese("brie",12);
  session.insert(brie);
  session.fireAllRules();
  assertEquals(7,list.size());
  assertEquals("group3",list.get(0));
  assertEquals("group4",list.get(1));
  assertEquals("group3",list.get(2));
  assertEquals("MAIN",list.get(3));
  assertEquals("group1",list.get(4));
  assertEquals("group1",list.get(5));
  assertEquals("MAIN",list.get(6));
  session.getAgenda().getAgendaGroup("group2").setFocus();
  session.fireAllRules();
  assertEquals(8,list.size());
  assertEquals("group2",list.get(7));
  list.clear();
  session.insert(new Cheese("cheddar"));
  session.getAgenda().getAgendaGroup("MAIN").clear();
  session.fireAllRules();
  assertEquals(3,list.size());
  assertEquals("group3",list.get(0));
  assertEquals("group4",list.get(1));
  assertEquals("group3",list.get(2));
}
