{
  KieProject kproj=new KieProjectImpl();
  kproj.setGroupArtifactVersion(new GroupArtifactVersion("org.test",namespace,"0.1"));
  kproj.setKProjectPath("src/main/resources/");
  kproj.setKBasesPath("src/kbases");
  KieBaseDescr kieBaseDescr1=kproj.newKieBaseDescr(namespace + ".KBase1").setAnnotations(asList("@ApplicationScoped; @Inject")).setEqualsBehavior(AssertBehaviorOption.EQUALITY).setEventProcessingMode(EventProcessingOption.STREAM);
  KieSessionDescr ksession1=kieBaseDescr1.newKieSessionDescr(namespace + ".KSession1").setType("stateless").setAnnotations(asList("@ApplicationScoped; @Inject")).setClockType(ClockTypeOption.get("realtime"));
  KieSessionDescr ksession2=kieBaseDescr1.newKieSessionDescr(namespace + ".KSession2").setType("stateful").setAnnotations(asList("@ApplicationScoped; @Inject")).setClockType(ClockTypeOption.get("pseudo"));
  KieBaseDescr kieBaseDescr2=kproj.newKieBaseDescr(namespace + ".KBase2").setAnnotations(asList("@ApplicationScoped")).setEqualsBehavior(AssertBehaviorOption.IDENTITY).setEventProcessingMode(EventProcessingOption.CLOUD);
  KieSessionDescr ksession3=kieBaseDescr2.newKieSessionDescr(namespace + ".KSession3").setType("stateful").setAnnotations(asList("@ApplicationScoped")).setClockType(ClockTypeOption.get("pseudo"));
  KieBaseDescr kieBaseDescr3=kproj.newKieBaseDescr(namespace + ".KBase3").addInclude(kieBaseDescr1.getName()).addInclude(kieBaseDescr2.getName()).setAnnotations(asList("@ApplicationScoped")).setEqualsBehavior(AssertBehaviorOption.IDENTITY).setEventProcessingMode(EventProcessingOption.CLOUD);
  KieSessionDescr ksession4=kieBaseDescr3.newKieSessionDescr(namespace + ".KSession4").setType("stateless").setAnnotations(asList("@ApplicationScoped")).setClockType(ClockTypeOption.get("pseudo"));
  MemoryFileSystem mfs=new MemoryFileSystem();
  Folder fld2=mfs.getFolder("META-INF");
  fld2.create();
  File fle2=fld2.getFile("beans.xml");
  fle2.create(new ByteArrayInputStream(generateBeansXML(kproj).getBytes()));
  fle2=fld2.getFile("kproject.xml");
  fle2.create(new ByteArrayInputStream(((KieProjectImpl)kproj).toXML().getBytes()));
  String kBase1R1=getRule(namespace + ".test1","rule1");
  String kBase1R2=getRule(namespace + ".test1","rule2");
  String kbase2R1=getRule(namespace + ".test2","rule1");
  String kbase2R2=getRule(namespace + ".test2","rule2");
  String fldKB1=kproj.getKBasesPath() + "/" + kieBaseDescr1.getName();
  String fldKB2=kproj.getKBasesPath() + "/" + kieBaseDescr2.getName();
  mfs.getFolder(fldKB1).create();
  mfs.getFolder(fldKB2).create();
  mfs.getFile(fldKB1 + "/rule1.drl").create(new ByteArrayInputStream(kBase1R1.getBytes()));
  mfs.getFile(fldKB1 + "/rule2.drl").create(new ByteArrayInputStream(kBase1R2.getBytes()));
  mfs.getFile(fldKB2 + "/rule1.drl").create(new ByteArrayInputStream(kbase2R1.getBytes()));
  mfs.getFile(fldKB2 + "/rule2.drl").create(new ByteArrayInputStream(kbase2R2.getBytes()));
  MemoryFileSystem trgMfs=new MemoryFileSystem();
  MemoryFileSystem srcMfs=mfs;
  Folder fld1=trgMfs.getFolder("org/drools/cdi/test");
  fld1.create();
  File fle1=fld1.getFile("KProjectTestClass" + namespace + ".java");
  fle1.create(new ByteArrayInputStream(generateKProjectTestClass(kproj,namespace).getBytes()));
  List<String> inputClasses=new ArrayList<String>();
  inputClasses.add("org/drools/cdi/test/KProjectTestClass" + namespace + ".java");
  compile(kproj,srcMfs,trgMfs,inputClasses);
  if (createJar) {
    trgMfs.writeAsJar(fileManager.getRootDirectory(),namespace);
  }
 else {
    writeFs(namespace,trgMfs);
  }
}
