{
  KieModuleModel kproj=new KieModuleModelImpl();
  KieBaseModel kieBaseModel1=kproj.newKieBaseModel(namespace + ".KBase1").setEqualsBehavior(AssertBehaviorOption.EQUALITY).setEventProcessingMode(EventProcessingOption.STREAM);
  KieSessionModel ksession1=kieBaseModel1.newKieSessionModel(namespace + ".KSession1").setType("stateless").setClockType(ClockTypeOption.get("realtime"));
  KieSessionModel ksession2=kieBaseModel1.newKieSessionModel(namespace + ".KSession2").setType("stateful").setClockType(ClockTypeOption.get("pseudo"));
  KieBaseModel kieBaseModel2=kproj.newKieBaseModel(namespace + ".KBase2").setEqualsBehavior(AssertBehaviorOption.IDENTITY).setEventProcessingMode(EventProcessingOption.CLOUD);
  KieSessionModel ksession3=kieBaseModel2.newKieSessionModel(namespace + ".KSession3").setType("stateful").setClockType(ClockTypeOption.get("pseudo"));
  KieBaseModel kieBaseModel3=kproj.newKieBaseModel(namespace + ".KBase3").addInclude(kieBaseModel1.getName()).addInclude(kieBaseModel2.getName()).setEqualsBehavior(AssertBehaviorOption.IDENTITY).setEventProcessingMode(EventProcessingOption.CLOUD);
  KieSessionModel ksession4=kieBaseModel3.newKieSessionModel(namespace + ".KSession4").setType("stateless").setClockType(ClockTypeOption.get("pseudo"));
  KieFileSystemImpl kfs=(KieFileSystemImpl)KieFactory.Factory.get().newKieFileSystem();
  kfs.write("src/main/resources/META-INF/beans.xml",generateBeansXML(kproj));
  kfs.writeKModuleXML(((KieModuleModelImpl)kproj).toXML());
  GAV gav=KieFactory.Factory.get().newGav(namespace,"art1","1.0-SNAPSHOT");
  kfs.generateAndWritePomXML(gav);
  String kBase1R1=getRule(namespace + ".test1","rule1");
  String kBase1R2=getRule(namespace + ".test1","rule2");
  String kbase2R1=getRule(namespace + ".test2","rule1");
  String kbase2R2=getRule(namespace + ".test2","rule2");
  String fldKB1="src/main/resources/" + kieBaseModel1.getName().replace('.','/');
  String fldKB2="src/main/resources/" + kieBaseModel2.getName().replace('.','/');
  kfs.write(fldKB1 + "/rule1.drl",kBase1R1.getBytes());
  kfs.write(fldKB1 + "/rule2.drl",kBase1R2.getBytes());
  kfs.write(fldKB2 + "/rule1.drl",kbase2R1.getBytes());
  kfs.write(fldKB2 + "/rule2.drl",kbase2R2.getBytes());
  kfs.write("src/main/java/org/drools/cdi/test/KProjectTestClass" + namespace + ".java",generateKProjectTestClass(kproj,namespace));
  KieServices ks=KieServices.Factory.get();
  KieBuilder kBuilder=ks.newKieBuilder(kfs);
  kBuilder.build();
  if (kBuilder.hasResults(Level.ERROR)) {
    fail("should not have errors" + kBuilder.getResults());
  }
  MemoryKieModule kieModule=(MemoryKieModule)kBuilder.getKieModule();
  MemoryFileSystem trgMfs=kieModule.getMemoryFileSystem();
  if (createJar) {
    trgMfs.writeAsJar(fileManager.getRootDirectory(),namespace);
  }
 else {
    java.io.File file=fileManager.newFile(namespace);
    trgMfs.writeAsFs(file);
  }
  return kproj;
}
