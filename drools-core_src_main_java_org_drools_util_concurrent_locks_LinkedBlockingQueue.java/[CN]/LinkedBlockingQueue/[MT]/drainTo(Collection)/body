{
  if (c == null)   throw new NullPointerException();
  if (c == this)   throw new IllegalArgumentException();
  Node first;
synchronized (putLock) {
synchronized (takeLock) {
      first=head.next;
      head.next=null;
      last=head;
      int cold;
synchronized (this) {
        cold=count;
        count=0;
      }
      if (cold == capacity)       putLock.notifyAll();
    }
  }
  int n=0;
  for (Node p=first; p != null; p=p.next) {
    c.add(p.item);
    p.item=null;
    ++n;
  }
  return n;
}
