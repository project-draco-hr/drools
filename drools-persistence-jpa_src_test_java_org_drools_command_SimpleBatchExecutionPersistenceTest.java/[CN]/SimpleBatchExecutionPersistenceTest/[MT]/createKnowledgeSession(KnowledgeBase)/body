{
  if (context == null) {
    context=PersistenceUtil.setupWithPoolingDataSource(DROOLS_PERSISTENCE_UNIT_NAME);
  }
  KnowledgeSessionConfiguration ksconf=KnowledgeBaseFactory.newKnowledgeSessionConfiguration();
  return JPAKnowledgeService.newStatefulKnowledgeSession(kbase,ksconf,createEnvironment(context));
}
