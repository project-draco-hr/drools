{
  InternalResource res=(InternalResource)resource;
  try {
    String urlPath=res.getURL().toExternalForm();
    if (res.isDirectory()) {
      if (!urlPath.endsWith("/")) {
        urlPath=urlPath + "/";
      }
      urlPath=urlPath + "META-INF/kproject.xml";
    }
 else {
      urlPath="jar:" + urlPath + "!/"+ KieModuleModelImpl.KMODULE_JAR_PATH;
    }
    KieModule kModule=ClasspathKieProject.fetchKModule(new URL(urlPath));
    return kModule;
  }
 catch (  Exception e) {
    throw new RuntimeException("Unable to fetch module from resource :" + res,e);
  }
}
