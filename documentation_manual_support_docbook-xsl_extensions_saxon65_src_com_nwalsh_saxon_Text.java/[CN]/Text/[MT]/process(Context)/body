{
  Outputter out=context.getOutputter();
  String hrefAtt=getAttribute("href");
  Expression hrefExpr=makeAttributeValueTemplate(hrefAtt);
  String href=hrefExpr.evaluateAsString(context);
  String encodingAtt=getAttribute("encoding");
  Expression encodingExpr=makeAttributeValueTemplate(encodingAtt);
  String encoding=encodingExpr.evaluateAsString(context);
  String baseURI=context.getContextNodeInfo().getBaseURI();
  URIResolver resolver=context.getController().getURIResolver();
  if (resolver != null) {
    Source source=resolver.resolve(href,baseURI);
    href=source.getSystemId();
  }
  URL baseURL=null;
  URL fileURL=null;
  try {
    baseURL=new URL(baseURI);
  }
 catch (  MalformedURLException e0) {
    baseURL=null;
  }
  try {
    try {
      fileURL=new URL(baseURL,href);
    }
 catch (    MalformedURLException e1) {
      try {
        fileURL=new URL(baseURL,"file:" + href);
      }
 catch (      MalformedURLException e2) {
        System.out.println("Cannot open " + href);
        return;
      }
    }
    InputStreamReader isr=null;
    if (encoding.equals("") == true)     isr=new InputStreamReader(fileURL.openStream());
 else     isr=new InputStreamReader(fileURL.openStream(),encoding);
    BufferedReader is=new BufferedReader(isr);
    final int BUFFER_SIZE=4096;
    char chars[]=new char[BUFFER_SIZE];
    char nchars[]=new char[BUFFER_SIZE];
    int len=0;
    int i=0;
    int carry=-1;
    while ((len=is.read(chars)) > 0) {
      int nlen=0;
      for (i=0; i < len; i++) {
        if (chars[i] == '\r') {
          if (i < (len - 1)) {
            if (chars[i + 1] == '\n')             continue;
            nchars[nlen]='\n';
            nlen++;
            continue;
          }
 else {
            carry=is.read();
            nchars[nlen]='\n';
            nlen++;
            if (carry == '\n') {
              carry=-1;
            }
            break;
          }
        }
        nchars[nlen]=chars[i];
        nlen++;
      }
      out.writeContent(nchars,0,nlen);
      if (carry != -1)       out.writeContent(String.valueOf((char)carry));
      carry=-1;
    }
    is.close();
  }
 catch (  Exception e) {
    System.out.println("Cannot read " + href);
  }
}
