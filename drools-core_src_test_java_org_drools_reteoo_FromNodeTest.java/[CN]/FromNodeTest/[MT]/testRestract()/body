{
  final PropagationContext context=new PropagationContextImpl(0,PropagationContext.ASSERTION,null,null);
  final ReteooWorkingMemory workingMemory=new ReteooWorkingMemory(1,(ReteooRuleBase)RuleBaseFactory.newRuleBase());
  final ClassFieldExtractor extractor=new ClassFieldExtractor(Cheese.class,"type");
  final FieldValue field=new MockField("stilton");
  final LiteralConstraint constraint=new LiteralConstraint(extractor,ValueType.STRING_TYPE.getEvaluator(Operator.EQUAL),field);
  List list=new ArrayList();
  Cheese cheese1=new Cheese("stilton",5);
  Cheese cheese2=new Cheese("stilton",15);
  list.add(cheese1);
  list.add(cheese2);
  MockDataProvider dataProvider=new MockDataProvider(list);
  FromNode from=new FromNode(3,dataProvider,null,new FieldConstraint[]{constraint},null);
  MockTupleSink sink=new MockTupleSink(5);
  from.addTupleSink(sink);
  List asserted=sink.getAsserted();
  Person person1=new Person("xxx2",30);
  FactHandle person1Handle=workingMemory.assertObject(person1);
  ReteTuple tuple=new ReteTuple((DefaultFactHandle)person1Handle);
  from.assertTuple(tuple,context,workingMemory);
  assertEquals(2,asserted.size());
  BetaMemory memory=(BetaMemory)workingMemory.getNodeMemory(from);
  assertEquals(1,memory.getLeftTupleMemory().size());
  assertEquals(0,memory.getRightObjectMemory().size());
  assertEquals(2,tuple.getTupleMatches().size());
  list=new ArrayList();
  for (Iterator it=tuple.getTupleMatches().values().iterator(); it.hasNext(); ) {
    TupleMatch tupleMatch=(TupleMatch)it.next();
    list.add(tupleMatch.getObjectMatches().getFactHandle().getObject());
  }
  assertEquals(2,list.size());
  assertTrue(list.contains(cheese1));
  assertTrue(list.contains(cheese2));
  from.retractTuple(tuple,context,workingMemory);
  assertEquals(0,memory.getLeftTupleMemory().size());
  assertEquals(0,memory.getRightObjectMemory().size());
}
