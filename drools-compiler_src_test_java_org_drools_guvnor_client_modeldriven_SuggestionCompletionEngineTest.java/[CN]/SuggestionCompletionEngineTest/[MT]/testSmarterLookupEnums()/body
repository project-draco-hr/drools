{
  final SuggestionCompletionEngine sce=new SuggestionCompletionEngine();
  sce.dataEnumLists=new HashMap();
  sce.dataEnumLists.put("Fact.type",new String[]{"sex","colour"});
  sce.dataEnumLists.put("Fact.value[f1, f2]",new String[]{"select something from database where x=@{f1} and y=@{f2}"});
  FactPattern fp=new FactPattern("Fact");
  String[] drops=sce.getEnums(fp,"type").fixedList;
  assertEquals(2,drops.length);
  assertEquals("sex",drops[0]);
  assertEquals("colour",drops[1]);
  Map lookupFields=sce.loadDataEnumLookupFields();
  assertEquals(1,lookupFields.size());
  String[] flds=(String[])lookupFields.get("Fact.value");
  assertEquals(2,flds.length);
  assertEquals("f1",flds[0]);
  assertEquals("f2",flds[1]);
  FactPattern pat=new FactPattern("Fact");
  SingleFieldConstraint sfc=new SingleFieldConstraint("f1");
  sfc.value="f1val";
  pat.addConstraint(sfc);
  sfc=new SingleFieldConstraint("f2");
  sfc.value="f2val";
  pat.addConstraint(sfc);
  DropDownData dd=sce.getEnums(pat,"value");
  assertNull(dd.fixedList);
  assertNotNull(dd.queryExpression);
  assertNotNull(dd.valuePairs);
  assertEquals(2,dd.valuePairs.length);
  assertEquals("select something from database where x=@{f1} and y=@{f2}",dd.queryExpression);
  assertEquals("f1=f1val",dd.valuePairs[0]);
  assertEquals("f2=f2val",dd.valuePairs[1]);
  ActionFieldValue[] vals=new ActionFieldValue[2];
  vals[0]=new ActionFieldValue("f1","f1val","blah");
  vals[1]=new ActionFieldValue("f2","f2val","blah");
  dd=sce.getEnums("Fact",vals,"value");
  assertNull(dd.fixedList);
  assertNotNull(dd.queryExpression);
  assertNotNull(dd.valuePairs);
  assertEquals(2,dd.valuePairs.length);
  assertEquals("select something from database where x=@{f1} and y=@{f2}",dd.queryExpression);
  assertEquals("f1=f1val",dd.valuePairs[0]);
  assertEquals("f2=f2val",dd.valuePairs[1]);
}
