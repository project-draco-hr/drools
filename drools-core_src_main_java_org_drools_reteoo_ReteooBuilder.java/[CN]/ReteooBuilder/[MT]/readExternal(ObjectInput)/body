{
  boolean isDrools=in instanceof DroolsObjectInputStream;
  DroolsObjectInputStream droolsStream;
  ByteArrayInputStream bytes;
  if (isDrools) {
    bytes=null;
    droolsStream=(DroolsObjectInputStream)in;
  }
 else {
    bytes=new ByteArrayInputStream((byte[])in.readObject());
    droolsStream=new DroolsObjectInputStream(bytes);
  }
  this.rules=(Map)in.readObject();
  this.idGenerator=(IdGenerator)in.readObject();
  this.ordered=in.readBoolean();
  this.ruleBase=droolsStream.getRuleBase();
  if (!isDrools) {
    bytes.close();
  }
  this.ruleBuilder=new ReteooRuleBuilder();
}
