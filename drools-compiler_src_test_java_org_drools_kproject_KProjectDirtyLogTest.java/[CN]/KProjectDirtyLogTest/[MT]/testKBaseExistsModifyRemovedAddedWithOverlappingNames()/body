{
  KProject kproj=new KProjectImpl();
  KProjectChangeLog dirtyLog=new KProjectChangeLog();
  kproj.setListener(dirtyLog);
  KBase kbase1=kproj.newKBase("org.test1","KBase1");
  KBase kbase2=kproj.newKBase("org.test1","KBase2");
  dirtyLog.reset();
  kbase1.setNamespace("org.test2");
  kbase2.setName("KBase1");
  assertEquals(1,dirtyLog.getRemovedKBases().size());
  assertEquals(2,dirtyLog.getAddedKBases().size());
  assertTrue(dirtyLog.getAddedKBases().contains("org.test2.KBase1"));
  assertTrue(dirtyLog.getAddedKBases().contains("org.test1.KBase1"));
  assertTrue(dirtyLog.getRemovedKBases().contains("org.test1.KBase2"));
  kproj.removeKBase(kbase1.getQName());
  assertEquals(2,dirtyLog.getRemovedKBases().size());
  assertEquals(1,dirtyLog.getAddedKBases().size());
  assertTrue(dirtyLog.getRemovedKBases().contains("org.test2.KBase1"));
  assertTrue(dirtyLog.getRemovedKBases().contains("org.test1.KBase2"));
  assertTrue(dirtyLog.getAddedKBases().contains("org.test1.KBase1"));
  kproj.removeKBase(kbase2.getQName());
  assertEquals(3,dirtyLog.getRemovedKBases().size());
  assertEquals(0,dirtyLog.getAddedKBases().size());
  assertTrue(dirtyLog.getRemovedKBases().contains("org.test2.KBase1"));
  assertTrue(dirtyLog.getRemovedKBases().contains("org.test1.KBase1"));
  assertTrue(dirtyLog.getRemovedKBases().contains("org.test1.KBase2"));
  kproj.newKBase(kbase1.getNamespace(),kbase1.getName());
  assertEquals(2,dirtyLog.getRemovedKBases().size());
  assertEquals(1,dirtyLog.getAddedKBases().size());
  assertTrue(dirtyLog.getRemovedKBases().contains("org.test1.KBase1"));
  assertTrue(dirtyLog.getRemovedKBases().contains("org.test1.KBase2"));
  assertTrue(dirtyLog.getAddedKBases().contains("org.test2.KBase1"));
}
