{
  StringBuilder sb=new StringBuilder();
  TemplateRegistry registry=new SimpleTemplateRegistry();
  buildRegistry(registry);
  StatefulKnowledgeSession visitorSession=visitor.newStatefulKnowledgeSession();
  PMML4Wrapper wrapper=new PMML4Wrapper();
  wrapper.setPack("org.drools.pmml_4_0.test");
  visitorSession.setGlobal("theory",sb);
  visitorSession.setGlobal("registry",registry);
  visitorSession.setGlobal("fld2var",new HashMap());
  visitorSession.setGlobal("utils",wrapper);
  visitorSession.insert(pmml);
  visitorSession.fireAllRules();
  String ans=sb.toString();
  visitorSession.dispose();
  return ans;
}
