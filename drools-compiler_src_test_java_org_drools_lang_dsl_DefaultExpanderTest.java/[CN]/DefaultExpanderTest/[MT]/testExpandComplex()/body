{
  DSLTokenizedMappingFile file=new DSLTokenizedMappingFile();
  String dsl="[when]There is an TestObject=TestObject()\n" + "[when]-startDate is before {date}=startDate>DateUtils.parseDate(\"{date}\")\n" + "[when]-endDate is after {date}=endDate>DateUtils.parseDate(\"{date}\")";
  file.parseAndLoad(new StringReader(dsl));
  assertEquals(0,file.getErrors().size());
  DefaultExpander ex=new DefaultExpander();
  ex.addDSLMapping(file.getMapping());
  String source="rule \"q\"\n" + "dialect \"mvel\"\n" + "when\n"+ "There is an TestObject\n"+ "-startDate is before 01-Jul-2011\n"+ "-endDate is after 01-Jul-2011\n"+ "then\n"+ "end\n";
  String expected="rule \"q\"\n" + "dialect \"mvel\"\n" + "when\n"+ "TestObject(startDate>DateUtils.parseDate(\"01-Jul-2011\"), endDate>DateUtils.parseDate(\"01-Jul-2011\"))\n"+ "then\n"+ "end\n";
  String drl=ex.expand(source);
  assertFalse(ex.hasErrors());
  assertEquals(expected,drl);
}
