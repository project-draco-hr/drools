{
  InputSource source=new InputSource(new CachingRewindableReader(resource.getReader()));
  source.setSystemId(systemId.trim().startsWith(".") ? systemId : "." + systemId);
  xjcOpts.addGrammar(source);
  try {
    xjcOpts.parseArguments(new String[]{"-npa"});
  }
 catch (  BadCommandLineException e) {
    throw new IllegalArgumentException("Unable to parse arguments",e);
  }
  ErrorReceiver errorReceiver=new JaxbErrorReceiver4Drools();
  Model model=ModelLoader.load(xjcOpts,new JCodeModel(),errorReceiver);
  model.generateCode(xjcOpts,errorReceiver);
  MapVfsCodeWriter codeWriter=new MapVfsCodeWriter();
  model.codeModel.build(xjcOpts.createCodeWriter(codeWriter));
  List<String> classNames=new ArrayList<String>();
  for (  Entry<String,byte[]> entry : codeWriter.getMap().entrySet()) {
    String name=entry.getKey();
    String pkgName=null;
    int dotPos=name.lastIndexOf('.');
    pkgName=name.substring(0,dotPos);
    if (!name.endsWith("package-info.java")) {
      classNames.add(pkgName);
    }
    dotPos=pkgName.lastIndexOf('.');
    if (dotPos != -1) {
      pkgName=pkgName.substring(0,dotPos);
    }
    PackageRegistry pkgReg=pkgBuilder.getPackageRegistry(pkgName);
    if (pkgReg == null) {
      pkgBuilder.addPackage(new PackageDescr(pkgName));
      pkgReg=pkgBuilder.getPackageRegistry(pkgName);
    }
    JavaDialect dialect=(JavaDialect)pkgReg.getDialectCompiletimeRegistry().getDialect("java");
    dialect.addSrc(convertToResource(entry.getKey()),entry.getValue());
  }
  pkgBuilder.compileAll();
  pkgBuilder.updateResults();
  return classNames.toArray(new String[classNames.size()]);
}
