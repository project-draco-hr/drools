{
  if (configuration == null) {
    configuration=new SessionConfiguration();
  }
  if (environment == null) {
    throw new IllegalArgumentException("Environment cannot be null");
  }
  CommandService commandService=(CommandService)buildCommandService(id,kbase,mergeConfig(configuration),environment);
  commandService.getContext().set(EntryPointCreator.class.getName(),new CommandBasedEntryPointCreator(commandService));
  return new CommandBasedStatefulKnowledgeSession(commandService);
}
