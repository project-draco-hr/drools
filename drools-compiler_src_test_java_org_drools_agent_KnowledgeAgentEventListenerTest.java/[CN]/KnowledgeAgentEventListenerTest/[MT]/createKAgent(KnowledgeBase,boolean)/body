{
  KnowledgeAgent kagent=super.createKAgent(kbase,newInstance);
  kagent.addEventListener(new KnowledgeAgentEventListener(){
    public void beforeChangeSetApplied(    BeforeChangeSetAppliedEvent event){
      beforeChangeSetApplied++;
    }
    public void afterChangeSetApplied(    AfterChangeSetAppliedEvent event){
      afterChangeSetApplied++;
synchronized (lock) {
        changeSetApplied=true;
        lock.notifyAll();
      }
    }
    public void beforeChangeSetProcessed(    BeforeChangeSetProcessedEvent event){
      beforeChangeSetProcessed++;
    }
    public void afterChangeSetProcessed(    AfterChangeSetProcessedEvent event){
      afterChangeSetProcessed++;
    }
    public void beforeResourceProcessed(    BeforeResourceProcessedEvent event){
      beforeResourceProcessed++;
    }
    public void afterResourceProcessed(    AfterResourceProcessedEvent event){
      afterResourceProcessed++;
    }
    public void knowledgeBaseUpdated(    KnowledgeBaseUpdatedEvent event){
      kbaseUpdated=true;
    }
    public void resourceCompilationFailed(    ResourceCompilationFailedEvent event){
      compilationErrors=true;
      System.out.println(event.getKnowledgeBuilder().getErrors().toString());
    }
  }
);
  assertEquals("test agent",kagent.getName());
  return kagent;
}
