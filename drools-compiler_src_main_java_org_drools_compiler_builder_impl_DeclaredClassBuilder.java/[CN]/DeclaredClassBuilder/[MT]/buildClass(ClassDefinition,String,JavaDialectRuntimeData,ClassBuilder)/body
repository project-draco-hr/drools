{
  byte[] bytecode=cb.buildClass(def,kbuilder.getRootClassLoader());
  String resourceName=convertClassToResourcePath(fullName);
  dialect.putClassDefinition(resourceName,bytecode);
  if (kbuilder.getKnowledgeBase() != null) {
    kbuilder.getKnowledgeBase().registerAndLoadTypeDefinition(fullName,bytecode);
  }
 else {
    if (kbuilder.getRootClassLoader() instanceof ProjectClassLoader) {
      ((ProjectClassLoader)kbuilder.getRootClassLoader()).defineClass(fullName,resourceName,bytecode);
    }
 else {
      dialect.write(resourceName,bytecode);
    }
  }
}
