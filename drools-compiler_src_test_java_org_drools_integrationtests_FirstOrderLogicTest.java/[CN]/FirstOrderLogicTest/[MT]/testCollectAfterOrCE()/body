{
  final Cheesery bonFromage=new Cheesery();
  bonFromage.addCheese(new Cheese("cheddar"));
  bonFromage.addCheese(new Cheese("cheddar"));
  KnowledgeBuilder kbuilder=KnowledgeBuilderFactory.newKnowledgeBuilder();
  kbuilder.add(ResourceFactory.newClassPathResource("test_OrCEFollowedByCollect.drl",getClass()),ResourceType.DRL);
  KnowledgeBuilderErrors errors=kbuilder.getErrors();
  if (errors.size() > 0) {
    for (    KnowledgeBuilderError error : errors) {
      System.err.println(error);
    }
    throw new IllegalArgumentException("Could not parse knowledge.");
  }
  assertFalse(kbuilder.hasErrors());
  Collection<KnowledgePackage> knowledgePackages=kbuilder.getKnowledgePackages();
  KnowledgeBase kbase=KnowledgeBaseFactory.newKnowledgeBase();
  kbase.addKnowledgePackages(knowledgePackages);
  StatefulKnowledgeSession session=kbase.newStatefulKnowledgeSession();
  session.insert(bonFromage);
  int rules=session.fireAllRules();
  assertEquals(2,rules);
  knowledgePackages=SerializationHelper.serializeObject(knowledgePackages);
  kbase=KnowledgeBaseFactory.newKnowledgeBase();
  kbase.addKnowledgePackages(knowledgePackages);
  session=kbase.newStatefulKnowledgeSession();
  session.insert(bonFromage);
  rules=session.fireAllRules();
  assertEquals(2,rules);
}
