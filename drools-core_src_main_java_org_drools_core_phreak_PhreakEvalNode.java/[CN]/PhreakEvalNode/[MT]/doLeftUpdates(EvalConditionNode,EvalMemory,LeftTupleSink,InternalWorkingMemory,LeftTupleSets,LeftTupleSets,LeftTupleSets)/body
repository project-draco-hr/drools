{
  EvalCondition condition=evalNode.getCondition();
  for (LeftTuple leftTuple=srcLeftTuples.getUpdateFirst(); leftTuple != null; ) {
    LeftTuple next=leftTuple.getStagedNext();
    boolean wasPropagated=leftTuple.getFirstChild() != null && leftTuple.getObject() != EVAL_LEFT_TUPLE_DELETED;
    boolean allowed=condition.isAllowed(leftTuple,wm,em.context);
    if (allowed) {
      leftTuple.setObject(null);
      if (wasPropagated) {
        LeftTuple childLeftTuple=leftTuple.getFirstChild();
        childLeftTuple.setPropagationContext(leftTuple.getPropagationContext());
switch (childLeftTuple.getStagedType()) {
case LeftTuple.INSERT:
          stagedLeftTuples.removeInsert(childLeftTuple);
        break;
case LeftTuple.UPDATE:
      stagedLeftTuples.removeUpdate(childLeftTuple);
    break;
}
trgLeftTuples.addUpdate(childLeftTuple);
}
 else {
trgLeftTuples.addInsert(sink.createLeftTuple(leftTuple,sink,leftTuple.getPropagationContext(),true));
}
}
 else {
if (wasPropagated) {
leftTuple.setObject(EVAL_LEFT_TUPLE_DELETED);
LeftTuple childLeftTuple=leftTuple.getFirstChild();
childLeftTuple.setPropagationContext(leftTuple.getPropagationContext());
switch (childLeftTuple.getStagedType()) {
case LeftTuple.INSERT:
  stagedLeftTuples.removeInsert(childLeftTuple);
break;
case LeftTuple.UPDATE:
stagedLeftTuples.removeUpdate(childLeftTuple);
break;
}
trgLeftTuples.addDelete(childLeftTuple);
}
}
leftTuple.clearStaged();
leftTuple=next;
}
}
