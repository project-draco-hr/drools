{
  String rule1="package org.test;\n";
  rule1+="import org.kie.Cheese\n";
  rule1+="global java.util.List list\n";
  rule1+="rule \"Rule 1\"\n";
  rule1+="    agenda-group \"agenda-group-1\"\n";
  rule1+="when\n";
  rule1+="    $c : Cheese( ) \n";
  rule1+="then\n";
  rule1+="    list.add( \"rule1\" );\n";
  rule1+="    drools.halt();\n";
  rule1+="end";
  String rule2="package org.test;\n";
  rule2+="import org.kie.Cheese\n";
  rule2+="global java.util.List list\n";
  rule2+="rule \"Rule 2\"\n";
  rule2+="    salience 10\n";
  rule2+="    agenda-group \"agenda-group-1\"\n";
  rule2+="when\n";
  rule2+="    $c : Cheese( ) \n";
  rule2+="then\n";
  rule2+="    list.add( \"rule2\" );\n";
  rule2+="    drools.halt();\n";
  rule2+="end";
  String rule3="package org.test;\n";
  rule3+="import org.kie.Cheese\n";
  rule3+="global java.util.List list\n";
  rule3+="rule \"Rule 3\"\n";
  rule3+="    salience 10\n";
  rule3+="    agenda-group \"agenda-group-2\"\n";
  rule3+="    activation-group \"activation-group-2\"\n";
  rule3+="when\n";
  rule3+="    $c : Cheese( ) \n";
  rule3+="then\n";
  rule3+="    list.add( \"rule3\" );\n";
  rule3+="    drools.halt();\n";
  rule3+="end";
  String rule4="package org.test;\n";
  rule4+="import org.kie.Cheese\n";
  rule4+="global java.util.List list\n";
  rule4+="rule \"Rule 4\"\n";
  rule4+="    agenda-group \"agenda-group-2\"\n";
  rule4+="    activation-group \"activation-group-2\"\n";
  rule4+="when\n";
  rule4+="    $c : Cheese( ) \n";
  rule4+="then\n";
  rule4+="    list.add( \"rule4\" );\n";
  rule4+="    drools.halt();\n";
  rule4+="end";
  final PackageBuilder builder=new PackageBuilder();
  builder.addPackageFromDrl(new StringReader(rule1));
  builder.addPackageFromDrl(new StringReader(rule2));
  builder.addPackageFromDrl(new StringReader(rule3));
  builder.addPackageFromDrl(new StringReader(rule4));
  final Package pkg=builder.getPackage();
  RuleBase ruleBase=RuleBaseFactory.newRuleBase();
  ruleBase.addPackage(pkg);
  ruleBase=SerializationHelper.serializeObject(ruleBase);
  StatefulSession session=ruleBase.newStatefulSession();
  session=getSerialisedStatefulSession(session);
  final List list=new ArrayList();
  session.setGlobal("list",list);
  final Cheese brie=new Cheese("brie",12);
  session.insert(brie);
  session=getSerialisedStatefulSession(session);
  session.setFocus("agenda-group-1");
  session=getSerialisedStatefulSession(session);
  session.fireAllRules();
  assertEquals("rule2",list.get(0));
  session=getSerialisedStatefulSession(session);
  session.setFocus("agenda-group-2");
  session=getSerialisedStatefulSession(session);
  session.fireAllRules();
  assertEquals("rule3",list.get(1));
  session=getSerialisedStatefulSession(session);
  session.fireAllRules();
  assertEquals("rule1",list.get(2));
}
