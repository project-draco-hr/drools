{
  MapBackedClassLoader loader=new MapBackedClassLoader(this.getClass().getClassLoader());
  JarInputStream jis=new JarInputStream(this.getClass().getResourceAsStream("/billasurf.jar"));
  JarEntry entry=null;
  byte[] buf=new byte[1024];
  int len=0;
  while ((entry=jis.getNextJarEntry()) != null) {
    if (!entry.isDirectory()) {
      ByteArrayOutputStream out=new ByteArrayOutputStream();
      while ((len=jis.read(buf)) >= 0) {
        out.write(buf,0,len);
      }
      loader.addResource(entry.getName(),out.toByteArray());
    }
  }
  String drl="package foo.bar \n" + "import com.billasurf.Board\n" + "rule 'MyGoodRule' \n dialect 'mvel' \n when Board() then System.err.println(42); \n end\n";
  PackageBuilder builder=new PackageBuilder(new PackageBuilderConfiguration(loader));
  builder.addPackageFromDrl(new StringReader(drl));
  assertFalse(builder.hasErrors());
  Package p=builder.getPackage();
  byte[] ser=SerializationHelper.serializeOut(p);
  DroolsObjectInputStream in=new DroolsObjectInputStream(new ByteArrayInputStream(ser),loader);
  Package p_=(Package)in.readObject();
  assertNotNull(p_);
}
