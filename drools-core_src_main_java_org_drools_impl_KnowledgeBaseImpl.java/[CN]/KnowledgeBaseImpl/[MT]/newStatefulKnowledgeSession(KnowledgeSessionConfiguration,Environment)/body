{
  if (conf == null) {
    conf=new SessionConfiguration();
  }
  if (environment == null) {
    environment=EnvironmentFactory.newEnvironment();
  }
  CommandService commandService=((SessionConfiguration)conf).getCommandService(this.ruleBase,environment);
  if (commandService != null) {
    return new CommandBasedStatefulKnowledgeSession(commandService);
  }
 else {
    ReteooStatefulSession session=(ReteooStatefulSession)this.ruleBase.newStatefulSession((SessionConfiguration)conf,environment);
    return new StatefulKnowledgeSessionImpl(session,this);
  }
}
