{
  if (this.registeredResources.onlyHasPKGResources()) {
    return null;
  }
  KnowledgeBuilder kbuilder=null;
  if (this.builderConfiguration != null) {
    kbuilder=KnowledgeBuilderFactory.newKnowledgeBuilder(this.builderConfiguration);
  }
 else   if (this.isUseKBaseClassLoaderForCompiling()) {
    kbuilder=KnowledgeBuilderFactory.newKnowledgeBuilder(KnowledgeBuilderFactory.newKnowledgeBuilderConfiguration(null,((ReteooRuleBase)((KnowledgeBaseImpl)this.getKnowledgeBase()).getRuleBase()).getRootClassLoader()));
  }
 else {
    kbuilder=KnowledgeBuilderFactory.newKnowledgeBuilder();
  }
  if (this.dslResources != null) {
    for (    Map.Entry<Resource,String> entry : this.dslResources.entrySet()) {
      kbuilder.add(ResourceFactory.newByteArrayResource(entry.getValue().getBytes()),ResourceType.DSL);
    }
  }
  return kbuilder;
}
