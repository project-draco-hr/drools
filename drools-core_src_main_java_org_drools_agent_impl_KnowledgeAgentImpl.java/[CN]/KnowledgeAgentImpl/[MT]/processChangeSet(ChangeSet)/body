{
synchronized (this.resources) {
    for (    Resource resource : changeSet.getResourcesRemoved()) {
      this.resources.remove(resource);
    }
    for (    Resource resource : changeSet.getResourcesAdded()) {
      this.resources.put(resource,null);
    }
    Resource[] resourcesClone=this.resources.keySet().toArray(new Resource[this.resources.size()]);
    this.resources.clear();
    KnowledgeBuilder kbuilder=KnowledgeBuilderFactory.newKnowledgeBuilder();
    for (    Resource resource : resourcesClone) {
      System.out.println("building : " + resource);
      kbuilder.add(resource,((InternalResource)resource).getResourceType());
    }
    this.kbase=KnowledgeBaseFactory.newKnowledgeBase();
    this.kbase.addKnowledgePackages(kbuilder.getKnowledgePackages());
  }
}
