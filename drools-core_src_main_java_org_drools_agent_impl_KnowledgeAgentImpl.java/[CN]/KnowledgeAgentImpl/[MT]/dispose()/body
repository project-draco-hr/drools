{
synchronized (this.registeredResources) {
    if (this.kbase != null) {
      StatefulSession[] statefulSessions=((AbstractRuleBase)(((KnowledgeBaseImpl)this.kbase).ruleBase)).getStatefulSessions();
      if (statefulSessions != null && statefulSessions.length > 0) {
        String message="The kbase still contains " + statefulSessions.length + " stateful sessions. You must dispose them first.";
        this.listener.warning(message);
        throw new IllegalStateException(message);
      }
    }
    this.monitorResourceChangeEvents(false);
  }
}
