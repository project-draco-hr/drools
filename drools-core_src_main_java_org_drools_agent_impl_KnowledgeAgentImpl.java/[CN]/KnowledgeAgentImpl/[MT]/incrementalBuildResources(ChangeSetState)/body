{
  if (this.newInstance) {
    this.listener.warning("KnowledgeAgent incremental build of KnowledgeBase when newInstance is true");
  }
synchronized (this.resourcesMap) {
    this.listener.info("KnowledgeAgent performing an incremental build of the ChangeSet");
    if (this.kbase == null) {
      this.kbase=KnowledgeBaseFactory.newKnowledgeBase();
    }
    for (    ResourceMapEntry resourceMapEntry : changeSetState.removedResourceMappings) {
      for (      KnowledgeDefinition kd : resourceMapEntry.getKnowledgeDefinitions()) {
        removeKnowledgeDefinitionFromBase(kd);
      }
    }
    for (    ResourceMapEntry resourceMapEntry : changeSetState.modifiedResourceMappings) {
      for (      KnowledgeDefinition kd : resourceMapEntry.getKnowledgeDefinitions()) {
        removeKnowledgeDefinitionFromBase(kd);
      }
      changeSetState.addedResources.add(resourceMapEntry.getResource());
    }
    addResourcesToKnowledgeBase(changeSetState.addedResources);
  }
  this.listener.info("KnowledgeAgent incremental build of KnowledgeBase finished and in use");
}
