{
  if (resource == null) {
    listener.warning("KnowledgeAgent: impossible to add a map for a null resource! skiping.");
    return false;
  }
  this.listener.debug("KnowledgeAgent mapping resource=" + resource + " to KnowledgeDefinition="+ definition);
  boolean isNewResource=!this.registeredResources.isResourceMapped(resource);
  if (resource instanceof ClassPathResource && ((ClassPathResource)resource).getClassLoader() == null) {
    ((ClassPathResource)resource).setClassLoader(((InternalRuleBase)((InternalKnowledgeBase)kbase).getRuleBase()).getRootClassLoader());
  }
  boolean isNewDefinition=true;
  if (definition != null) {
    isNewDefinition=this.registeredResources.putDefinition(resource,definition);
  }
  if (notify && isNewResource) {
    this.listener.debug("KnowledgeAgent notifier subscribing to resource=" + resource);
    this.notifier.subscribeResourceChangeListener(this,resource);
  }
  return isNewDefinition;
}
