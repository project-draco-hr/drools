{
  StatefulKnowledgeSessionPipelineContext kContext=(StatefulKnowledgeSessionPipelineContext)context;
  StatefulKnowledgeSession ksession=kContext.getStatefulKnowledgeSession();
  if (key == null) {
    if (!(object instanceof Map)) {
      throw new IllegalArgumentException("SetGlobalStage must either declare a key or be an instanceof a Map");
    }
 else {
      Map<String,Object> vars=(Map<String,Object>)object;
      for (      Entry<String,Object> entry : vars.entrySet()) {
        ksession.setGlobal(entry.getKey(),entry.getValue());
      }
    }
  }
 else {
    ksession.setGlobal(this.key,object);
  }
  emit(object,kContext);
}
