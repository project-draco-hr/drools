{
  if (leftTuple.getStagedType() != LeftTuple.INSERT) {
    leftTuple.setPropagationContext(context);
    if (leftTuple.getFirstChild() != null) {
      leftTuple.getFirstChild().setPropagationContext(context);
    }
  }
synchronized (((SynchronizedLeftTupleSets)leftTuples).getLock()) {
    if (leftTuple.getStagedType() == LeftTuple.NONE) {
      long mask=sink.getLeftInferredMask();
      if (mask == Long.MAX_VALUE || intersect(context.getModificationMask(),mask)) {
        boolean stagedUpdateWasEmpty=false;
        if (((BaseNode)sm.getRootNode()).isStreamMode() && sm.getTupleQueue() != null) {
          stagedUpdateWasEmpty=sm.getTupleQueue().isEmpty();
          sm.getTupleQueue().add(new LeftTupleEntry(leftTuple,context,sm.getNodeMemories().getFirst()));
        }
 else {
          stagedUpdateWasEmpty=leftTuples.addUpdate(leftTuple);
        }
        if (stagedUpdateWasEmpty && linkOrNotify) {
          lm.setNodeDirty(wm);
        }
      }
    }
  }
}
