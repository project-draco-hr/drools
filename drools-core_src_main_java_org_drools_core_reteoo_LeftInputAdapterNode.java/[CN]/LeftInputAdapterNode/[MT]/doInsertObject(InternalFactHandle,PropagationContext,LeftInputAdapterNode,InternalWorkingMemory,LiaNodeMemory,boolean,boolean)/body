{
  SegmentMemory sm=lm.getSegmentMemory();
  if (sm.getTipNode() == liaNode) {
    if (sm.isEmpty()) {
      SegmentUtilities.createChildSegments(wm,sm,liaNode.getSinkPropagator());
    }
    sm=sm.getFirst();
  }
  boolean notifySegment=linkOrNotify;
  int counter=lm.getAndIncreaseCounter();
  if (counter == 0) {
    notifySegment=false;
  }
  LeftTupleSink sink=liaNode.getSinkPropagator().getFirstLeftTupleSink();
  LeftTuple leftTuple=sink.createLeftTuple(factHandle,sink,useLeftMemory);
  leftTuple.setPropagationContext(context);
  long mask=sink.getLeftInferredMask();
  doInsertSegmentMemory(context,wm,notifySegment,sm,leftTuple,liaNode,mask);
  if (sm.getRootNode() != liaNode) {
    for (sm=sm.getNext(); sm != null; sm=sm.getNext()) {
      sink=sm.getSinkFactory();
      leftTuple=sink.createPeer(leftTuple);
      mask=((LeftTupleSink)sm.getRootNode()).getLeftInferredMask();
      doInsertSegmentMemory(context,wm,notifySegment,sm,leftTuple,liaNode,mask);
    }
  }
  if (counter == 0) {
    if (linkOrNotify) {
      lm.linkNode(wm);
    }
 else {
      lm.linkNodeWithoutRuleNotify();
    }
  }
  if (context.getReaderContext() != null) {
    MarshallerReaderContext mrc=(MarshallerReaderContext)context.getReaderContext();
    mrc.filter.fireRNEAs(wm);
  }
}
