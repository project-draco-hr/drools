{
  Class coreKlass=core.getClass();
  ClassDefinition tdef=ruleBase.getTraitRegistry().getTrait(trait.getName());
  ClassDefinition cdef=ruleBase.getTraitRegistry().getTraitable(coreKlass.getName());
  if (tdef == null) {
    throw new RuntimeDroolsException("Unable to find Trait definition for class " + trait.getName() + ". It should have been DECLARED as a trait");
  }
  if (cdef == null) {
    throw new RuntimeDroolsException("Unable to find Core class definition for class " + coreKlass.getName() + ". It should have been DECLARED as a trait");
  }
  String proxyName=getProxyName(tdef,cdef);
  String wrapperName=getPropertyWrapperName(tdef,cdef);
  KieComponentFactory rcf=ruleBase.getConfiguration().getComponentFactory();
  TraitPropertyWrapperClassBuilder propWrapperBuilder=(TraitPropertyWrapperClassBuilder)rcf.getClassBuilderFactory().getPropertyWrapperBuilder();
  propWrapperBuilder.init(tdef,ruleBase.getTraitRegistry());
  try {
    byte[] propWrapper=propWrapperBuilder.buildClass(cdef);
    ruleBase.registerAndLoadTypeDefinition(wrapperName,propWrapper);
  }
 catch (  Exception e) {
    e.printStackTrace();
  }
  TraitProxyClassBuilder proxyBuilder=(TraitProxyClassBuilder)rcf.getClassBuilderFactory().getTraitProxyBuilder();
  proxyBuilder.init(tdef,rcf.getBaseTraitProxyClass(),ruleBase.getTraitRegistry());
  try {
    byte[] proxy=proxyBuilder.buildClass(cdef);
    ruleBase.registerAndLoadTypeDefinition(proxyName,proxy);
  }
 catch (  Exception e) {
    e.printStackTrace();
  }
  try {
    BitSet mask=ruleBase.getTraitRegistry().getFieldMask(trait.getName(),cdef.getDefinedClass().getName());
    Class<T> proxyClass=(Class<T>)ruleBase.getRootClassLoader().loadClass(proxyName);
    bindAccessors(proxyClass,tdef,cdef,mask);
    Class<T> wrapperClass=(Class<T>)ruleBase.getRootClassLoader().loadClass(wrapperName);
    bindCoreAccessors(wrapperClass,cdef);
    return proxyClass;
  }
 catch (  ClassNotFoundException e) {
    e.printStackTrace();
    return null;
  }
}
