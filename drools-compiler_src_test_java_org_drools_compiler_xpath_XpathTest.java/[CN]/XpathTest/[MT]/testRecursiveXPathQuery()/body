{
  String drl="import org.drools.compiler.xpath.Thing;\n" + "global java.util.List list\n" + "\n"+ "rule \"Print all things contained in the Office\" when\n"+ "    $office : Thing( name == \"office\" )\n"+ "    isContainedIn( $office, thing; )\n"+ "then\n"+ "    list.add( thing.getName() );\n"+ "end\n"+ "\n"+ "query isContainedIn( Thing $x, Thing $y )\n"+ "    $y := /$x/children\n"+ "or\n"+ "    ( $z := /$x/children and isContainedIn( $z, $y; ) )\n"+ "end\n";
  Thing house=new Thing("house");
  Thing office=new Thing("office");
  house.addChild(office);
  Thing kitchen=new Thing("kitchen");
  house.addChild(kitchen);
  Thing knife=new Thing("knife");
  kitchen.addChild(knife);
  Thing cheese=new Thing("cheese");
  kitchen.addChild(cheese);
  Thing desk=new Thing("desk");
  office.addChild(desk);
  Thing chair=new Thing("chair");
  office.addChild(chair);
  Thing computer=new Thing("computer");
  desk.addChild(computer);
  Thing draw=new Thing("draw");
  desk.addChild(draw);
  Thing key=new Thing("key");
  draw.addChild(key);
  KieSession ksession=new KieHelper().addContent(drl,ResourceType.DRL).build().newKieSession();
  List<String> list=new ArrayList<String>();
  ksession.setGlobal("list",list);
  ksession.insert(house);
  ksession.insert(office);
  ksession.insert(kitchen);
  ksession.insert(knife);
  ksession.insert(cheese);
  ksession.insert(desk);
  ksession.insert(chair);
  ksession.insert(computer);
  ksession.insert(draw);
  ksession.insert(key);
  ksession.fireAllRules();
  System.out.println(list);
  assertEquals(5,list.size());
  assertTrue(list.containsAll(asList("desk","chair","key","draw","computer")));
}
