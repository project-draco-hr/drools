{
  String drl="import org.drools.compiler.xpath.*;\n" + "global java.util.List toyList\n" + "global java.util.List teenagers\n"+ "\n"+ "rule R1 when\n"+ "  $i : Integer()\n"+ "  Man( $toy: /wife/children[age >= $i]/toys )\n"+ "then\n"+ "  toyList.add( $toy.getName() );\n"+ "end\n"+ "rule R2 when\n"+ "  School( $child: /children[age >= 13] )\n"+ "then\n"+ "  teenagers.add( $child.getName() );\n"+ "end\n";
  KieSession ksession=new KieHelper().addContent(drl,ResourceType.DRL).build().newKieSession();
  List<String> toyList=new ArrayList<String>();
  ksession.setGlobal("toyList",toyList);
  List<String> teenagers=new ArrayList<String>();
  ksession.setGlobal("teenagers",teenagers);
  Woman alice=new Woman("Alice",38);
  Man bob=new Man("Bob",40);
  bob.setWife(alice);
  Child charlie=new Child("Charles",15);
  Child debbie=new Child("Debbie",12);
  alice.addChild(charlie);
  alice.addChild(debbie);
  charlie.addToy(new Toy("car"));
  charlie.addToy(new Toy("ball"));
  debbie.addToy(new Toy("doll"));
  School school=new School("Da Vinci");
  school.addChild(charlie);
  school.addChild(debbie);
  ksession.insert(13);
  ksession.insert(bob);
  ksession.insert(school);
  ksession.fireAllRules();
  assertEquals(2,toyList.size());
  assertTrue(toyList.contains("car"));
  assertTrue(toyList.contains("ball"));
  assertEquals(1,teenagers.size());
  assertTrue(teenagers.contains("Charles"));
  toyList.clear();
  teenagers.clear();
  debbie.setAge(13);
  ksession.fireAllRules();
  assertEquals(3,toyList.size());
  assertTrue(toyList.contains("car"));
  assertTrue(toyList.contains("ball"));
  assertTrue(toyList.contains("doll"));
  assertEquals(2,teenagers.size());
  assertTrue(teenagers.contains("Charles"));
  assertTrue(teenagers.contains("Debbie"));
}
