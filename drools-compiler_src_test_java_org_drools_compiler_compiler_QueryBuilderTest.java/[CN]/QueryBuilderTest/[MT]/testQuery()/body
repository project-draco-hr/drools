{
  final KnowledgeBuilderImpl builder=new KnowledgeBuilderImpl();
  final PackageDescr packageDescr=new PackageDescr("p1");
  final QueryDescr queryDescr=new QueryDescr("query1");
  queryDescr.addParameter("String","$type");
  packageDescr.addRule(queryDescr);
  final AndDescr lhs=new AndDescr();
  queryDescr.setLhs(lhs);
  final PatternDescr pattern=new PatternDescr(Cheese.class.getName(),"stilton");
  lhs.addDescr(pattern);
  pattern.addConstraint(new ExprConstraintDescr("type == $type"));
  QueryDescr queryDescr2=new QueryDescr("query2");
  packageDescr.addRule(queryDescr2);
  AndDescr lhs2=new AndDescr();
  queryDescr2.setLhs(lhs2);
  PatternDescr pattern2=new PatternDescr(Cheese.class.getName());
  lhs2.addDescr(pattern2);
  builder.addPackage(packageDescr);
  assertLength(0,builder.getErrors().getErrors());
  KnowledgeBase kbase=KnowledgeBaseFactory.newKnowledgeBase();
  kbase.addKnowledgePackages(Arrays.asList(new KnowledgePackage[]{builder.getPackage()}));
  final KieSession session=kbase.newStatefulKnowledgeSession();
  session.insert(new Cheese("stilton",15));
  QueryResults results=session.getQueryResults("query1","stilton");
  assertEquals(1,results.size());
  Object object=results.iterator().next().get("stilton");
  assertEquals(new Cheese("stilton",15),object);
  results=session.getQueryResults("query1",new Object[]{"cheddar"});
  assertEquals(0,results.size());
  session.insert(new Cheese("dolcelatte",20));
  results=session.getQueryResults("query2",new Object[]{});
  assertEquals(2,results.size());
}
