{
  ReteooWorkingMemory wm=(ReteooWorkingMemory)context.wm;
  wm.getAgenda().unstageActivations();
  context.writeBoolean(false);
  long time=0;
  if (context.wm.getTimerService() instanceof PseudoClockScheduler) {
    time=context.clockTime;
  }
  context.writeLong(time);
  context.writeInt(wm.getFactHandleFactory().getId());
  context.writeLong(wm.getFactHandleFactory().getRecency());
  context.writeLong(wm.getPropagationIdCounter());
  InternalFactHandle handle=context.wm.getInitialFactHandle();
  context.writeInt(handle.getId());
  context.writeLong(handle.getRecency());
  writeAgenda(context);
  writeInitialFactHandleRightTuples(context);
  for (  SessionEntryPoint wmep : wm.getEntryPoints().values()) {
    context.stream.writeShort(PersisterEnums.ENTRY_POINT);
    context.stream.writeUTF(wmep.getEntryPointId());
    writeFactHandles(context,((NamedEntryPoint)wmep).getObjectStore());
  }
  context.stream.writeShort(PersisterEnums.END);
  writeInitialFactHandleLeftTuples(context);
  writePropagationContexts(context);
  writeActivations(context);
  writeActionQueue(context);
  writeTruthMaintenanceSystem(context);
  if (context.marshalProcessInstances && processMarshaller != null) {
    processMarshaller.writeProcessInstances(context);
  }
 else {
    context.stream.writeShort(PersisterEnums.END);
  }
  if (context.marshalWorkItems && processMarshaller != null) {
    processMarshaller.writeWorkItems(context);
  }
 else {
    context.stream.writeShort(PersisterEnums.END);
  }
  if (processMarshaller != null) {
    processMarshaller.writeProcessTimers(context);
  }
 else {
    context.stream.writeShort(PersisterEnums.END);
  }
  writeTimers(context.wm.getTimerService().getTimerJobInstances(context.wm.getId()),context);
}
