{
  Object[] argTemplate=this.queryElement.getArgTemplate();
  Object[] args=new Object[argTemplate.length];
  System.arraycopy(argTemplate,0,args,0,args.length);
  int[] declIndexes=this.queryElement.getDeclIndexes();
  for (int i=0, length=declIndexes.length; i < length; i++) {
    Declaration declr=(Declaration)argTemplate[declIndexes[i]];
    Object tupleObject=leftTuple.get(declr).getObject();
    Object o;
    if (tupleObject instanceof DroolsQuery) {
      ArrayElementReader arrayReader=(ArrayElementReader)declr.getExtractor();
      if (((DroolsQuery)tupleObject).getVariables()[arrayReader.getIndex()] != null) {
        o=Variable.v;
      }
 else {
        o=declr.getValue(workingMemory,tupleObject);
      }
    }
 else {
      o=declr.getValue(workingMemory,tupleObject);
    }
    args[declIndexes[i]]=o;
  }
  int[] varIndexes=this.queryElement.getVariableIndexes();
  for (int i=0, length=varIndexes.length; i < length; i++) {
    if (argTemplate[varIndexes[i]] == Variable.v) {
      args[varIndexes[i]]=Variable.v;
    }
  }
  UnificationNodeViewChangedEventListener collector=new UnificationNodeViewChangedEventListener(leftTuple,varIndexes,this,this.tupleMemoryEnabled);
  DroolsQuery queryObject=new DroolsQuery(this.queryElement.getQueryName(),args,collector,openQuery);
  collector.setFactHandle(handle);
  handle.setObject(queryObject);
  leftTuple.setObject(handle);
  return queryObject;
}
