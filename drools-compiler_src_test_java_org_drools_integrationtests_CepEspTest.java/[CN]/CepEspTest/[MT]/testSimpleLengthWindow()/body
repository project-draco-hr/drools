{
  KnowledgeBaseConfiguration conf=KnowledgeBaseFactory.newKnowledgeBaseConfiguration();
  conf.setOption(EventProcessingOption.STREAM);
  final KnowledgeBase kbase=loadKnowledgeBase(conf,"test_CEP_SimpleLengthWindow.drl");
  KnowledgeSessionConfiguration sconf=KnowledgeBaseFactory.newKnowledgeSessionConfiguration();
  sconf.setOption(ClockTypeOption.get(ClockType.PSEUDO_CLOCK.getId()));
  StatefulKnowledgeSession wm=createKnowledgeSession(kbase,sconf);
  final List results=new ArrayList();
  wm.setGlobal("results",results);
  EventFactHandle handle1=(EventFactHandle)wm.insert(new OrderEvent("1","customer A",70));
  wm.fireAllRules();
  assertEquals(1,results.size());
  assertEquals(70,((Number)results.get(0)).intValue());
  EventFactHandle handle2=(EventFactHandle)wm.insert(new OrderEvent("2","customer A",60));
  wm.fireAllRules();
  assertEquals(2,results.size());
  assertEquals(65,((Number)results.get(1)).intValue());
  EventFactHandle handle3=(EventFactHandle)wm.insert(new OrderEvent("3","customer A",50));
  wm.fireAllRules();
  assertEquals(3,results.size());
  assertEquals(60,((Number)results.get(2)).intValue());
  EventFactHandle handle4=(EventFactHandle)wm.insert(new OrderEvent("4","customer A",25));
  wm.fireAllRules();
  assertEquals(3,results.size());
  EventFactHandle handle5=(EventFactHandle)wm.insert(new OrderEvent("5","customer A",70));
  wm.fireAllRules();
  assertEquals(3,results.size());
  EventFactHandle handle6=(EventFactHandle)wm.insert(new OrderEvent("6","customer A",115));
  wm.fireAllRules();
  assertEquals(4,results.size());
  assertEquals(70,((Number)results.get(3)).intValue());
}
