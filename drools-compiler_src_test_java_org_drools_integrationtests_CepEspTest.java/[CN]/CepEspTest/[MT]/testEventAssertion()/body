{
  final Reader reader=new InputStreamReader(getClass().getResourceAsStream("test_CEP_SimpleEventAssertion.drl"));
  RuleBase ruleBase=loadRuleBase(reader);
  StatefulSession session=ruleBase.newTemporalSession(ClockType.PSEUDO_CLOCK);
  final List results=new ArrayList();
  session.setGlobal("results",results);
  StockTick tick1=new StockTick(1,"DROO",50,System.currentTimeMillis());
  StockTick tick2=new StockTick(2,"ACME",10,System.currentTimeMillis());
  StockTick tick3=new StockTick(3,"ACME",10,System.currentTimeMillis());
  StockTick tick4=new StockTick(4,"DROO",50,System.currentTimeMillis());
  InternalFactHandle handle1=(InternalFactHandle)session.insert(tick1);
  InternalFactHandle handle2=(InternalFactHandle)session.insert(tick2);
  InternalFactHandle handle3=(InternalFactHandle)session.insert(tick3);
  InternalFactHandle handle4=(InternalFactHandle)session.insert(tick4);
  assertNotNull(handle1);
  assertNotNull(handle2);
  assertNotNull(handle3);
  assertNotNull(handle4);
  assertTrue(handle1.isEvent());
  assertTrue(handle2.isEvent());
  assertTrue(handle3.isEvent());
  assertTrue(handle4.isEvent());
  session=SerializationHelper.getSerialisedStatefulSession(session,ruleBase);
  session.fireAllRules();
  assertEquals(2,((List)session.getGlobal("results")).size());
}
