{
  KnowledgeBase kbase=loadKnowledgeBase("test_CEP_SimpleEventAssertionWithDateTimestamp.drl");
  KieSessionConfiguration conf=KnowledgeBaseFactory.newKnowledgeSessionConfiguration();
  conf.setOption(ClockTypeOption.get(ClockType.PSEUDO_CLOCK.getId()));
  StatefulKnowledgeSession session=createKnowledgeSession(kbase,conf);
  final List results=new ArrayList();
  session.setGlobal("results",results);
  StockTickInterface tick1=new StockTick(1,"DROO",50,10000,5);
  StockTickInterface tick2=new StockTick(2,"ACME",10,11000,10);
  StockTickInterface tick3=new StockTick(3,"ACME",10,12000,8);
  StockTickInterface tick4=new StockTick(4,"DROO",50,13000,7);
  InternalFactHandle handle1=(InternalFactHandle)session.insert(tick1);
  InternalFactHandle handle2=(InternalFactHandle)session.insert(tick2);
  InternalFactHandle handle3=(InternalFactHandle)session.insert(tick3);
  InternalFactHandle handle4=(InternalFactHandle)session.insert(tick4);
  assertNotNull(handle1);
  assertNotNull(handle2);
  assertNotNull(handle3);
  assertNotNull(handle4);
  assertTrue(handle1.isEvent());
  assertTrue(handle2.isEvent());
  assertTrue(handle3.isEvent());
  assertTrue(handle4.isEvent());
  EventFactHandle eh1=(EventFactHandle)handle1;
  EventFactHandle eh2=(EventFactHandle)handle2;
  EventFactHandle eh3=(EventFactHandle)handle3;
  EventFactHandle eh4=(EventFactHandle)handle4;
  assertEquals(tick1.getTime(),eh1.getStartTimestamp());
  assertEquals(tick2.getTime(),eh2.getStartTimestamp());
  assertEquals(tick3.getTime(),eh3.getStartTimestamp());
  assertEquals(tick4.getTime(),eh4.getStartTimestamp());
  session.fireAllRules();
  assertEquals(2,results.size());
}
