{
  try {
    Person bob=new Person("bob",30);
    Address addr1=new Address("street 1","111","11-1111-1111");
    Address addr2=new Address("street 2","222","22-2222-2222");
    Address addr3=new Address("street 3","333","33-3333-3333");
    bob.getAddressList().add(addr1);
    bob.getAddressList().add(addr2);
    final Class proxy=ShadowProxyFactory.getProxy(bob.getClass());
    final Person bobProxy=(Person)proxy.getConstructor(new Class[]{bob.getClass()}).newInstance(new Object[]{bob});
    ((ShadowProxy)bobProxy).setShadowedObject(bob);
    Assert.assertEquals(2,bobProxy.getAddressList().size());
    Assert.assertSame(bob,((ShadowProxy)bobProxy).getShadowedObject());
    Assert.assertEquals(bobProxy,bob);
    bob.getAddressList().remove(addr2);
    bob.getAddressList().add(addr3);
    Assert.assertTrue(bobProxy.getAddressList().contains(addr2));
    Assert.assertFalse(bobProxy.getAddressList().contains(addr3));
    ((ShadowProxy)bobProxy).updateProxy();
    Assert.assertFalse(bobProxy.getAddressList().contains(addr2));
    Assert.assertTrue(bobProxy.getAddressList().contains(addr3));
    Assert.assertEquals(bobProxy,bob);
  }
 catch (  final Exception e) {
    e.printStackTrace();
    fail("Error: " + e.getMessage());
  }
}
