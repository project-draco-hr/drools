{
  try {
    Person bob=new Person("bob",30);
    Address addr1=new Address("street 1","111","11-1111-1111");
    Address addr2=new Address("street 2","222","22-2222-2222");
    Address addr3=new Address("street 3","333","33-3333-3333");
    bob.getAddressArray()[0]=addr1;
    bob.getAddressArray()[1]=addr2;
    final Class proxy=ShadowProxyFactory.getProxy(bob.getClass());
    final Person bobProxy=(Person)proxy.getConstructor(new Class[]{bob.getClass()}).newInstance(new Object[]{bob});
    ((ShadowProxy)bobProxy).setShadowedObject(bob);
    Assert.assertEquals(addr1,bobProxy.getAddressArray()[0]);
    Assert.assertEquals(addr2,bobProxy.getAddressArray()[1]);
    Assert.assertSame(bob,((ShadowProxy)bobProxy).getShadowedObject());
    Assert.assertEquals(bobProxy,bob);
    bob.getAddressArray()[1]=addr3;
    Assert.assertEquals(addr1,bobProxy.getAddressArray()[0]);
    Assert.assertEquals(addr2,bobProxy.getAddressArray()[1]);
    ((ShadowProxy)bobProxy).updateProxy();
    Assert.assertEquals(addr1,bobProxy.getAddressArray()[0]);
    Assert.assertEquals(addr3,bobProxy.getAddressArray()[1]);
    Assert.assertEquals(bobProxy,bob);
  }
 catch (  final Exception e) {
    e.printStackTrace();
    fail("Error: " + e.getMessage());
  }
}
