{
  this.networkEvaluator.evaluateNetwork(rmem,wm,this);
  setDirty(false);
  int localFireCount=0;
  if (!tupleList.isEmpty()) {
    RuleTerminalNode rtn=(RuleTerminalNode)rmem.getRuleTerminalNode();
    Rule rule=rtn.getRule();
    InternalAgenda agenda=(InternalAgenda)wm.getAgenda();
    int salience=rule.getSalience().getValue(null,null,null);
    if (isDeclarativeAgendaEnabled()) {
      RuleNetworkEvaluatorActivation nextRule=agenda.peekNextRule();
      if (!isHighestSalience(nextRule,salience)) {
        ((InternalAgenda)wm.getAgenda()).addActivation(this);
        return localFireCount;
      }
    }
    start:     while (!tupleList.isEmpty()) {
      LeftTuple leftTuple=tupleList.removeFirst();
      rtn=(RuleTerminalNode)leftTuple.getSink();
      rule=rtn.getRule();
      PropagationContext pctx=leftTuple.getPropagationContext();
      pctx=RuleTerminalNode.findMostRecentPropagationContext(leftTuple,pctx);
      if (isNotEffective(wm,rtn,rule,leftTuple,pctx)) {
        continue start;
      }
      long handleRecency=((InternalFactHandle)pctx.getFactHandle()).getRecency();
      InternalAgendaGroup agendaGroup=(InternalAgendaGroup)agenda.getAgendaGroup(rule.getAgendaGroup());
      if (blockedByLockOnActive(rule,agenda,pctx,handleRecency,agendaGroup)) {
        continue start;
      }
      AgendaItem item=(AgendaItem)leftTuple.getObject();
      if (item == null) {
        item=agenda.createAgendaItem(leftTuple,salience,pctx,rtn,this);
        item.setActivated(true);
        leftTuple.setObject(item);
      }
 else {
        item.setPropagationContext(pctx);
      }
      agenda.fireActivation(item);
      localFireCount++;
      RuleNetworkEvaluatorActivation nextRule=agenda.peekNextRule();
      if (haltRuleFiring(nextRule,fireCount,fireLimit,localFireCount,agenda,salience)) {
        break;
      }
      if (isDirty()) {
        dequeue();
        setDirty(false);
        this.networkEvaluator.evaluateNetwork(rmem,wm,this);
      }
    }
  }
  return localFireCount;
}
