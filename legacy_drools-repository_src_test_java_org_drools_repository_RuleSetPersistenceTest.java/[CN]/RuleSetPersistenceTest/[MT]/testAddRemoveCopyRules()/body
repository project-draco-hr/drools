{
  RuleSetDef ruleset=new RuleSetDef("another one",null);
  RepositoryManager repo=getRepo();
  RuleDef preExist=new RuleDef("preexist","yeah");
  repo.save(preExist);
  repo.save(ruleset);
  ruleset.addRule(preExist);
  repo.save(ruleset);
  RuleSetDef newruleset=new RuleSetDef("yao",null);
  repo.save(ruleset);
  RuleDef copied=newruleset.addRule(preExist);
  RuleDef other=newruleset.findRuleByName(preExist.getName());
  assertEquals(null,other.getId());
  assertEquals(newruleset.getName(),other.getOwningRuleSetName());
  assertEquals(null,preExist.getOwningRuleSetName());
  repo.save(newruleset);
  assertFalse(other == preExist);
  assertEquals(other,copied);
  newruleset=repo.loadRuleSet("yao",1);
  assertEquals(1,newruleset.getRules().size());
  other=(RuleDef)newruleset.getRules().iterator().next();
  assertEquals(newruleset.getName(),other.getOwningRuleSetName());
  newruleset.removeRule(other);
  repo.save(newruleset);
  newruleset=repo.loadRuleSet("yao",1);
  ruleset=repo.loadRuleSet("another one",1);
  assertEquals(1,ruleset.getRules().size());
  assertEquals(0,newruleset.getRules().size());
}
