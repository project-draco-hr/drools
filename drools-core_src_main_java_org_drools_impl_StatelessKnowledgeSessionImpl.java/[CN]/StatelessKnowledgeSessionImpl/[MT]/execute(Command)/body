{
  ReteooWorkingMemory session=(ReteooWorkingMemory)newWorkingMemory();
  try {
    session.startBatchExecution();
    ((org.drools.process.command.Command)command).execute(session);
    boolean autoFireAllRules=true;
    if (command instanceof FireAllRulesCommand) {
      autoFireAllRules=false;
    }
 else     if (command instanceof BatchExecutionImpl) {
      for (      Command nestedCmd : ((BatchExecutionImpl)command).getCommands()) {
        if (nestedCmd instanceof FireAllRulesCommand) {
          autoFireAllRules=false;
          break;
        }
      }
    }
    if (autoFireAllRules) {
      session.fireAllRules(this.agendaFilter);
    }
    ExecutionResults result=session.getExecutionResult();
    return result;
  }
  finally {
    session.endBatchExecution();
  }
}
