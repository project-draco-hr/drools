{
  DroolsMVELFactory factory=new DroolsMVELFactory();
  Map map=new HashMap();
  for (int i=0, length=previousDeclarations.length; i < length; i++) {
    map.put(previousDeclarations[i].getIdentifier(),previousDeclarations[i]);
  }
  factory.setPreviousDeclarationMap(map);
  map=new HashMap();
  for (int i=0, length=localDeclarations.length; i < length; i++) {
    map.put(localDeclarations[i].getIdentifier(),localDeclarations[i]);
  }
  factory.setLocalDeclarationMap(map);
  factory.setGlobalsMap(context.getPkg().getGlobals());
  Serializable expr=MVEL.compileExpression(returnValueRestrictionDescr.getText());
  returnValueRestriction.setReturnValueExpression(new MVELReturnValueExpression(expr,factory));
}
