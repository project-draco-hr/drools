{
  ReteooWorkingMemory wm=(ReteooWorkingMemory)context.wm;
  wm.getAgenda().unstageActivations();
  final boolean multithread=wm.isPartitionManagersActive();
  if (multithread) {
    context.writeBoolean(true);
    wm.stopPartitionManagers();
  }
 else {
    context.writeBoolean(false);
  }
  context.writeLong(context.clockTime);
  context.writeInt(wm.getFactHandleFactory().getId());
  context.writeLong(wm.getFactHandleFactory().getRecency());
  InternalFactHandle handle=context.wm.getInitialFactHandle();
  context.writeInt(handle.getId());
  context.writeLong(handle.getRecency());
  context.writeLong(wm.getPropagationIdCounter());
  writeAgenda(context);
  writeFactHandles(context);
  writeActionQueue(context);
  writeTruthMaintenanceSystem(context);
  if (context.marshalProcessInstances && processMarshaller != null) {
    processMarshaller.writeProcessInstances(context);
  }
  if (context.marshalWorkItems && processMarshaller != null) {
    processMarshaller.writeWorkItems(context);
  }
  if (processMarshaller != null) {
    processMarshaller.writeProcessTimers(context);
  }
  writeTimers(context.wm.getTimerService().getTimerJobInstances(),context);
  if (multithread) {
    wm.startPartitionManagers();
  }
}
