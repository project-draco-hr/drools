{
  ReteooWorkingMemory wm=(ReteooWorkingMemory)context.wm;
  wm.getAgenda().unstageActivations();
  final boolean multithread=wm.isPartitionManagersActive();
  if (multithread) {
    context.writeBoolean(true);
    wm.stopPartitionManagers();
  }
 else {
    context.writeBoolean(false);
  }
  long time=0;
  if (context.wm.getTimerService() instanceof PseudoClockScheduler) {
    time=context.clockTime;
  }
  context.writeLong(time);
  context.writeInt(wm.getFactHandleFactory().getId());
  context.writeLong(wm.getFactHandleFactory().getRecency());
  InternalFactHandle handle=context.wm.getInitialFactHandle();
  context.writeInt(handle.getId());
  context.writeLong(handle.getRecency());
  context.writeLong(wm.getPropagationIdCounter());
  writeAgenda(context);
  writeInitialFactHandleRightTuples(context);
  for (  WorkingMemoryEntryPoint wmep : wm.getEntryPoints().values()) {
    context.stream.writeShort(PersisterEnums.ENTRY_POINT);
    context.stream.writeUTF(wmep.getEntryPointId());
    writeFactHandles(context,((NamedEntryPoint)wmep).getObjectStore());
  }
  context.stream.writeShort(PersisterEnums.END);
  writeInitialFactHandleLeftTuples(context);
  writePropagationContexts(context);
  writeActivations(context);
  writeActionQueue(context);
  writeTruthMaintenanceSystem(context);
  if (context.marshalProcessInstances && processMarshaller != null) {
    processMarshaller.writeProcessInstances(context);
  }
  if (context.marshalWorkItems && processMarshaller != null) {
    processMarshaller.writeWorkItems(context);
  }
  if (processMarshaller != null) {
    processMarshaller.writeProcessTimers(context);
  }
  writeTimers(context.wm.getTimerService().getTimerJobInstances(),context);
  if (multithread) {
    wm.startPartitionManagers();
  }
}
