{
  ObjectOutputStream stream=context.stream;
  List<org.drools.runtime.process.ProcessInstance> processInstances=new ArrayList<org.drools.runtime.process.ProcessInstance>(context.wm.getProcessInstances());
  Collections.sort(processInstances,new Comparator<org.drools.runtime.process.ProcessInstance>(){
    public int compare(    org.drools.runtime.process.ProcessInstance o1,    org.drools.runtime.process.ProcessInstance o2){
      return (int)(o1.getId() - o2.getId());
    }
  }
);
  for (  org.drools.runtime.process.ProcessInstance processInstance : processInstances) {
    stream.writeShort(PersisterEnums.PROCESS_INSTANCE);
    String processType=((ProcessInstanceImpl)processInstance).getProcess().getType();
    stream.writeUTF(processType);
    ProcessMarshallerRegistry.INSTANCE.getMarshaller(processType).writeProcessInstance(context,processInstance);
  }
  stream.writeShort(PersisterEnums.END);
}
