{
  try {
    InputStream in=stream;
    if (!(out instanceof BufferedOutputStream))     out=new BufferedOutputStream(out);
    if (!(in instanceof BufferedInputStream))     in=new BufferedInputStream(in);
    final byte[] buf=new byte[1024];
    int len=0;
    while ((len=in.read(buf)) >= 0) {
      out.write(buf,0,len);
    }
  }
  finally {
    out.flush();
    out.close();
    stream.close();
  }
}
