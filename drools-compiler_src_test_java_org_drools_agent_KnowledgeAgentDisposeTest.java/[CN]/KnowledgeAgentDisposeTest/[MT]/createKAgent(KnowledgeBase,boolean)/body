{
  ResourceChangeScannerConfiguration sconf=ResourceFactory.getResourceChangeScannerService().newResourceChangeScannerConfiguration();
  sconf.setProperty("drools.resource.scanner.interval","2");
  ResourceFactory.getResourceChangeScannerService().configure(sconf);
  KnowledgeAgentConfiguration aconf=KnowledgeAgentFactory.newKnowledgeAgentConfiguration();
  aconf.setProperty("drools.agent.scanDirectories","true");
  aconf.setProperty("drools.agent.scanResources","true");
  aconf.setProperty("drools.agent.newInstance","" + newInstance);
  KnowledgeAgent kagent=KnowledgeAgentFactory.newKnowledgeAgent("test agent",kbase,aconf);
  kagent.setSystemEventListener(new SystemEventListener(){
    public void info(    String message){
    }
    public void info(    String message,    Object object){
    }
    public void warning(    String message){
    }
    public void warning(    String message,    Object object){
    }
    public void exception(    String message,    Throwable e){
    }
    public void exception(    Throwable e){
    }
    public void debug(    String message){
      if ("KnowledgeAgent received ChangeSet changed notification".equals(message)) {
        resourceChangeNotificationCount++;
      }
    }
    public void debug(    String message,    Object object){
    }
  }
);
  kagent.addEventListener(new KnowledgeAgentEventListener(){
    public void beforeChangeSetApplied(    BeforeChangeSetAppliedEvent event){
    }
    public void afterChangeSetApplied(    AfterChangeSetAppliedEvent event){
    }
    public void beforeChangeSetProcessed(    BeforeChangeSetProcessedEvent event){
    }
    public void afterChangeSetProcessed(    AfterChangeSetProcessedEvent event){
    }
    public void beforeResourceProcessed(    BeforeResourceProcessedEvent event){
    }
    public void afterResourceProcessed(    AfterResourceProcessedEvent event){
    }
    public void knowledgeBaseUpdated(    KnowledgeBaseUpdatedEvent event){
      System.out.println("KBase was updated");
synchronized (lock) {
        kbaseUpdated=true;
        lock.notifyAll();
      }
    }
    public void resourceCompilationFailed(    ResourceCompilationFailedEvent event){
      compilationErrors=true;
    }
  }
);
  assertEquals("test agent",kagent.getName());
  return kagent;
}
