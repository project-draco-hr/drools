{
  this.ruleBase=new RuleBaseImpl();
  this.wm1=this.ruleBase.newWorkingMemory();
  this.ruleBaseAddRule=new RuleBaseImpl();
  this.workingMemory=this.ruleBaseAddRule.newWorkingMemory();
  ClassObjectType contextType=new ClassObjectType(Context.class);
  Evaluator integerEqualEvaluator=EvaluatorFactory.getEvaluator(Evaluator.INTEGER_TYPE,Evaluator.EQUAL);
  this.rule1=new Query("query-to-execute");
  Column contextColumnRule1=new Column(0,contextType,"context1");
  contextColumnRule1.addConstraint(getLiteralConstraint(contextColumnRule1,"state",new Integer(1),integerEqualEvaluator));
  this.rule1.addPattern(contextColumnRule1);
  this.rule2=new Rule("rule2");
  Column contextColumnRule2=new Column(0,contextType,"context2");
  contextColumnRule2.addConstraint(getLiteralConstraint(contextColumnRule2,"state",new Integer(1),integerEqualEvaluator));
  this.rule2.addPattern(contextColumnRule2);
  final Declaration contextRule2Declaration=rule2.getDeclaration("context2");
  this.rule2.setConsequence(new Consequence(){
    public void evaluate(    KnowledgeHelper drools,    WorkingMemory workingMemory) throws ConsequenceException {
      try {
        Rule rule=drools.getRule();
        Tuple tuple=drools.getTuple();
        Context dummy=(Context)drools.get(contextRule2Declaration);
        if (dummy == QueryTest.this.context1) {
          QueryTest.this.handlesForRules.add(QueryTest.this.handle1Rule2);
        }
 else         if (dummy == QueryTest.this.context2) {
          QueryTest.this.handlesForRules.add(QueryTest.this.handle2Rule2);
        }
      }
 catch (      Exception e) {
        throw new ConsequenceException(e);
      }
    }
  }
);
}
