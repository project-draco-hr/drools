{
  if (this.config.isSequential()) {
    throw new RuntimeException("Cannot have a stateful rule session, with sequential configuration set to true");
  }
  final DroolsObjectInputStream streamWithLoader=new DroolsObjectInputStream(stream,this.packageClassLoader);
  final AbstractWorkingMemory workingMemory=(AbstractWorkingMemory)streamWithLoader.readObject();
synchronized (this.pkgs) {
    workingMemory.setRuleBase(this);
  }
  return (StatefulSession)workingMemory;
}
