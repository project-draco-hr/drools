{
  boolean connected=this.client.connect();
  if (connected) {
    String commandId="serviceManager.connected" + getNextId();
    String kresultsId="kresults_" + getSessionId();
    Message msg=new Message(-1,counter.incrementAndGet(),false,new KnowledgeContextResolveFromContextCommand(new ServiceManagerClientConnectCommand(commandId),null,null,null,kresultsId));
    BlockingMessageResponseHandler handler=new BlockingMessageResponseHandler();
    try {
      client.addResponseHandler(msg.getResponseId(),handler);
      client.write(msg);
      Object object=handler.getMessage().getPayload();
      if (object == null) {
        throw new RuntimeException("Response was not correctly received");
      }
      sessionId=(Integer)((ExecutionResults)object).getValue(commandId);
      connected=true;
    }
 catch (    Exception e) {
      throw new RuntimeException("Unable to execute message",e);
    }
  }
  return connected;
}
