{
  if (status != TransactionManager.STATUS_COMMITTED) {
    this.service.rollback();
  }
  Object removedSynchronization=SingleSessionCommandService.synchronizations.remove(this.service);
  this.service.jpm.clearPersistenceContext();
  this.service.jpm.endCommandScopedEntityManager();
  StatefulKnowledgeSession ksession=this.service.ksession;
  if (ksession != null) {
    InternalProcessRuntime internalProcessRuntime=((InternalKnowledgeRuntime)ksession).getProcessRuntime();
    if (internalProcessRuntime != null) {
      internalProcessRuntime.clearProcessInstances();
    }
    ((JPAWorkItemManager)ksession.getWorkItemManager()).clearWorkItems();
  }
}
