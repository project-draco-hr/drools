{
  if (command instanceof DisposeCommand) {
    T result=commandService.execute((GenericCommand<T>)command);
    this.jpm.dispose();
    return result;
  }
  PersistenceContext persistenceContext=this.jpm.getApplicationScopedPersistenceContext();
  boolean transactionOwner=false;
  try {
    transactionOwner=txm.begin();
    persistenceContext.joinTransaction();
    initKsession(this.sessionInfo.getId(),this.marshallingHelper.getKbase(),this.marshallingHelper.getConf(),persistenceContext);
    this.jpm.beginCommandScopedEntityManager();
    registerRollbackSync();
    T result=null;
    if (command instanceof BatchExecutionCommand) {
      result=ksession.execute(command);
    }
 else {
      result=commandService.execute((GenericCommand<T>)command);
    }
    txm.commit(transactionOwner);
    return result;
  }
 catch (  RuntimeException re) {
    rollbackTransaction(re,transactionOwner);
    throw re;
  }
catch (  Exception t1) {
    rollbackTransaction(t1,transactionOwner);
    throw new RuntimeException("Wrapped exception see cause",t1);
  }
 finally {
    if (command instanceof DisposeCommand) {
      commandService.execute((GenericCommand<T>)command);
      this.jpm.dispose();
    }
  }
}
