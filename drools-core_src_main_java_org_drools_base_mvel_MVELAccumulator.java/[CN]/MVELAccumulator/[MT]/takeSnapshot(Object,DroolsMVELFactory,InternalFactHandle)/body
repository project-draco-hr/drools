{
  DroolsMVELShadowFactory shad=(DroolsMVELShadowFactory)factory;
  Map<String,Object> varsMap=((MVELAccumulatorContext)context).shadow.get(handle);
  if (varsMap == null) {
    varsMap=new HashMap<String,Object>();
    ((MVELAccumulatorContext)context).shadow.put(handle,varsMap);
  }
  for (  String var : shad.getShadowVariables()) {
    varsMap.put(var,shad.getVariableResolver(var).getValue());
  }
}
