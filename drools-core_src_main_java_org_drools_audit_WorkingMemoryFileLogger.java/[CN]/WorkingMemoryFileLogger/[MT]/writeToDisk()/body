{
  if (!initialized) {
    initializeLog();
  }
  FileWriter fileWriter=null;
  try {
    fileWriter=new FileWriter(this.fileName + (this.nbOfFile == 0 ? ".log" : this.nbOfFile + ".log"),true);
    final XStream xstream=new XStream();
    List<LogEvent> eventsToWrite=null;
synchronized (this.events) {
      eventsToWrite=new ArrayList<LogEvent>(this.events);
      clear();
    }
    for (    LogEvent event : eventsToWrite) {
      fileWriter.write(xstream.toXML(event) + "\n");
    }
  }
 catch (  final FileNotFoundException exc) {
    throw new RuntimeException("Could not create the log file.  Please make sure that directory that the log file should be placed in does exist.");
  }
catch (  final Throwable t) {
    logger.error("error",t);
  }
 finally {
    if (fileWriter != null) {
      try {
        fileWriter.close();
      }
 catch (      Exception e) {
      }
    }
  }
  if (terminate) {
    closeLog();
    terminate=true;
  }
 else   if (split) {
    closeLog();
    this.nbOfFile++;
    initialized=false;
  }
}
