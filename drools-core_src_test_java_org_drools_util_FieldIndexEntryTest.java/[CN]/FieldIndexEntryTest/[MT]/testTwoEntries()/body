{
  final ClassFieldExtractor extractor=ClassFieldExtractorCache.getExtractor(Cheese.class,"type",getClass().getClassLoader());
  final FieldIndex fieldIndex=new FieldIndex(extractor,null,StringFactory.getInstance().getEvaluator(Operator.EQUAL));
  final SingleIndex singleIndex=new SingleIndex(new FieldIndex[]{fieldIndex},1);
  final FieldIndexEntry index=new FieldIndexEntry(singleIndex,"stilton".hashCode());
  final Cheese stilton1=new Cheese("stilton",35);
  final InternalFactHandle h1=new DefaultFactHandle(1,stilton1);
  final Cheese stilton2=new Cheese("stilton",59);
  final InternalFactHandle h2=new DefaultFactHandle(2,stilton2);
  index.add(h1);
  index.add(h2);
  assertEquals(h2,index.getFirst().getFactHandle());
  assertEquals(h1,((FactEntryImpl)index.getFirst().getNext()).getFactHandle());
  assertEquals(h1,index.get(h1).getFactHandle());
  assertEquals(h2,index.get(h2).getFactHandle());
  index.remove(h2);
  assertEquals(h1,index.getFirst().getFactHandle());
  index.add(h2);
  index.remove(h1);
  assertEquals(h2,index.getFirst().getFactHandle());
  stilton1.setType("cheddar");
}
