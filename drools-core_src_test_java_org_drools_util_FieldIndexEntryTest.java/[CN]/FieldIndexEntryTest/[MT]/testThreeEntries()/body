{
  ClassFieldExtractor extractor=new ClassFieldExtractor(Cheese.class,"type");
  FieldIndexEntry index=new FieldIndexEntry(extractor,extractor.getIndex(),"stilton".hashCode());
  Cheese stilton1=new Cheese("stilton",35);
  InternalFactHandle h1=new DefaultFactHandle(1,stilton1);
  Cheese stilton2=new Cheese("stilton",59);
  InternalFactHandle h2=new DefaultFactHandle(2,stilton2);
  Cheese stilton3=new Cheese("stilton",59);
  InternalFactHandle h3=new DefaultFactHandle(3,stilton3);
  index.add(h1);
  index.add(h2);
  index.add(h3);
  assertEquals(h3,index.getFirst().getFactHandle());
  assertEquals(h2,((FactEntry)index.getFirst().getNext()).getFactHandle());
  assertEquals(h1,((FactEntry)index.getFirst().getNext().getNext()).getFactHandle());
  assertEquals(h1,index.get(h1).getFactHandle());
  assertEquals(h2,index.get(h2).getFactHandle());
  assertEquals(h3,index.get(h3).getFactHandle());
  index.remove(h3);
  assertEquals(h2,index.getFirst().getFactHandle());
  assertEquals(h1,((FactEntry)index.getFirst().getNext()).getFactHandle());
  index.add(h3);
  index.remove(h2);
  assertEquals(h3,index.getFirst().getFactHandle());
  assertEquals(h1,((FactEntry)index.getFirst().getNext()).getFactHandle());
  index.add(h2);
  index.remove(h1);
  assertEquals(h2,index.getFirst().getFactHandle());
  assertEquals(h3,((FactEntry)index.getFirst().getNext()).getFactHandle());
  index.remove(index.getFirst().getFactHandle());
  stilton2.setType("cheddar");
  assertEquals("stilton",index.getValue());
}
