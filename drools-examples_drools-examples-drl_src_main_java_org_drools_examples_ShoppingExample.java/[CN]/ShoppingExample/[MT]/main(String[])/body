{
  final KnowledgeBuilder builder=KnowledgeBuilderFactory.newKnowledgeBuilder();
  builder.addResource(new InputStreamReader(ShoppingExample.class.getResourceAsStream("Shopping.drl")),KnowledgeType.DRL);
  final KnowledgeBase knowledgeBase=KnowledgeBaseFactory.newKnowledgeBase();
  knowledgeBase.addKnowledgePackages(builder.getKnowledgePackages());
  final StatefulKnowledgeSession session=knowledgeBase.newStatefulKnowledgeSession();
  Customer mark=new Customer("mark",0);
  session.insert(mark);
  Product shoes=new Product("shoes",60);
  session.insert(shoes);
  Product hat=new Product("hat",60);
  session.insert(hat);
  session.insert(new Purchase(mark,shoes));
  FactHandle hatPurchaseHandle=session.insert(new Purchase(mark,hat));
  session.fireAllRules();
  session.retract(hatPurchaseHandle);
  System.out.println("Customer mark has returned the hat");
  session.fireAllRules();
}
