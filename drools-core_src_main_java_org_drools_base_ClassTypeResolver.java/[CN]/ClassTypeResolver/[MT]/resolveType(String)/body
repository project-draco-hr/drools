{
  Class clazz=null;
  boolean isArray=false;
  final StringBuilder arrayClassName=new StringBuilder();
  if (internalNamesMap.containsKey(className)) {
    clazz=Class.forName("[" + internalNamesMap.get(className),true,this.classLoader).getComponentType();
  }
 else   if (className.indexOf('[') > 0) {
    isArray=true;
    int bracketIndex=className.indexOf('[');
    final String componentName=className.substring(0,bracketIndex);
    arrayClassName.append('[');
    while ((bracketIndex=className.indexOf('[',bracketIndex + 1)) > 0) {
      arrayClassName.append('[');
    }
    className=componentName;
  }
  if (clazz == null) {
    clazz=lookupFromCache(className);
  }
  if (clazz == null) {
    try {
      clazz=this.classLoader.loadClass(className);
    }
 catch (    final ClassNotFoundException e) {
      clazz=null;
    }
  }
  if (clazz == null) {
    final Set validClazzCandidates=new HashSet();
    final Iterator it=this.imports.iterator();
    while (it.hasNext()) {
      clazz=importClass((String)it.next(),className);
      if (clazz != null) {
        validClazzCandidates.add(clazz);
      }
    }
    if (validClazzCandidates.size() > 1) {
      final StringBuilder sb=new StringBuilder();
      final Iterator clazzCandIter=validClazzCandidates.iterator();
      while (clazzCandIter.hasNext()) {
        if (0 != sb.length()) {
          sb.append(", ");
        }
        sb.append(((Class)clazzCandIter.next()).getName());
      }
      throw new Error("Unable to find unambiguously defined class '" + className + "', candidates are: ["+ sb.toString()+ "]");
    }
 else     if (validClazzCandidates.size() == 1) {
      clazz=(Class)validClazzCandidates.toArray()[0];
    }
 else {
      clazz=null;
    }
  }
  if (clazz == null) {
    clazz=defaultClass(className);
  }
  if (isArray) {
    if (clazz == null && internalNamesMap.containsKey(className)) {
      arrayClassName.append(internalNamesMap.get(className));
    }
 else {
      if (clazz != null) {
        arrayClassName.append("L").append(clazz.getName()).append(";");
      }
 else {
        arrayClassName.append("L").append(className).append(";");
      }
    }
    try {
      clazz=Class.forName(arrayClassName.toString());
    }
 catch (    final ClassNotFoundException e) {
      clazz=null;
    }
  }
  if (clazz == null) {
    throw new ClassNotFoundException("Unable to find class '" + className + "'");
  }
  return clazz;
}
