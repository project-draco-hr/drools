{
  try {
    createRuleResource();
    KnowledgeBase kbase=KnowledgeBaseFactory.newKnowledgeBase();
    KnowledgeAgent kAgent=createKAgent(kbase,false);
    ChangeSetHelperImpl cs=new ChangeSetHelperImpl();
    FileSystemResource f=(FileSystemResource)ResourceFactory.newFileResource(res);
    f.setResourceType(ResourceType.DRL);
    cs.addNewResource(f);
    kAgent.applyChangeSet(cs.getChangeSet());
    ksession=kAgent.getKnowledgeBase().newStatefulKnowledgeSession();
    Message message=new Message();
    message.setMessage("Hello World");
    message.setStatus(Message.HELLO);
    FactHandle fact=ksession.insert(message);
    Message message2=new Message();
    message2.setMessage("Hello World 2");
    message2.setStatus(Message.HELLO);
    FactHandle fact2=ksession.insert(message2);
    Message message3=new Message();
    message3.setMessage("Hello World 3");
    message3.setStatus(Message.HELLO);
    FactHandle fact3=ksession.insert(message3);
    ksession.fireAllRules();
    assertEquals(12,ksession.getObjects().size());
    ChangeSetHelperImpl cs2=new ChangeSetHelperImpl();
    cs2.addRemovedResource(ResourceFactory.newFileResource(res));
    kAgent.applyChangeSet(cs2.getChangeSet());
    KnowledgePackage kp=kAgent.getKnowledgeBase().getKnowledgePackage("com.sample");
    assertEquals(0,kp.getRules().size());
    ksession.fireAllRules();
    assertEquals(3,ksession.getObjects().size());
    ksession.dispose();
    kAgent.dispose();
  }
 catch (  Throwable t) {
    t.printStackTrace();
    fail(t.getMessage());
  }
}
