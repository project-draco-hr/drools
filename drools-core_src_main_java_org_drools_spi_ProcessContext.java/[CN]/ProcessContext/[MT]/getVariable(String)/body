{
  VariableScopeInstance variableScope=null;
  if (nodeInstance != null) {
    variableScope=(VariableScopeInstance)((org.drools.workflow.instance.NodeInstance)nodeInstance).resolveContextInstance(VariableScope.VARIABLE_SCOPE,variableName);
  }
  if (variableScope == null) {
    variableScope=(VariableScopeInstance)((ProcessInstance)getProcessInstance()).getContextInstance(VariableScope.VARIABLE_SCOPE);
  }
  return variableScope.getVariable(variableName);
}
