{
  LeapsWorkingMemory workingMemory=(LeapsWorkingMemory)RuleBaseFactory.newRuleBase(RuleBase.LEAPS).newWorkingMemory();
  TruthMaintenanceSystem tms=workingMemory.getTruthMaintenanceSystem();
  String string="test";
  FactHandle fd=workingMemory.assertObject(string);
  assertEquals(1,tms.getAssertMap().size());
  EqualityKey key=tms.get(string);
  assertSame(fd,key.getFactHandle());
  assertNull(key.getOtherFactHandle());
  workingMemory.modifyObject(fd,string);
  assertEquals(1,tms.getAssertMap().size());
  key=tms.get(string);
  assertNotSame(fd,key.getFactHandle());
  assertNull(key.getOtherFactHandle());
  workingMemory.retractObject(key.getFactHandle());
  assertEquals(0,tms.getAssertMap().size());
  key=tms.get(string);
  assertNull(key);
  fd=workingMemory.assertObject(string);
  assertEquals(1,tms.getAssertMap().size());
  assertEquals(1,tms.getAssertMap().size());
  key=tms.get(string);
  assertSame(fd,key.getFactHandle());
  assertNull(key.getOtherFactHandle());
}
