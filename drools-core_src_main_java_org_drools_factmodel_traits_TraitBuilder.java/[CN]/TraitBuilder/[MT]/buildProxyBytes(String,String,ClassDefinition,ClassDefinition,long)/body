{
  ClassWriter cw=new ClassWriter(0);
  FieldVisitor fv;
  MethodVisitor mv;
  String internalWrapper=BuildUtils.getInternalType(name);
  String internalProxy=BuildUtils.getInternalType(masterName);
  String descrWrapper=BuildUtils.getTypeDescriptor(name);
  String descrProxy=BuildUtils.getTypeDescriptor(masterName);
  String internalCore=BuildUtils.getInternalType(core.getClassName());
  String descrCore=BuildUtils.getTypeDescriptor(core.getClassName());
  String internalTrait=BuildUtils.getInternalType(trait.getClassName());
  String descrTrait=BuildUtils.getTypeDescriptor(trait.getClassName());
  cw.visit(V1_5,ACC_PUBLIC + ACC_SUPER,internalProxy,null,"org/drools/factmodel/traits/TraitProxy",new String[]{internalTrait});
{
    fv=cw.visitField(ACC_PUBLIC + ACC_FINAL,"object",descrCore,null,null);
    fv.visitEnd();
  }
{
    fv=cw.visitField(ACC_PUBLIC + ACC_FINAL,"map","Ljava/util/Map;","Ljava/util/Map<Ljava/lang/String;Ljava/lang/Object;>;",null);
    fv.visitEnd();
  }
{
    mv=cw.visitMethod(ACC_PUBLIC,"<init>","(" + descrCore + "Ljava/util/Map;)V","(" + descrCore + "Ljava/util/Map<Ljava/lang/String;Ljava/lang/Object;>;)V",null);
    mv.visitCode();
    mv.visitVarInsn(ALOAD,0);
    mv.visitMethodInsn(INVOKESPECIAL,"org/drools/factmodel/traits/TraitProxy","<init>","()V");
    mv.visitVarInsn(ALOAD,0);
    mv.visitVarInsn(ALOAD,1);
    mv.visitFieldInsn(PUTFIELD,internalProxy,"object",descrCore);
    mv.visitVarInsn(ALOAD,0);
    mv.visitVarInsn(ALOAD,2);
    mv.visitFieldInsn(PUTFIELD,internalProxy,"map","Ljava/util/Map;");
    mv.visitVarInsn(ALOAD,0);
    mv.visitTypeInsn(NEW,internalWrapper);
    mv.visitInsn(DUP);
    mv.visitVarInsn(ALOAD,1);
    mv.visitVarInsn(ALOAD,2);
    mv.visitMethodInsn(INVOKESPECIAL,internalWrapper,"<init>","(" + descrCore + "Ljava/util/Map;)V");
    mv.visitFieldInsn(PUTFIELD,internalProxy,"fields","Ljava/util/Map;");
    mv.visitInsn(RETURN);
    mv.visitMaxs(5,3);
    mv.visitEnd();
  }
{
    mv=cw.visitMethod(ACC_PUBLIC,"getCore","()" + descrCore + "",null,null);
    mv.visitCode();
    mv.visitVarInsn(ALOAD,0);
    mv.visitFieldInsn(GETFIELD,internalProxy,"object",descrCore);
    mv.visitInsn(ARETURN);
    mv.visitMaxs(1,1);
    mv.visitEnd();
  }
{
    mv=cw.visitMethod(ACC_PUBLIC,"getObject","()Ljava/lang/Object;",null,null);
    mv.visitCode();
    mv.visitVarInsn(ALOAD,0);
    mv.visitFieldInsn(GETFIELD,internalProxy,"object",descrCore);
    mv.visitInsn(ARETURN);
    mv.visitMaxs(1,1);
    mv.visitEnd();
  }
{
    mv=cw.visitMethod(ACC_PUBLIC + ACC_BRIDGE + ACC_SYNTHETIC,"getCore","()Ljava/lang/Object;",null,null);
    mv.visitCode();
    mv.visitVarInsn(ALOAD,0);
    mv.visitMethodInsn(INVOKEVIRTUAL,internalProxy,"getCore","()" + descrCore + "");
    mv.visitInsn(ARETURN);
    mv.visitMaxs(1,1);
    mv.visitEnd();
  }
  int j=0;
  for (  FieldDefinition field : trait.getFieldsDefinitions()) {
    boolean isSoftField=(mask & (1 << j++)) == 0;
    if (isSoftField) {
      buildSoftGetter(cw,field.getName(),field.getTypeName(),masterName,core.getName());
      buildSoftSetter(cw,field.getName(),field.getTypeName(),masterName,core.getName());
    }
 else {
{
        fv=cw.visitField(ACC_PUBLIC + ACC_STATIC,field.getName() + "_reader","Lorg/drools/spi/InternalReadAccessor;",null,null);
        fv.visitEnd();
      }
{
        fv=cw.visitField(ACC_PUBLIC + ACC_STATIC,field.getName() + "_writer","Lorg/drools/spi/WriteAccessor;",null,null);
        fv.visitEnd();
      }
      buildHardGetter(cw,field,masterName,trait,core);
      buildHardSetter(cw,field,masterName,trait,core);
    }
  }
  buildEqualityMethods(cw,masterName,core.getClassName());
  cw.visitEnd();
  return cw.toByteArray();
}
