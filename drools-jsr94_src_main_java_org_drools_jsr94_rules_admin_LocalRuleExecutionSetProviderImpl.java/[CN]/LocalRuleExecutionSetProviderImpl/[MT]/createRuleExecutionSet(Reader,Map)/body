{
  try {
    final PackageBuilder builder=new PackageBuilder();
    Object dsl=null;
    String source=null;
    if (properties != null) {
      dsl=properties.get("dsl");
      source=(String)properties.get("source");
    }
    if (source == null) {
      source="drl";
    }
    if (dsl == null) {
      if (source.equals("xml")) {
        builder.addPackageFromXml(ruleExecutionSetReader);
      }
 else {
        builder.addPackageFromDrl(ruleExecutionSetReader);
      }
    }
 else {
      if (source.equals("xml")) {
        builder.addPackageFromXml(ruleExecutionSetReader);
      }
 else {
        if (dsl instanceof Reader) {
          builder.addPackageFromDrl(ruleExecutionSetReader,(Reader)dsl);
        }
 else {
          builder.addPackageFromDrl(ruleExecutionSetReader,new StringReader((String)dsl));
        }
      }
    }
    final Package pkg=builder.getPackage();
    return createRuleExecutionSet(pkg,properties);
  }
 catch (  final IOException e) {
    throw new RuleExecutionSetCreateException("cannot create rule execution set",e);
  }
catch (  final DroolsParserException e) {
    throw new RuleExecutionSetCreateException("cannot create rule execution set",e);
  }
}
