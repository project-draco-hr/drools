{
  InternalWorkingMemory iwm=(InternalWorkingMemory)wm;
  Map<Rule,BaseNode[]> map=((InternalRuleBase)iwm.getRuleBase()).getReteooBuilder().getTerminalNodes();
  for (  BaseNode[] nodes : map.values()) {
    for (    BaseNode node : nodes) {
      RuleTerminalNode rtn=(RuleTerminalNode)node;
      RuleMemory rs=(RuleMemory)iwm.getNodeMemory(rtn);
      RuleNetworkEvaluatorActivation item=(RuleNetworkEvaluatorActivation)rs.getAgendaItem();
      if (item != null) {
        item.dequeue();
        int count=((RuleNetworkEvaluatorActivation)item).evaluateNetwork(iwm);
        if (count > 0) {
          ((InternalAgenda)iwm.getAgenda()).addActivation(item);
        }
      }
    }
  }
}
