{
  File ruleFile=new File(TMP_DIR + "sample.xls");
  copy(getClass().getResourceAsStream("sample.xls"),new FileOutputStream(ruleFile));
  String XLS_CHANGESET="<change-set xmlns=\"http://drools.org/drools-5.0/change-set\"\n" + "            xmlns:xs=\"http://www.w3.org/2001/XMLSchema-instance\"\n" + "            xs:schemaLocation=\"http://drools.org/drools-5.0/change-set http://anonsvn.jboss.org/repos/labs/labs/jbossrules/trunk/drools-api/src/main/resources/change-set-1.0.0.xsd\">\n"+ "  <add>\n"+ "    <resource source=\"file:" + ruleFile.getAbsolutePath() + "\" type=\"DTABLE\">\n"+ "      <decisiontable-conf input-type=\"XLS\" worksheet-name=\"Tables\"/>\n"+ "    </resource>"+ "  </add>\n"+ "</change-set>\n";
  File xlsChangeset=new File(TMP_DIR + "xlsChangeset.xml");
  xlsChangeset.deleteOnExit();
  writeToFile(xlsChangeset,XLS_CHANGESET);
  ResourceChangeScannerConfiguration config=ResourceFactory.getResourceChangeScannerService().newResourceChangeScannerConfiguration();
  config.setProperty("drools.resource.scanner.interval","1");
  ResourceFactory.getResourceChangeScannerService().configure(config);
  KnowledgeAgent kagent=KnowledgeAgentFactory.newKnowledgeAgent("xls agent");
  kagent.applyChangeSet(ResourceFactory.newFileResource(xlsChangeset));
  KnowledgeBase kbase=kagent.getKnowledgeBase();
  ResourceFactory.getResourceChangeNotifierService().start();
  ResourceFactory.getResourceChangeScannerService().start();
  assertEquals(2,kbase.getKnowledgePackages().size());
  assertEquals(3,kbase.getKnowledgePackages().iterator().next().getRules().size());
  Thread.sleep(1500);
  ruleFile.delete();
  ruleFile=new File(TMP_DIR + "sample.xls");
  copy(getClass().getResourceAsStream("sample2.xls"),new FileOutputStream(ruleFile));
  Thread.sleep(1000);
  assertEquals(kbase.getKnowledgePackages().size(),1);
  assertEquals(kbase.getKnowledgePackages().iterator().next().getRules().size(),3);
  kbase=kagent.getKnowledgeBase();
  assertEquals(2,kbase.getKnowledgePackages().size());
  assertEquals(2,kbase.getKnowledgePackages().iterator().next().getRules().size());
  ResourceFactory.getResourceChangeNotifierService().stop();
  ResourceFactory.getResourceChangeScannerService().stop();
  kagent.dispose();
}
