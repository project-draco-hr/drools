{
  Options xjcOpts=new Options();
  xjcOpts.setSchemaLanguage(Language.XMLSCHEMA);
  PackageBuilder pkgBuilder=new PackageBuilder();
  InputStream stream=getClass().getResourceAsStream("order.xsd");
  String[] classNames=DroolsJaxbHelper.addModel(new InputStreamReader(stream),pkgBuilder,xjcOpts,"xsd");
  assertFalse(pkgBuilder.hasErrors());
  pkgBuilder.addPackageFromDrl(new InputStreamReader(getClass().getResourceAsStream("test_Jaxb.drl")));
  RuleBase rb=RuleBaseFactory.newRuleBase();
  rb.addPackages(pkgBuilder.getPackages());
  JAXBContext jaxbCtx=DroolsJaxbHelper.newInstance(classNames,rb);
  Unmarshaller unmarshaller=jaxbCtx.createUnmarshaller();
  StatefulSession session=rb.newStatefulSession();
  List list1=new ArrayList();
  List list2=new ArrayList();
  session.setGlobal("list1",list1);
  session.setGlobal("list2",list2);
  DroolsJaxbConfiguration configuration=new DroolsJaxbConfiguration();
  configuration.setIterableGetter("this.orderItem");
  DroolsJaxbStatefulSession dataLoader=new DroolsJaxbStatefulSession(session,unmarshaller,configuration);
  Map<FactHandle,Object> handles=dataLoader.insertUnmarshalled(new InputStreamReader(getClass().getResourceAsStream("order.xml")));
  session.fireAllRules();
  assertEquals(2,handles.size());
  assertEquals(1,list1.size());
  assertEquals(1,list2.size());
  assertEquals("org.drools.model.order.Order$OrderItem",list1.get(0).getClass().getName());
  assertEquals("org.drools.model.order.Order$OrderItem",list2.get(0).getClass().getName());
  assertNotSame(list1.get(0),list2.get(0));
}
