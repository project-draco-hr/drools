{
  final UpgradableReentrantReadWriteLock lock=new UpgradableReentrantReadWriteLock(true);
  lock.readLock();
  new Thread(new Runnable(){
    public void run(){
      lock.readLock();
      sleep();
      sleep();
      sleep();
      lock.readUnlock();
    }
  }
).start();
  new Thread(new Runnable(){
    public void run(){
      lock.readLock();
      lock.readLock();
      sleep();
      lock.readUnlock();
      sleep();
      lock.readUnlock();
    }
  }
).start();
  new Thread(new Runnable(){
    public void run(){
      lock.readLock();
      lock.writeLock();
      sleep();
      sleep();
      lock.readUnlock();
      lock.writeUnlock();
    }
  }
).start();
  new Thread(new Runnable(){
    public void run(){
      lock.writeLock();
      sleep();
      lock.readLock();
      sleep();
      sleep();
      lock.readUnlock();
      sleep();
      lock.writeUnlock();
    }
  }
).start();
  sleep();
  lock.writeLock();
  sleep();
  sleep();
  lock.writeUnlock();
  lock.readUnlock();
}
