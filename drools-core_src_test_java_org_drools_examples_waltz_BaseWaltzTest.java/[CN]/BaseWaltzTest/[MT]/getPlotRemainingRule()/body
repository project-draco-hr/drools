{
  final Rule rule=new Rule("plot_remaining");
  Column stageColumn=new Column(0,stageType,"stage");
  stageColumn.addConstraint(getLiteralConstraint(stageColumn,"value",new Integer(Stage.PLOT_REMAINING_EDGES),this.integerEqualEvaluator));
  rule.addPattern(stageColumn);
  Column edgeColumn=new Column(1,edgeType,"edge");
  edgeColumn.addConstraint(getLiteralConstraint(edgeColumn,"plotted",Edge.NIL,this.objectEqualEvaluator));
  edgeColumn.addConstraint(getLiteralConstraint(edgeColumn,"label",Edge.NIL,this.objectNotEqualEvaluator));
  rule.addPattern(edgeColumn);
  final Declaration edgeDeclaration=rule.getDeclaration("edge");
  Consequence consequence=new Consequence(){
    public void evaluate(    Activation activation,    WorkingMemory workingMemory) throws ConsequenceException {
      try {
        Rule rule=activation.getRule();
        Tuple tuple=activation.getTuple();
        KnowledgeHelper drools=new DefaultKnowledgeHelper(rule,tuple,workingMemory);
        Edge edge=(Edge)drools.get(edgeDeclaration);
        System.out.println("plot " + edge.getLabel() + " "+ edge.getP1()+ " "+ edge.getP2());
        edge.setPlotted(Edge.TRUE);
        drools.modifyObject(tuple.get(edgeDeclaration),edge);
      }
 catch (      Exception e) {
        e.printStackTrace();
        throw new ConsequenceException(e);
      }
    }
  }
;
  rule.setConsequence(consequence);
  return rule;
}
