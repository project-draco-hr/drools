{
  if (!this.actionQueue.isEmpty()) {
    executeQueuedActions();
  }
  final Process process=((InternalRuleBase)getRuleBase()).getProcess(processId);
  if (process == null) {
    throw new IllegalArgumentException("Unknown process ID: " + processId);
  }
  ProcessInstanceFactory factory=processInstanceFactories.get(process.getType());
  if (factory == null) {
    throw new IllegalArgumentException("Could not create process instance for type: " + process.getType());
  }
  ProcessInstance processInstance=factory.createProcessInstance();
  processInstance.setWorkingMemory(this);
  processInstance.setProcess(process);
  processInstance.setId(++processCounter);
  processInstances.put(new Long(processInstance.getId()),processInstance);
  VariableScope variableScope=(VariableScope)process.getDefaultContext(VariableScope.VARIABLE_SCOPE);
  VariableScopeInstance variableScopeInstance=(VariableScopeInstance)processInstance.getContextInstance(VariableScope.VARIABLE_SCOPE);
  if (variableScope != null) {
    for (    Variable variable : variableScope.getVariables()) {
      variableScopeInstance.setVariable(variable.getName(),variable.getValue());
    }
  }
  if (parameters != null) {
    if (variableScope != null) {
      for (      Map.Entry<String,Object> entry : parameters.entrySet()) {
        variableScopeInstance.setVariable(entry.getKey(),entry.getValue());
      }
    }
 else {
      throw new IllegalArgumentException("This process does not support parameters!");
    }
  }
  getRuleFlowEventSupport().fireBeforeRuleFlowProcessStarted(processInstance,this);
  processInstance.start();
  getRuleFlowEventSupport().fireAfterRuleFlowProcessStarted(processInstance,this);
  return processInstance;
}
