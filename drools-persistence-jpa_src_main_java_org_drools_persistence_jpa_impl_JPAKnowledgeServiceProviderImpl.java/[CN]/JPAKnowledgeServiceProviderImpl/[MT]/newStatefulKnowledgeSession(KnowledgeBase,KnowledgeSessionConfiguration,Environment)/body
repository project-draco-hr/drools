{
  if (configuration == null) {
    configuration=new SessionConfiguration();
  }
  if (environment == null) {
    throw new IllegalArgumentException("Environment cannot be null");
  }
  return new CommandBasedStatefulKnowledgeSession(buildCommanService(kbase,mergeConfig(configuration),environment));
}
