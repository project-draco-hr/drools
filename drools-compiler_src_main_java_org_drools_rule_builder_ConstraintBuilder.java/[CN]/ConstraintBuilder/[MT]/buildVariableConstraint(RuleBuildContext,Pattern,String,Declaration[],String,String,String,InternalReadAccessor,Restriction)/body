{
  if (USE_MVEL_EXPRESSION) {
    if (!isMvelOperator(operator)) {
      return new EvaluatorConstraint(restriction.getRequiredDeclarations(),restriction.getEvaluator(),extractor);
    }
    boolean isUnification=restriction instanceof UnificationRestriction;
    if (isUnification) {
      expression=resolveUnificationAmbiguity(expression,declarations,leftValue,rightValue);
    }
    boolean isIndexable=operator.equals("==");
    MVELCompilationUnit compilationUnit=isUnification ? null : buildCompilationUnit(context,pattern,expression);
    return new MvelConstraint(context.getPkg().getName(),expression,declarations,compilationUnit,isIndexable,getIndexingDeclaration(restriction),extractor,isUnification);
  }
 else {
    return new VariableConstraint(extractor,restriction);
  }
}
