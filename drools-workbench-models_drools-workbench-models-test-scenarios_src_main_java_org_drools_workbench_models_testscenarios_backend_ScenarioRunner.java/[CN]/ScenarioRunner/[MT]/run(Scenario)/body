{
  final Map<String,Object> populatedData=new HashMap<String,Object>();
  final Map<String,Object> globalData=new HashMap<String,Object>();
  final ClassLoader classloader=Thread.currentThread().getContextClassLoader();
  final KieBase kieBase=ksession.getKieBase();
  final RuleBase ruleBase=((KnowledgeBaseImpl)kieBase).getRuleBase();
  final ClassLoader classloader2=((InternalRuleBase)ruleBase).getRootClassLoader();
  final ClassTypeResolver resolver=new ClassTypeResolver(getImports(scenario),classloader2);
  this.workingMemoryWrapper=new TestScenarioKSessionWrapper(ksession,resolver,classloader,populatedData,globalData);
  this.factPopulatorFactory=new FactPopulatorFactory(populatedData,globalData,resolver,classloader);
  this.factPopulator=new FactPopulator(ksession,populatedData);
  MVEL.COMPILER_OPT_ALLOW_NAKED_METH_CALL=true;
  scenario.setLastRunResult(new Date());
  populateGlobals(scenario.getGlobals());
  applyFixtures(scenario.getFixtures(),createScenarioSettings(scenario));
}
