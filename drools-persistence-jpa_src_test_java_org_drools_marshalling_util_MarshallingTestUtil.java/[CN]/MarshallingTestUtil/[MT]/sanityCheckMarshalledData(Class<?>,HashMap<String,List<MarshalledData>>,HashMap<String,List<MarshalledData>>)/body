{
  Set<String> testTestMethods=new HashSet<String>(testSnapshotsPerTestMap.keySet());
  List<String> untestableTestMethods=new ArrayList<String>();
  for (  String baseTestMethod : baseSnapshotsPerTestMap.keySet()) {
    if (!testTestMethods.contains(baseTestMethod)) {
      logger.error("Marshalled data snapshots for test " + baseTestMethod + " exist in the base db, but not in the test db generated by this test run!");
      untestableTestMethods.add(baseTestMethod);
    }
 else {
      Assert.assertNotNull("Empty list of marshalled data snapshots in base for " + baseTestMethod,baseSnapshotsPerTestMap.get(baseTestMethod));
      if (baseSnapshotsPerTestMap.get(baseTestMethod).size() != testSnapshotsPerTestMap.get(baseTestMethod).size()) {
        logger.error("Test has changed: unequal number of marshalled data snapshots for test " + baseTestMethod);
        if (testSnapshotsPerTestMap.remove(baseTestMethod) != null) {
          logger.warn("Removing data and NOT comparing data for test " + baseTestMethod);
          untestableTestMethods.add(baseTestMethod);
        }
      }
      testTestMethods.remove(baseTestMethod);
    }
  }
  for (  String badTestMethod : untestableTestMethods) {
    baseSnapshotsPerTestMap.remove(badTestMethod);
  }
  for (  String testMethod : testTestMethods) {
    logger.info("Marshalled data snapshots for test " + testMethod + " do not exist in this base db.");
    testSnapshotsPerTestMap.keySet().remove(testMethod);
  }
}
