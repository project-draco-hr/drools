{
  Options xjcOpts=new Options();
  xjcOpts.setSchemaLanguage(Language.XMLSCHEMA);
  KnowledgeBuilder kbuilder=KnowledgeBuilderFactory.newKnowledgeBuilder();
  String[] classNames=KnowledgeBuilderHelper.addXsdModel(ResourceFactory.newClassPathResource("order.xsd",getClass()),kbuilder,xjcOpts,"xsd");
  assertFalse(kbuilder.hasErrors());
  kbuilder.add(ResourceFactory.newClassPathResource("test_Jaxb.drl",getClass()),ResourceType.DRL);
  KnowledgeBase kbase=KnowledgeBaseFactory.newKnowledgeBase();
  kbase.addKnowledgePackages(kbuilder.getKnowledgePackages());
  StatefulKnowledgeSession ksession=kbase.newStatefulKnowledgeSession();
  List list1=new ArrayList();
  ksession.setGlobal("list1",list1);
  JAXBContext jaxbCtx=KnowledgeBuilderHelper.newJAXBContext(classNames,kbase);
  Unmarshaller unmarshaller=jaxbCtx.createUnmarshaller();
  Transformer transformer=PipelineFactory.newJaxbTransformer(unmarshaller);
  transformer.addReceiver(PipelineFactory.newStatefulKnowledgeSessionReceiverAdapter());
  StatefulKnowledgeSessionDataLoader dataLoader=new StatefulKnowledgeSessionDataLoaderImpl(ksession,transformer);
  Map<FactHandle,Object> handles=dataLoader.insert(new StreamSource(getClass().getResourceAsStream("order.xml")));
  ksession.fireAllRules();
  assertEquals(1,handles.size());
  assertEquals(1,list1.size());
  assertEquals("org.drools.model.order.Order",list1.get(0).getClass().getName());
}
