{
  this.configuration=configuration;
  this.pkg=pkg;
  this.methods=new ArrayList();
  this.invokers=new HashMap();
  this.invokerLookups=new HashMap();
  this.descrLookups=new HashMap();
  this.errors=new ArrayList();
  this.buildStack=new Stack();
  this.declarationResolver=new DeclarationScopeResolver(new Map[]{this.pkg.getGlobals()},this.buildStack);
  this.ruleDescr=ruleDescr;
  if (ruleDescr instanceof QueryDescr) {
    this.rule=new Query(ruleDescr.getName());
  }
 else {
    this.rule=new Rule(ruleDescr.getName());
  }
  setAttributes(this.rule,ruleDescr,ruleDescr.getAttributes());
  this.dialectRegistry=dialectRegistry;
  this.dialect=(this.rule.getDialect() != null) ? this.dialectRegistry.getDialectConfiguration(this.rule.getDialect()).getDialect() : defaultDialect;
  getDialect().init(ruleDescr);
}
