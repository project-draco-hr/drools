{
  int varLength=inputIdentifiers.length;
  int i=0;
  if (rightObject != null) {
    factory.getIndexedVariableResolver(i++).setValue(rightObject);
  }
  factory.getIndexedVariableResolver(i++).setValue(knowledgeHelper);
  factory.getIndexedVariableResolver(i++).setValue(knowledgeHelper);
  factory.getIndexedVariableResolver(i++).setValue(rule);
  if (globalIdentifiers != null) {
    for (int j=0, length=globalIdentifiers.length; j < length; j++) {
      factory.getIndexedVariableResolver(i++).setValue(globals.resolveGlobal(this.globalIdentifiers[j]));
    }
  }
  InternalFactHandle[] handles;
  if (tuples != null) {
    handles=tuples.toFactHandles();
  }
 else {
    handles=new InternalFactHandle[0];
  }
  if (operators != null) {
    for (int j=0, length=operators.length; j < length; j++) {
      factory.getIndexedVariableResolver(i++).setValue(operators[j].setWorkingMemory(workingMemory));
      if (operators[j].getLeftBinding() != null) {
        if (operators[j].getLeftBinding().getIdentifier().equals("this")) {
          operators[j].setLeftHandle((InternalFactHandle)workingMemory.getFactHandle(rightObject));
        }
 else {
          operators[j].setLeftHandle(getFactHandle(operators[j].getLeftBinding(),handles));
        }
      }
      if (operators[j].getRightBinding() != null) {
        if (operators[j].getRightBinding().getIdentifier().equals("this")) {
          operators[j].setRightHandle((InternalFactHandle)workingMemory.getFactHandle(rightObject));
        }
 else {
          operators[j].setRightHandle(getFactHandle(operators[j].getRightBinding(),handles));
        }
      }
    }
  }
  IdentityHashMap<Object,FactHandle> identityMap=null;
  if (knowledgeHelper != null) {
    identityMap=new IdentityHashMap<Object,FactHandle>();
  }
  if (tuples != null) {
    if (this.previousDeclarations != null && this.previousDeclarations.length > 0) {
      if (prevDecl == null) {
        prevDecl=this.previousDeclarations;
      }
      for (int j=0, length=prevDecl.length; j < length; j++) {
        Declaration decl=prevDecl[j];
        InternalFactHandle handle=getFactHandle(decl,handles);
        Object o=decl.getValue(workingMemory,handle.getObject());
        if (knowledgeHelper != null && decl.isPatternDeclaration()) {
          identityMap.put(o,handle);
        }
        factory.getIndexedVariableResolver(i++).setValue(o);
      }
    }
  }
  if (this.localDeclarations != null && this.localDeclarations.length > 0) {
    for (int j=0, length=this.localDeclarations.length; j < length; j++) {
      Declaration decl=this.localDeclarations[j];
      Object o=decl.getValue(workingMemory,rightObject);
      factory.getIndexedVariableResolver(i++).setValue(o);
    }
  }
  int otherVarsPos=0;
  if (otherVars != null) {
    otherVarsPos=i;
    for (    Object o : otherVars) {
      factory.getIndexedVariableResolver(i++).setValue(o);
    }
  }
  int otherVarsLength=i - otherVarsPos;
  for (i=varLength; i < this.allVarsLength; i++) {
    factory.getIndexedVariableResolver(i).setValue(null);
  }
  DroolsVarFactory df=(DroolsVarFactory)factory.getNextFactory();
  df.setOtherVarsPos(otherVarsPos);
  df.setOtherVarsLength(otherVarsLength);
  if (knowledgeHelper != null && knowledgeHelper instanceof KnowledgeHelper) {
    KnowledgeHelper kh=(KnowledgeHelper)knowledgeHelper;
    kh.setIdentityMap(identityMap);
    df.setKnowledgeHelper(kh);
  }
}
