{
  for (int i=readHoldCount; i > 1; i--)   lock.readLock().unlock();
synchronized (highPriorityMonitor) {
    if (lock.getReadLockCount() > readHoldCount || lock.isWriteLocked()) {
      try {
        highPriorityMonitor.wait();
      }
 catch (      InterruptedException e) {
        throw new RuntimeException(e);
      }
    }
  }
  lock.readLock().unlock();
  lock.writeLock().lock();
  tryingLockUpgrade.set(false);
synchronized (lowPriotityMonitor) {
    lowPriotityMonitor.notifyAll();
  }
}
