{
  if (lock.getWriteHoldCount() == 1) {
    int[] lockCounter=lockCounters.get();
    if (lockCounter[1] > 0) {
      for (int i=lockCounter[1]; i > 0; i--) {
        lock.readLock().lock();
      }
      lockCounter[1]=0;
    }
  }
  lock.writeLock().unlock();
  notifyUpgradingThread();
}
