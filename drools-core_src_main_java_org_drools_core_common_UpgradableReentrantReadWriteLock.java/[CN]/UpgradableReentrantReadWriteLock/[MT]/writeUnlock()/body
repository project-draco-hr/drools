{
  if (lock.getWriteHoldCount() == 1) {
    LockRequestCounter lockCounter=lockCounters.get();
    if (lockCounter.upgradedReadCounter > 0) {
      for (int i=lockCounter.upgradedReadCounter; i > 0; i--) {
        lock.readLock().lock();
      }
      lockCounter.upgradedReadCounter=0;
    }
  }
  lock.writeLock().unlock();
  notifyUpgradingThread();
}
