{
  RuleParser parser=parseResource("simple_expander.drl");
  MockExpanderResolver mockExpanderResolver=new MockExpanderResolver();
  parser.setExpanderResolver(mockExpanderResolver);
  parser.compilation_unit();
  PackageDescr pack=parser.getPackageDescr();
  assertNotNull(pack);
  assertEquals(1,pack.getRules().size());
  assertTrue(mockExpanderResolver.checkCalled("foo.dsl"));
  RuleDescr rule=(RuleDescr)pack.getRules().get(0);
  assertEquals("simple_rule",rule.getName());
  assertEquals(4,rule.getLhs().getDescrs().size());
  ColumnDescr col=(ColumnDescr)rule.getLhs().getDescrs().get(0);
  assertEquals("Bar",col.getObjectType());
  assertEquals("foo1",col.getIdentifier());
  assertEquals(1,col.getDescrs().size());
  LiteralDescr lit=(LiteralDescr)col.getDescrs().get(0);
  assertEquals("==",lit.getEvaluator());
  assertEquals("a",lit.getFieldName());
  assertEquals("1",lit.getText());
  col=(ColumnDescr)rule.getLhs().getDescrs().get(1);
  assertEquals("Baz",col.getObjectType());
  col=(ColumnDescr)rule.getLhs().getDescrs().get(2);
  assertEquals("Bar",col.getObjectType());
  assertEquals("foo2",col.getIdentifier());
  assertEquals(1,col.getDescrs().size());
  lit=(LiteralDescr)col.getDescrs().get(0);
  assertEquals("==",lit.getEvaluator());
  assertEquals("a",lit.getFieldName());
  assertEquals("2",lit.getText());
  col=(ColumnDescr)rule.getLhs().getDescrs().get(3);
  assertEquals("Bar",col.getObjectType());
  assertEqualsIgnoreWhitespace("bar foo3 : Bar(a==3) baz foo4 : Bar(a==4)",rule.getConsequence());
  assertTrue(mockExpanderResolver.checkExpanded("when,The rain in spain falls mainly"));
  assertTrue(mockExpanderResolver.checkExpanded("then,Something else"));
  assertTrue(mockExpanderResolver.checkExpanded("then,Hey dude"));
  assertFalse(parser.hasErrors());
}
