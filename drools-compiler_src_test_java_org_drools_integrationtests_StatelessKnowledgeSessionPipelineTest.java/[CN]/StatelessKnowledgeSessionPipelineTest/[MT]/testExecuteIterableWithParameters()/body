{
  String str="";
  str+="package org.sample \n";
  str+="global java.util.List list; \n";
  str+="rule rule1 \n";
  str+="  when \n";
  str+="    s : String() \n";
  str+="  then \n";
  str+="    list.add( s ); ";
  str+="end\n";
  KnowledgeBuilder kbuilder=KnowledgeBuilderFactory.newKnowledgeBuilder();
  kbuilder.add(ResourceFactory.newByteArrayResource(str.getBytes()),ResourceType.DRL);
  if (kbuilder.hasErrors()) {
    System.out.println(kbuilder.getErrors());
  }
  assertFalse(kbuilder.hasErrors());
  KnowledgeBase kbase=KnowledgeBaseFactory.newKnowledgeBase();
  kbase.addKnowledgePackages(kbuilder.getKnowledgePackages());
  StatelessKnowledgeSession ksession=kbase.newStatelessKnowledgeSession();
  MvelAction mvelAction1=new MvelAction("context.setIterable( this )");
  MvelAction mvelAction2=new MvelAction("context.parameters.globalParams.setInOut( ['list' : new java.util.ArrayList()] )");
  mvelAction1.setReceiver(mvelAction2);
  StatelessKnowledgeSessionExecuteStage stage1=new StatelessKnowledgeSessionExecuteStage();
  mvelAction2.setReceiver(stage1);
  MvelAction mvelAction3=new MvelAction("context.resultHandler.handleResult( context.result )");
  stage1.setReceiver(mvelAction3);
  StatelessKnowledgeSessionPipelineImpl pipeline=new StatelessKnowledgeSessionPipelineImpl(ksession);
  pipeline.setReceiver(mvelAction1);
  ResultHandlerImpl handler=new ResultHandlerImpl();
  List items=new ArrayList();
  items.add("hello world");
  items.add("goodbye world");
  pipeline.insert(items,handler);
  List list=(List)handler.getStatelessKnowledgeSessionResults().getValue("list");
  assertEquals(2,list.size());
  Collections.sort(list);
  assertEquals("goodbye world",list.get(0));
  assertEquals("hello world",list.get(1));
}
