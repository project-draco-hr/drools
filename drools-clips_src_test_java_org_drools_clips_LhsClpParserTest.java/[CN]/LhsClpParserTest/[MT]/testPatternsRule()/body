{
  RuleDescr rule=parse("(defrule xxx ?b <- (person (name \"yyy\"&?bf|~\"zzz\"|~=(+ 2 3)&:(< 1 2)) ) ?c <- (hobby (type ?bf2&~iii) (rating fivestar) ) => )").defrule();
  assertEquals("xxx",rule.getName());
  AndDescr lhs=rule.getLhs();
  List lhsList=lhs.getDescrs();
  assertEquals(2,lhsList.size());
  PatternDescr personPattern=(PatternDescr)lhsList.get(0);
  assertEquals("?b",personPattern.getIdentifier());
  assertEquals("person",personPattern.getObjectType());
  List colList=personPattern.getDescrs();
  assertEquals(2,colList.size());
  FieldBindingDescr fbd=(FieldBindingDescr)colList.get(0);
  assertEquals("?bf",fbd.getIdentifier());
  assertEquals("name",fbd.getFieldName());
  FieldConstraintDescr fieldConstraintDescr=(FieldConstraintDescr)colList.get(1);
  assertEquals("name",fieldConstraintDescr.getFieldName());
  RestrictionConnectiveDescr root=(RestrictionConnectiveDescr)fieldConstraintDescr.getRestriction();
  assertEquals(1,root.getRestrictions().size());
  RestrictionConnectiveDescr or=(RestrictionConnectiveDescr)root.getRestrictions().get(0);
  assertEquals(RestrictionConnectiveDescr.OR,or.getConnective());
  List restrictionList=or.getRestrictions();
  assertEquals(3,restrictionList.size());
  LiteralRestrictionDescr litDescr=(LiteralRestrictionDescr)restrictionList.get(0);
  assertEquals("==",litDescr.getEvaluator());
  assertEquals("yyy",litDescr.getText());
  litDescr=(LiteralRestrictionDescr)restrictionList.get(1);
  assertEquals("!=",litDescr.getEvaluator());
  assertEquals("zzz",litDescr.getText());
  RestrictionConnectiveDescr and=(RestrictionConnectiveDescr)restrictionList.get(2);
  assertEquals(RestrictionConnectiveDescr.AND,and.getConnective());
  assertEquals(2,and.getRestrictions().size());
  ReturnValueRestrictionDescr retDescr=(ReturnValueRestrictionDescr)and.getRestrictions().get(0);
  assertEquals("!=",retDescr.getEvaluator());
  CLPReturnValue clprv=(CLPReturnValue)retDescr.getContent();
  FunctionCaller fc=clprv.getFunctions()[0];
  assertEquals("+",fc.getName());
  assertEquals(new LongValueHandler(2),fc.getParameters()[0]);
  assertEquals(new LongValueHandler(3),fc.getParameters()[1]);
  PredicateDescr predicateDescr=(PredicateDescr)and.getRestrictions().get(1);
  CLPPredicate clpp=(CLPPredicate)predicateDescr.getContent();
  fc=clpp.getFunctions()[0];
  assertEquals("<",fc.getName());
  assertEquals(new LongValueHandler(1),fc.getParameters()[0]);
  assertEquals(new LongValueHandler(2),fc.getParameters()[1]);
  PatternDescr hobbyPattern=(PatternDescr)lhsList.get(1);
  assertEquals("?c",hobbyPattern.getIdentifier());
  assertEquals("hobby",hobbyPattern.getObjectType());
  colList=hobbyPattern.getDescrs();
  assertEquals(3,colList.size());
  fbd=(FieldBindingDescr)colList.get(0);
  assertEquals("?bf2",fbd.getIdentifier());
  assertEquals("type",fbd.getFieldName());
  fieldConstraintDescr=(FieldConstraintDescr)colList.get(1);
  restrictionList=fieldConstraintDescr.getRestrictions();
  assertEquals("type",fieldConstraintDescr.getFieldName());
  assertEquals(RestrictionConnectiveDescr.AND,fieldConstraintDescr.getRestriction().getConnective());
  litDescr=(LiteralRestrictionDescr)restrictionList.get(0);
  assertEquals("!=",litDescr.getEvaluator());
  assertEquals("iii",litDescr.getText());
  fieldConstraintDescr=(FieldConstraintDescr)colList.get(2);
  restrictionList=fieldConstraintDescr.getRestrictions();
  assertEquals("rating",fieldConstraintDescr.getFieldName());
  litDescr=(LiteralRestrictionDescr)restrictionList.get(0);
  assertEquals("==",litDescr.getEvaluator());
  assertEquals("fivestar",litDescr.getText());
}
