{
  StatelessSession session=getStatelessSession(this.getClass().getResourceAsStream("Consequence.drl"));
  session.setAgendaFilter(new RuleNameMatchesAgendaFilter("No action - possibly commented out"));
  AnalyticsDataFactory.clearAnalyticsData();
  Collection<? extends Object> testData=getTestData(this.getClass().getResourceAsStream("ConsequenceTest.drl"));
  AnalyticsDataFactory.clearAnalyticsResult();
  AnalyticsResult result=AnalyticsDataFactory.getAnalyticsResult();
  session.setGlobal("result",result);
  session.executeWithResults(testData);
  Iterator<AnalyticsMessageBase> iter=result.getBySeverity(AnalyticsMessageBase.Severity.WARNING).iterator();
  Set<String> rulesThatHadErrors=new HashSet<String>();
  while (iter.hasNext()) {
    Object o=(Object)iter.next();
    if (o instanceof AnalyticsMessage) {
      AnalyticsRule rule=(AnalyticsRule)((AnalyticsMessage)o).getFaulty();
      rulesThatHadErrors.add(rule.getRuleName());
    }
  }
  assertFalse(rulesThatHadErrors.contains("Has a consequence 1"));
  assertTrue(rulesThatHadErrors.remove("Missing consequence 1"));
  assertTrue(rulesThatHadErrors.remove("Missing consequence 2"));
  if (!rulesThatHadErrors.isEmpty()) {
    for (    String string : rulesThatHadErrors) {
      fail("Rule " + string + " caused an error.");
    }
  }
}
