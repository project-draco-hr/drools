{
  log.info("AUTO MIGRATION: Performing drools.package migration...");
  PackageIterator pkgs=repo.listPackages();
  boolean performed=false;
  while (pkgs.hasNext()) {
    performed=true;
    PackageItem pkg=(PackageItem)pkgs.next();
    migratePackage(pkg);
    String[] snaps=repo.listPackageSnapshots(pkg.getName());
    if (snaps != null) {
      for (int i=0; i < snaps.length; i++) {
        PackageItem snap=repo.loadPackageSnapshot(pkg.getName(),snaps[i]);
        migratePackage(snap);
      }
    }
  }
  if (performed) {
    repo.getSession().getRootNode().getNode(RulesRepository.RULES_REPOSITORY_NAME).addNode("drools.package.migrated","nt:folder");
    repo.save();
    log.info("AUTO MIGRATION: drools.package migration completed.");
  }
}
