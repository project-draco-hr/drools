{
  URLScanner scan=new URLScanner();
  File dir=RuleBaseAssemblerTest.getTempDirectory();
  int numfiles=dir.list().length;
  Properties config=new Properties();
  config.setProperty(RuleAgent.URLS,"http://goo2.ber http://wee2.waa");
  scan.configure(config);
  scan.httpClient=new IHttpClient(){
    public LastUpdatedPing checkLastUpdated(    URL url) throws IOException {
      LastUpdatedPing ping=new LastUpdatedPing();
      ping.lastUpdated=123;
      ping.responseMessage="200 OK";
      return ping;
    }
    public Package fetchPackage(    URL url,    String username,    String password) throws IOException {
      if (url.toExternalForm().equals("http://goo2.ber")) {
        return new Package("goo2.ber");
      }
 else {
        return new Package("wee2.waa");
      }
    }
  }
;
  assertNull(scan.localCacheFileScanner);
  assertNull(scan.localCacheDir);
  RuleBase rb=RuleBaseFactory.newRuleBase();
  AgentEventListener list=getNilListener();
  PackageProvider.applyChanges(rb,false,scan.loadPackageChanges().getChangedPackages(),list);
  assertEquals(2,rb.getPackages().length);
  assertExists(new String[]{"goo2.ber","wee2.waa"},rb.getPackages());
  assertEquals(numfiles,dir.list().length);
}
