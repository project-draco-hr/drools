{
  boolean dirty=true;
  while (dirty) {
    for (    Activation activation : wm.getAgenda().getActivations()) {
      if (activation.isRuleAgendaItem()) {
        ((RuleAgendaItem)activation).getRuleExecutor().reEvaluateNetwork(wm,null,false);
        ((RuleAgendaItem)activation).getRuleExecutor().removeRuleAgendaItemWhenEmpty(wm);
      }
    }
    dirty=false;
    if (((InternalRuleBase)wm.getRuleBase()).getConfiguration().isPhreakEnabled()) {
      for (      Activation activation : wm.getAgenda().getActivations()) {
        if (activation.isRuleAgendaItem() && ((RuleAgendaItem)activation).getRuleExecutor().isDirty()) {
          dirty=true;
          break;
        }
      }
    }
  }
}
