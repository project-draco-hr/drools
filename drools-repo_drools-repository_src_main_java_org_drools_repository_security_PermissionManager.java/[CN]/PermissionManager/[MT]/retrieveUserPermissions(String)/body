{
  try {
    Map<String,List<String>> result=new HashMap<String,List<String>>(10);
    if (!isValideUserName(userName)) {
      return result;
    }
    if (!getUserPermissionNode(userName).hasNode("jcr:content")) {
      return result;
    }
    Node permsNode=getUserPermissionNode(userName).getNode("jcr:content");
    PropertyIterator it=permsNode.getProperties();
    while (it.hasNext()) {
      Property p=(Property)it.next();
      String name=p.getName();
      if (!name.startsWith("jcr")) {
        if (p.getDefinition().isMultiple()) {
          Value[] vs=p.getValues();
          List<String> perms=new ArrayList<String>();
          for (int i=0; i < vs.length; i++) {
            perms.add(vs[i].getString());
          }
          result.put(name,perms);
        }
 else {
          Value v=p.getValue();
          List<String> perms=new ArrayList<String>(1);
          perms.add(v.getString());
          result.put(name,perms);
        }
      }
    }
    return result;
  }
 catch (  RepositoryException e) {
    throw new RulesRepositoryException(e);
  }
}
