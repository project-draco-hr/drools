{
  Declaration[] declrs=(Declaration[])results.getDeclarations().values().toArray(new Declaration[results.getDeclarations().size()]);
  this.results=new ArrayList<List>(results.size());
  this.factHandles=new ArrayList<List<FactHandle>>(results.size());
  int length=declrs.length;
  for (  org.drools.QueryResult result : results) {
    List<Object> row=new ArrayList<Object>();
    List<FactHandle> rowHandle=new ArrayList<FactHandle>();
    for (int i=0; i < length; i++) {
      Declaration declr=declrs[i];
      row.add(result.get(declr));
      rowHandle.add(result.getFactHandle(declr));
    }
    this.results.add(row);
    this.factHandles.add(rowHandle);
  }
  identifiers=new HashMap<String,Integer>(length);
  for (int i=0; i < length; i++) {
    identifiers.put(declrs[i].getIdentifier(),i);
  }
}
